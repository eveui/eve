/*!
 * eve.charts.js
 * https://github.com/eveui/eve
 *
 * Copyright 2015, Ismail Ozdemir
 * Released under the MIT license
 * https://github.com/eveui/eve/blob/master/LICENSE
 *
 * Date: 2015-04-09 09:15 AM (EST)
 *
 * DEFINITION
 * Eve charts library.
 */
 (function(window,undefined){'use strict';var eve=function(selector){if(selector===null)return null;if(eve.getType(selector)==='string'){var selectorPhrase=selector.substring(0,1);if(selectorPhrase==='#'){var elements=document.getElementById(selector.substring(1));if(elements===null)return null;else return new eveElement(elements);}if(document.querySelectorAll){var elements=document.querySelectorAll(selector);if(elements.length===0)return null;else return new eveElement(elements);}else{switch(selectorPhrase){case '.':{var elements=document.getElementsByClassName(selector.substring(1));if(elements.length===0)return null;else return new eveElement(elements);}break;case ':':{var elements=document.getElementsByTagName(selector.substring(1));if(elements.length===0)return null;else return new eveElement(elements);}break;default:{var elements=document.getElementById(selector);if(elements===null)return null;else return new eveElement(elements);}break;}}}else{if(selector['_eveElement']!==undefined)return selector;else return new eveElement(selector);}};eve.browser={isIE:false|| ! !document.documentMode,timeZone:new Date().getTimezoneOffset()* -1/60,supportsLocalStorage:'localStorage'in window&&window['localStorage']!==null,supportsSessionStorage:'sessionStorage'in window&&window['sessionStorage']!==null};eve.getType=function(obj){if(obj===null||obj===undefined)returnType='nullOrEmpty';var returnType='nullOrEmpty';var objType=typeof obj;if(objType==='string'){returnType='string';}else if(objType==='number'){returnType='number';}else if(objType==='boolean'){returnType='bool';}else if(objType==='function'){returnType='function';}else{try{if(obj.getMonth())returnType='dateTime';}catch(e){if(Object.prototype.toString.call(obj)==='[object Array]'){returnType='array';}else if(Object.prototype.toString.call(obj)==='[object Function]'){returnType='function';}else if(Object.prototype.toString.call(obj)==='[object NodeList]'){returnType='nodeList';}else if(Object.prototype.toString.call(obj)==='[object Object]'){if(eve.isHTMLElement(obj)){returnType='htmlElement';}else{if(obj['_eveElement']!==null)returnType='eveElement';else returnType='object';}}else{if(eve.isHTMLElement(obj))returnType='htmlElement';else returnType='nullOrEmpty';}}}return returnType;};eve.isHTMLElement=function(obj){return(typeof HTMLElement==="object"?obj instanceof HTMLElement:obj&&typeof obj==="object"&&obj!==null&&obj.nodeType===1&&typeof obj.nodeName==="string");};eve.viewport=function(){var viewportwidth,viewportheight;if(typeof window.innerWidth!=='undefined'){viewportwidth=window.innerWidth;viewportheight=window.innerHeight;}else if(typeof document.documentElement!=='undefined'&&typeof document.documentElement.clientWidth!=='undefined'&&document.documentElement.clientWidth!==0){viewportwidth=document.documentElement.clientWidth;viewportheight=document.documentElement.clientHeight;}else{viewportwidth=document.getElementsByTagName('body')[0].clientWidth;viewportheight=document.getElementsByTagName('body')[0].clientHeight;}return{width:viewportwidth,height:viewportheight};};eve.clone=function(obj){if(eve.getType(obj)==='array'){var _arr=[];obj.each(function(item,index){_arr.push(eve.clone(item));});return _arr;}else{var _obj={};for(var key in obj)_obj[key]=obj[key];return _obj;}};eve.memoize=function(fn){return function(){var params=Array.prototype.slice.call(arguments),sign='',i=params.length;cParam=null;while(i--){cParam=params[i];sign+=(cParam===Object(cParam))?JSON.stringify(cParam):cParam;fn.memoize||(fn.memoize={});}return(sign in fn.memoize)?fn.memoize[sign]:fn.memoize[sign]=fn.apply(this,params);};};eve.randomNumber=function(min,max){if(min==null)min=0;if(max==null)max=1;if(min>max){throw Error('Max value can not be greater than the min value!');return 0;}return Math.floor(Math.random()*(max-min+1))+min;};eve.randomColor=function(){var _chars='0123456789ABCDEF'.split('');var _color='#';for(var i=0;i<6;i++)_color+=_chars[Math.floor(Math.random()*16)];return _color;};eve.daysInMonth=function(month,year){var today=new Date();if(month==null)month=today.getMonth();if(year==null)year=today.getFullYear();return 32-new Date(year,month,32).getDate();};eve.extend=function(sub,base){function inheritance(){};inheritance.prototype=base.prototype;sub.prototype=new inheritance();sub.inherits=base;for(var propertyName in base)eval('sub.'+propertyName+' = base.'+propertyName);return sub;};eve.merge=function(base,source){if(arguments.length<2)return false;if(eve.getType(base)!=='object')return false;for(var p in source){if(source.hasOwnProperty(p)){if(eve.getType(source[p])==='object'){base[p]=eve.merge(base[p],source[p]);continue;}base[p]=source[p];}}for(var i=2,alen=arguments.length;i<alen;i++)eve.merge(base,arguments[i]);return base;};eve.queryString=function(name){if(arguments.length===0)return '';name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.search);if(results===null)return "";else return decodeURIComponent(results[1].replace(/\+/g," "));};eve.createElement=function(tag,props){if(arguments.length===0)return null;if(tag===null)return null;var _el=document.createElement(tag.toUpperCase());for(var key in props){try{_el[key]=props[key];}catch(e){_el.setAttribute(key,props[key]);}}return _el;};eve.toBinaryArray=function(base64){var len=base64.length,buffer=new Uint8Array(len/4*3|0),i=0,outptr=0,last=[0,0],state=0,save=0,rank,code,undef,base64_ranks=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]);while(len--){code=base64.charCodeAt(i++);rank=base64_ranks[code-43];if(rank!==255&&rank!==undef){last[1]=last[0];last[0]=code;save=(save<<6)|rank;state++;if(state===4){buffer[outptr++]=save>>>16;if(last[1]!==61){buffer[outptr++]=save>>>8;}if(last[0]!==61){buffer[outptr++]=save;}state=0;}}}return buffer;};eve.toBlob=function(datastring,type){if(type==null)type='png';var header_end=datastring.indexOf(',')+1,header=datastring.substring(0,header_end),data=datastring;if(header.indexOf('base64')=== -1)return null;data=eve.toBinaryArray(datastring.substring(header_end));switch(type){case 'png':return new Blob([data],{type:'image/png'});case 'jpg':return new Blob([data],{type:'image/jpg'});case 'gif':return new Blob([data],{type:'image/gif'});case 'pdf':return new Blob([data],{type:'application/pdf'});default:return new Blob([data],{type:'image/png'});}};eve.toHex=function(value){var hex=value.toString(16);return hex.length===1?'0'+hex:hex;};eve.rgbToHex=function(){if(arguments.length===1){if(arguments.toString().indexOf('#')> -1){return arguments[0];}else{var _arg=arguments[0].toString().replace('rgb(','').replace(')','');var _rgb=_arg.split(',');return '#'+eve.toHex(parseInt(_rgb[0]))+eve.toHex(parseInt(_rgb[1]))+eve.toHex(parseInt(_rgb[2]));}}else if(arguments.length===3){return '#'+eve.toHex(parseInt(arguments[0]))+eve.toHex(parseInt(arguments[1]))+eve.toHex(parseInt(arguments[2]));}else{return '#0066CC';}};eve.hexToRgb=function(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null;};eve.gradient=function(startColor,endColor,percent){var newColor={};var color1=eve.hexToRgb(startColor);var color2=eve.hexToRgb(endColor);function channel(a,b){return(a+Math.round((b-a)*(percent/100)));};function colorPiece(num){num=Math.min(num,255);num=Math.max(num,0);var str=num.toString(16);if(str.length<2){str="0"+str;}return(str);};newColor.r=channel(color1.r,color2.r);newColor.g=channel(color1.g,color2.g);newColor.b=channel(color1.b,color2.b);newColor.cssColor="#"+colorPiece(newColor.r)+colorPiece(newColor.g)+colorPiece(newColor.b);return "#"+colorPiece(newColor.r)+colorPiece(newColor.g)+colorPiece(newColor.b);};eve.createGUID=function(){function generateRandomChars(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};return generateRandomChars()+generateRandomChars()+'-'+generateRandomChars()+'-'+generateRandomChars()+'-'+generateRandomChars()+'-'+generateRandomChars()+generateRandomChars()+generateRandomChars();};eve.getDataType=function(data,fieldName){if(arguments.length<2){throw new Error('Data and fieldName can not be found in arguments!');return null;};if(eve.getType(data)!=='array'){throw new Error('Data type mistmatch! Data should be an array...');return null};if(data[0][fieldName]===undefined||data[0][fieldName]===null){throw new Error('Given fieldName can not be found in data...');return null};var returnType='';data.each(function(row,index){if(row[fieldName]!==undefined&&row[fieldName]!==null)returnType=eve.getType(row[fieldName]);});return returnType;};function eveElement(element){if(element===null||element==='')return null;var _eveElements=[];if(eve.getType(element)==='nodeList'||eve.getType(element)==='array'){for(var i=0;i<=element.length-1;i++)_eveElements.push(element[i]);}else if(eve.getType(element)==='eveElement'){_eveElements.push(element._eveElement);}else{_eveElements.push(element);}this.reference=_eveElements.length===1?_eveElements[0]:_eveElements;};eveElement.prototype={offset:function(){if(eve.getType(this.reference)==='htmlElement'){if(this.reference.getBoundingClientRect){var _b=this.reference.getBoundingClientRect();return{width:_b.width,height:_b.height,left:_b.left,top:_b.top};}else{return{width:this.reference['offsetWidth']==null?0:parseFloat(this.reference['offsetWidth']),height:this.reference['offsetHeight']==null?0:parseFloat(this.reference['offsetHeight']),left:this.reference['offsetLeft']==null?0:parseFloat(this.reference['offsetLeft']),top:this.reference['offsetTop']==null?0:parseFloat(this.reference['offsetTop'])};}}},attr:function(name,value){if(arguments.length===0)return this;if(arguments.length===1){if(eve.getType(this.reference)==='htmlElement'){if(this.reference[name]!==null){return this.reference[name];}else{if(this.reference['attributes']!==null){for(var _attr in this.reference['attributes']){if(parseInt(_attr)!==isNaN){if(this.reference['attributes'][_attr].name===name)return this.reference['attributes'][_attr].value;}}}}}}else{if(eve.getType(this.reference)==='htmlElement'){this.reference[name]=value;}else{this.reference.each(function(el,index){el[name]=value;});}return this;}},removeAttr:function(name){if(arguments.length===0)return this;if(eve.getType(this.reference)==='htmlElement'){if(this.reference[name])delete this.reference[name];}else{this.reference.each(function(el,index){if(el[name])delete el[name];});}return this;},style:function(name,value){if(arguments.length===0)return this;if(arguments.length===1){if(eve.getType(this.reference)==='htmlElement'){if(window.getComputedStyle){return window.getComputedStyle(this.reference)[name];}else{if(this.reference.style[name]!=null){return this.reference.style[name];}}return '';}}else{if(eve.getType(this.reference)==='htmlElement'){if(this.reference.style[name]!==null)this.reference.style[name]=value;}else{this.reference.each(function(el,index){if(el.style[name]!=null)el.style[name]=value;});}return this;}},margin:function(){return{left:this.style('marginLeft'),top:this.style('marginTop'),bottom:this.style('marginBottom'),right:this.style('marginRight')};},padding:function(){return{left:this.style('paddingLeft'),top:this.style('paddingTop'),bottom:this.style('paddingBottom'),right:this.style('paddingRight')};},parent:function(){if(eve.getType(this.reference)==='htmlElement')return new eveElement(this.reference.parentNode);return this;},children:function(){if(eve.getType(this.reference)==='htmlElement'){var _children=[];if(this.reference['childNodes']&&this.reference['childNodes'].length>0){for(var i=0;i<=this.reference.childNodes.length-1;i++)_children.push(new eveElement(this.reference.childNodes[i]));}return _children;}return this;},value:function(value){if(value==null){if(eve.getType(this.reference)==='htmlElement'){if(this.reference['value']!==null)return this.reference['value'];else return '';}}else{if(eve.getType(this.reference)==='htmlElement'){this.reference['value']=value;}else{this.reference.each(function(el,index){if(el['value']!==null)el['value']=value;});}return this;}},html:function(html){if(html===null){if(eve.getType(this.reference)==='htmlElement'){if(this.reference['innerHTML']!==null)return this.reference['innerHTML'];else return '';}}else{if(eve.getType(this.reference)==='htmlElement'){this.reference['innerHTML']=html;}else{this.reference.each(function(el,index){if(el['innerHTML']!==null)el['innerHTML']=html;});}return this;}},append:function(element){if(element!==null&&eve.getType(this.reference)==='htmlElement'){var elementType=eve.getType(element);switch(elementType){case 'string':{var _el=document.createElement('DIV');_el.innerHTML=element;for(var i=0;i<=_el.childNodes.length-1;i++)this.reference.appendChild(_el.childNodes[i]);try{document.removeChild(_el);}catch(e){}}break;case 'htmlElement':{this.reference.appendChild(element);}break;case 'eveElement':{if(eve.getType(element.reference)==='htmlElement'){this.reference.appendChild(element.reference);}else{element.reference.each(function(el,index){this.reference.appendChild(el);});}}break;}}return this;},bind:function(events,eventMethod){var base=this;var eventArray=events.split(' ');eventArray.each(function(ev,index){if(eve.getType(base.reference)==='htmlElement'){if(base.reference.addEventListener){console.log(1);base.reference.addEventListener(ev,eventMethod,false);}else{base.reference.attachEvent("on"+ev,function(){return(eventMethod.call(base.reference,window.event));});}}else{base.reference.each(function(el){if(el.addEventListener){el.addEventListener(ev,eventMethod,false);}else{el.attachEvent("on"+ev,function(){return(eventMethod.call(el,window.event));});}});}});return this;},unbind:function(events,eventMethod){var base=this;var eventArray=events.split(' ');eventArray.each(function(ev){if(eve.getType(base.reference)==='htmlElement'){base.reference.removeEventListener(ev,eventMethod,false);}else{base.reference.each(function(el){el.removeEventListener(ev,eventMethod,false);});}});return this;},addClass:function(className){if(className!==null){if(eve.getType(this.reference)==='htmlElement'){if(this.reference['classList']!==null){this.reference.classList.add(className);}else{this.reference.className+=' '+className;}}else{this.reference.each(function(el,index){if(el['classList']!==null){el.classList.add(className);}else{el.className+=' '+className;}});}}return this;},removeClass:function(className){if(className!=null){if(eve.getType(this.reference)==='htmlElement'){if(this.reference['classList']!==null){this.reference.classList.remove(className);}else{this.reference.className=this.reference.className.replace(className,'').trim();}}else{this.reference.each(function(el,index){if(el['classList']!==null){el.classList.remove(className);}else{el.className=el.className.replace(className,'').trim();}});}}return this;},hasClass:function(className){if(className===null)return false;if(eve.getType(this.reference)==='htmlElement'){return this.reference.className.indexOf(className)> -1;}else{var stateHandler=[];this.reference.each(function(el){stateHandler.push(el.className.indexOf(className)> -1);});return!stateHandler.contains(false);}},hover:function(overCallback,outCallback){var base=this;if(overCallback!==null&&outCallback!==null){if(eve.getType(overCallback)==='function'&&eve.getType(outCallback)==='function'){if(eve.getType(this.reference)==='htmlElement'){base.reference.onmouseover=function(e){overCallback.call(base.reference,e);};base.reference.onmouseout=function(e){outCallback.call(base.reference,e);}}else{base.reference.each(function(el,index){el.onmouseover=function(e){overCallback.call(el,e);};el.onmouseout=function(e){outCallback.call(el,e);}});}}}},click:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onclick=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onclick=function(e){callback.call(el,e);}});}}},enter:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onfocus=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onfocus=function(e){callback.call(el,e);}});}}},exit:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onblur=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onblur=function(e){callback.call(el,e);}});}}},keyPress:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onkeypress=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onkeypress=function(e){callback.call(el,e);}});}}},keyDown:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onkeydown=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onkeydown=function(e){callback.call(el,e);}});}}},keyUp:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onkeyup=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onkeyup=function(e){callback.call(el,e);}});}}},mouseDown:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onmousedown=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onmousedown=function(e){callback.call(el,e);}});}}},mouseUp:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onmouseup=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onmouseup=function(e){callback.call(el,e);}});}}},mouseOver:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onmouseover=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onmouseover=function(e){callback.call(el,e);}});}}},mouseOut:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onmouseout=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onmouseout=function(e){callback.call(el,e);}});}}},mouseMove:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.onmousemove=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.onmousemove=function(e){callback.call(el,e);}});}}},dragStart:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.ondragstart=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.ondragstart=function(e){callback.call(el,e);}});}}},dragEnd:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.ondragend=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.ondragend=function(e){callback.call(el,e);}});}}},drag:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.ondrag=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.ondrag=function(e){callback.call(el,e);}});}}},drop:function(callback){var base=this;if(eve.getType(callback)==='function'){if(eve.getType(base.reference)==='htmlElement'){base.reference.ondrop=function(e){callback.call(base.reference,e);}}else{base.reference.each(function(el){el.ondrop=function(e){callback.call(el,e);}});}}},pie:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['data']===undefined||options['data']===null){throw new Error('Chart data is missing!');return null;}if(eve.getType(options.data)!=='array'){throw new Error('Chart data type mistmatch! Please pass an array as chart data!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.pie(options);},donut:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['data']===undefined||options['data']===null){throw new Error('Chart data is missing!');return null;}if(eve.getType(options.data)!=='array'){throw new Error('Chart data type mistmatch! Please pass an array as chart data!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.donut(options);},gauge:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}if(options.series[0]['value']===undefined||options.series[0]['value']===null){throw new Error('Gauge value is missing!');return null;}if(eve.getType(options.series[0]['value'])!=='number'){throw new Error('Gauge value type mistmatch! Please pass a number as gauge value!');return null;}options['container']=this;return eve.charts.gauge(options);},line:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.line(options);},area:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.area(options);},stream:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.stream(options);},bar:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.bar(options);},column:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.column(options);},scatter:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.scatter(options);},bubble:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.bubble(options);},bullet:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.bullet(options);},funnel:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.funnel(options);},pyramid:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.pyramid(options);},ohlc:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.ohlc(options);},candleStick:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.candleStick(options);},parallel:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.parallel(options);},waterfall:function(options){if(arguments.length===0){throw new Error('Chart options are missing!');return null;}if(options['series']===undefined||options['series']===null){throw new Error('There is not any serie in this chart!');return null;}if(eve.getType(options.series)!=='array'){throw new Error('Chart series type mistmatch! Please pass an array as chart series!');return null;}options['container']=this;return eve.charts.waterfall(options);}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement,fromIndex){var k,o,n,len;if(this==null)return-1;o=Object(this);len=o.length>>>0;if(len===0)return-1;n= +fromIndex||0;if(Math.abs(n)===Infinity)n=0;if(n>=len)return-1;k=Math.max(n>=0?n:len-Math.abs(n),0);while(k<len){if(k in o&&o[k]===searchElement)return k;k++;}return-1;};};if(!Array.prototype.contains){Array.prototype.contains=function(searchElement){return this.indexOf(searchElement)> -1;};};if(!Array.prototype.each){Array.prototype.each=function(callBack,arg){var t,k,o,len;if(this==null)return;if(typeof callBack!=='function')return;o=Object(this);len=o.length>>>0;if(arguments.length>1)t=arg;k=0;while(k<len){var cValue;if(k in o){cValue=o[k];callBack.call(t,cValue,k);}k++;}};};if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(' this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=='function'){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=thisArg;}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}k++;}return A;};}if(!Array.prototype.max){Array.prototype.max=function(){return Math.max.apply(null,this);};}if(!Array.prototype.min){Array.prototype.min=function(){return Math.min.apply(null,this);};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');};};String.prototype.replaceAll=function(term,replacement){return this.replace(new RegExp(term,'g'),replacement);};String.prototype.stripHTML=function(){return this.replace(/(<([^>]+)>)/ig,'');};String.prototype.startsWith=function(val){var _len=val.toString().length;var _str=this.substring(0,_len);return _str==val;};String.prototype.endsWith=function(val){var _start=this.length-val.length;var _str=this.substring(_start);return _str==val;};Date.prototype.diff=function(date){return(this.getTime()-date.getTime())/(1000*60*60*24);};Date.prototype.addHours=function(hours){return this.setHours(this.getHours()+hours);;};Number.prototype.group=function(decimalSeperator,thousandsSeperator,decimalCount){if(decimalSeperator===null)decimalSeperator='.';if(thousandsSeperator===null)thousandsSeperator=',';if(decimalCount===null)decimalCount=2;if(eve.getType(decimalCount)!=='number')decimalCount=2;if(eve.getType(decimalSeperator)!=='string')decimalSeperator='.';if(eve.getType(thousandsSeperator)!=='string')thousandsSeperator=',';var _val=decimalCount<0?this:this.toFixed(decimalCount),_valS=_val.toString(),_v=_valS.split('.'),_v1=_v[0],_v2=_v.length>1?decimalSeperator+_v[1]:'',_rgx=/(\d+)(\d{3})/;while(_rgx.test(_v1)){_v1=_v1.replace(_rgx,'$1'+thousandsSeperator+'$2');}return _v1+_v2;};window.eve=eve;})(window); (function(eveCharts){function chart(options){this.animationDuration=500;this.backColor='#ffffff';this.balloon=new balloon();this.borderColor='#eeeeee';this.borderRadius=0;this.borderSize=0;this.borderStyle='solid';this.container=null;this.data=null;this.dateFormat='%x';this.decimalSeperator='.';this.formatNumbers=false;this.id=eve.createGUID();this.legend=new legend();this.margin={left:10,top:10,right:10,bottom:10};this.precision=2;this.series=[];this.thousandSeperator=',';this.trends=[];this.prefix='';this.suffix='';this.useAbbreviations=false;this.xAxis=new xAxis();this.xField='';this.yAxis=new yAxis();this.legendClick=function(data){};this.serieClick=function(data){};var base=this,dateFormatter=d3.time.format(this.dateFormat),chartType='sliced';for(var key in options){if(this[key]!==undefined||this[key]!==null){switch(key){case 'balloon':this[key]=new balloon(options[key]);break;case 'legend':this[key]=new legend(options[key]);break;case 'xAxis':this[key]=new xAxis(options[key]);break;case 'yAxis':this[key]=new yAxis(options[key]);break;case 'trends':{options[key].each(function(trendOptions){base[key].push(new trend(trendOptions));})}break;case 'series':{options[key].each(function(serieObject){if(serieObject['type']===undefined||serieObject['type']===null){throw new Error('Serie type can not be found!');return null;}else{switch(serieObject.type){case 'pie':case 'donut':{base[key].push(new pieSerie(serieObject));chartType='sliced';}break;case 'funnel':case 'pyramid':{base[key].push(new funnelSerie(serieObject));chartType='sliced';}break;case 'gauge':{base[key].push(new gaugeSerie(serieObject));chartType='sliced';}break;case 'bullet':{base[key].push(new bulletSerie(serieObject));chartType='sliced';}break;case 'parallel':{base[key].push(new parallelSerie(serieObject));chartType='linear';}break;default:{base[key].push(new xySerie(serieObject));chartType='linear';}break;}}});}break;default:this[key]=options[key];break;}}};function chartPlot(){this.container=null;this.width=0;this.height=0;this.canvas=null;this.balloon=null;if(eve.getType(base.container)==='string')this.container=eve('#'+base.container);else if(eve.getType(base.container)==='htmlElement')this.container=eve(base.container);else this.container=base.container;this.container.html('');var offset=this.container.offset(),dateFormatter=d3.time.format(base.dateFormat);this.width=offset.width;this.height=offset.height;this.container.style('backgroundColor',base.backColor);if(base.borderSize>0){this.container.style('borderStyle',base.borderStyle);this.container.style('borderWidth',base.borderSize+'px');this.container.style('borderColor',base.borderColor);this.container.style('borderRadius',base.borderRadius+'px');}if(base.balloon.enabled){eve(document.body).append('<div id="'+base.id+'_balloon" style="position: absolute; display: none; z-index: 1000;"></div>');this.balloon=eve('#'+base.id+'_balloon');this.balloon.style('backgroundColor',base.balloon.backColor);this.balloon.style('borderStyle',base.balloon.borderStyle);this.balloon.style('borderColor',base.balloon.borderColor);this.balloon.style('borderRadius',base.balloon.borderRadius+'px');this.balloon.style('borderWidth',base.balloon.borderSize+'px');this.balloon.style('color',base.balloon.fontColor);this.balloon.style('fontFamily',base.balloon.fontFamily);this.balloon.style('fontSize',base.balloon.fontSize+'px');this.balloon.style('paddingLeft',base.balloon.padding+'px');this.balloon.style('paddingTop',base.balloon.padding+'px');this.balloon.style('paddingRight',base.balloon.padding+'px');this.balloon.style('paddingBottom',base.balloon.padding+'px');if(base.balloon.fontStyle=='bold')this.balloon.style('fontWeight','bold');else this.balloon.style('fontStyle',base.balloon.fontStyle);}this.canvas=d3.select(this.container.reference).append('svg').attr('id',base.id+'_svg').attr('viewBox','0 0 '+this.width+' '+this.height).attr('width',this.width).attr('height',this.height).append('g');this.aspectRatio=this.width/this.height;};function chartAxis(isReversed){if(isReversed==null)isReversed=false;this.x=null;this.y=null;this.xAxis=null;this.yAxis=null;this.series=null;this.serieNames=[];var that=this,xAxis,xAxisTitle,xAxisLabels,yAxis,yAxisTitle,yAxisLabels,legendIcons,legendTexts,legendWidth,legendHeight,axisLeft=base.margin.left,axisWidth=base.plot.width-base.margin.left-base.margin.right-base.yAxis.labelFontSize*2,axisTop=base.margin.top,axisHeight=base.plot.height-base.margin.top-base.margin.bottom-base.xAxis.labelFontSize*2,maxValues=[],minValues=[],maxXErrors=[],yDomains=[];base.plot.canvas.attr('transform','translate('+base.margin.left+','+base.margin.top+')');base.series.each(function(serie,serieIndex){that.serieNames.push(serie.yField);});that.series=that.serieNames.map(function(name,index){return{name:name,serieType:base.series[index].type,values:base.data.map(function(d){var xValue=d[base.xField],serie=base.series[index],dataObject={};switch(base.xAxis.dataType){case 'date':xValue=(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));break;case 'string':xValue=eve.getType(d[base.xField])==='dateTime'?base.plot.formatDate(d[base.xField]):d[base.xField].toString();break;default:xValue=d[base.xField];break;}dataObject['name']=name;dataObject['index']=index;dataObject['serieType']=serie.type;dataObject['xField']=xValue;if(serie.yField!=='')dataObject['yField']= +parseFloat(d[name]);if(serie.sizeField!=='')dataObject['sizeField']= +parseFloat(d[serie.sizeField]);if(serie.openField!=='')dataObject['openField']= +parseFloat(d[serie.openField]);if(serie.highField!=='')dataObject['highField']= +parseFloat(d[serie.highField]);if(serie.lowField!=='')dataObject['lowField']= +parseFloat(d[serie.lowField]);if(serie.closeField!=='')dataObject['closeField']= +parseFloat(d[serie.closeField]);if(serie.xErrorField!=='')dataObject['xErrorField']= +parseFloat(d[serie.xErrorField]);if(serie.yErrorField!=='')dataObject['yErrorField']= +parseFloat(d[serie.yErrorField]);return dataObject;})};});that.series.each(function(serie,index){maxValues.push(d3.max(serie.values,function(d){switch(d.serieType){case 'ohlc':case 'candlestick':return parseFloat(d.highField);default:return parseFloat(d.yField);}}));minValues.push(d3.min(serie.values,function(d){switch(d.serieType){case 'ohlc':case 'candlestick':return parseFloat(d.lowField);default:return parseFloat(d.yField);}}));maxXErrors.push(d3.max(serie.values,function(d){return parseFloat(d.xErrorField);}));var serieMin=d3.min(that.series,function(c){return d3.min(c.values,function(v){switch(v.serieType){case 'ohlc':case 'candlestick':return parseFloat(v.lowField);default:return parseFloat(v.yField);}});});var serieMax=d3.max(that.series,function(c){return d3.max(c.values,function(v){switch(v.serieType){case 'ohlc':case 'candlestick':return parseFloat(v.highField);default:return parseFloat(v.yField);}});});serieMax*=1.1;var yErrorMax=d3.max(serie.values,function(d){return parseFloat(d.yErrorField);});serieMax+=yErrorMax===undefined?0:yErrorMax;var sizeMin=d3.min(serie.values,function(d){return parseFloat(d.sizeField);});var sizeMax=d3.max(serie.values,function(d){return parseFloat(d.sizeField);});serie.minSize=sizeMin===undefined?base.series[index].minBulletSize:sizeMin;serie.maxSize=sizeMax===undefined?base.series[index].maxBulletSize:sizeMax;serieMin=base.yAxis.startFromZero?0:serieMin;serieMin-=yErrorMax===undefined?0:yErrorMax;yDomains.push(serieMin);yDomains.push(serieMax);});var maxValue=maxValues.max(),minValue=minValues.min(),maxXError=maxXErrors.max(),maxValueLength=(maxValue.toString().length*base.yAxis.labelFontSize/2);axisWidth-=maxValueLength;axisLeft+=maxValueLength;function hideBalloon(){base.plot.balloon.style('display','none');};function showBalloon(content){if(content==null)hideBalloon();base.plot.balloon.html(content);base.plot.balloon.style('left',(parseInt(d3.event.pageX)+5)+'px');base.plot.balloon.style('top',(parseInt(d3.event.pageY)+5)+'px');base.plot.balloon.style('display','block');};function formatTrendValue(value,data){if(arguments.length===0)return '';if(value==null||data==null)return '';var formatted=value,startX=data['startX']===null?0:data.startX,endX=data['endX']===null?0:data.endX,startY=data['startY']===null?0:data.startY,endY=data['endY']===null?0:data.endY;if(data['title']!=null)formatted=formatted.replaceAll('{{title}}',data.title);if(data['startX']!=null)formatted=formatted.replaceAll('{{startX}}',startX);if(data['endX']!=null)formatted=formatted.replaceAll('{{endX}}',endX);if(data['startY']!=null)formatted=formatted.replaceAll('{{startY}}',startY);if(data['endY']!=null)formatted=formatted.replaceAll('{{endY}}',endY);return formatted;};function drawLegend(){if(base.legend.enabled){var symbolSize=Math.pow(base.legend.fontSize,2);legendWidth=base.legend.fontSize+5;legendHeight=base.series.length*base.legend.fontSize;legendTexts=base.plot.canvas.selectAll('.eve-legend-text').data(base.series).enter().append('g');legendIcons=base.plot.canvas.selectAll('.eve-legend-icon').data(base.series).enter().append('g');legendTexts.append('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',base.legend.fontColor).style('font-weight',base.legend.fontStyle=='bold'?'bold':'normal').style('font-style',base.legend.fontStyle=='bold'?'normal':base.legend.fontStyle).style("font-family",base.legend.fontFamily).style("font-size",base.legend.fontSize+'px').style("text-anchor",'left').text(function(d,i){var legendTitle=base.series[i].title;if(legendTitle!=='')return legendTitle;else return base.series[i].yField===''?('Serie'+(i+1)):base.series[i].yField;}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}switch(d.type){case 'line':{var selectedSerie=base.plot.canvas.selectAll('.eve-line-serie-'+i),selectedPoints=base.plot.canvas.selectAll('.eve-line-point-'+i);if(d.selected){base.plot.canvas.selectAll('.eve-series path').style('stroke-opacity',.1);selectedSerie.style('stroke-width',d.lineSize+2);selectedSerie.style('stroke-opacity',1);selectedPoints.style('stroke-opacity',1);}else{base.plot.canvas.selectAll('.eve-series path').style('stroke-opacity',1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('stroke-width',d.lineSize);}}break;case 'area':{var allSeries=base.plot.canvas.selectAll('.eve-series path.eve-area-serie'),selectedSerie=base.plot.canvas.selectAll('.eve-area-serie-'+i),selectedPoints=base.plot.canvas.selectAll('.eve-area-point-'+i);if(d.selected){selectedSerie.style('stroke-width',d.lineSize+2);allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-width',d.lineSize);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.lineSize);allSeries.style('fill-opacity',d.alpha);}}break;case 'scatter':{var allSeries=base.plot.canvas.selectAll('.eve-series path.eve-scatter-point'),selectedPoints=base.plot.canvas.selectAll('.eve-scatter-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedPoints.style('stroke-opacity',d.bulletStrokeAlpha);selectedPoints.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'bar':{var allSeries=base.plot.canvas.selectAll('.eve-series rect'),selectedSerie=base.plot.canvas.selectAll('.eve-bar-serie-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.lineAlpha);allSeries.style('fill-opacity',d.alpha);}}break;}});legendTexts[0].each(function(legendText){var bboxWidth=legendText.getBBox().width+base.legend.fontSize+5;if(bboxWidth>legendWidth)legendWidth=bboxWidth;});legendIcons.append('path').attr('d',d3.svg.symbol().type(base.legend.iconType).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(d.color!=='')return d.color;else return i<=eve.charts.colors.length?eve.charts.colors[i]:eve.randomColor();}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}switch(d.type){case 'line':{var selectedSerie=base.plot.canvas.selectAll('.eve-line-serie-'+i),selectedPoints=base.plot.canvas.selectAll('.eve-line-point-'+i);if(d.selected){base.plot.canvas.selectAll('.eve-series path').style('stroke-opacity',.1);selectedSerie.style('stroke-width',d.lineSize+2);selectedSerie.style('stroke-opacity',1);selectedPoints.style('stroke-opacity',1);}else{base.plot.canvas.selectAll('.eve-series path').style('stroke-opacity',1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('stroke-width',d.lineSize);}}break;case 'area':{var allSeries=base.plot.canvas.selectAll('.eve-series path.eve-area-serie'),selectedSerie=base.plot.canvas.selectAll('.eve-area-serie-'+i),selectedPoints=base.plot.canvas.selectAll('.eve-area-point-'+i);if(d.selected){selectedSerie.style('stroke-width',d.lineSize+2);allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-width',d.lineSize);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.lineSize);allSeries.style('fill-opacity',d.alpha);}}break;case 'scatter':{var allSeries=base.plot.canvas.selectAll('.eve-series path.eve-scatter-point'),selectedPoints=base.plot.canvas.selectAll('.eve-scatter-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedPoints.style('stroke-opacity',d.bulletStrokeAlpha);selectedPoints.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'bar':{var allSeries=base.plot.canvas.selectAll('.eve-series rect'),selectedSerie=base.plot.canvas.selectAll('.eve-bar-serie-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.lineAlpha);allSeries.style('fill-opacity',d.alpha);}}break;}});if(base.legend.position==='right'){legendIcons.attr('transform',function(d,i){var x=base.plot.width-legendWidth-base.legend.fontSize-base.margin.right,y=base.plot.height/2-legendHeight+(base.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('transform',function(d,i){var x=base.plot.width-legendWidth-base.margin.right,y=base.plot.height/2-legendHeight+(base.legend.fontSize/3)+(base.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});axisWidth-=legendWidth+base.legend.fontSize;}else{legendIcons.attr('transform',function(d,i){var x=base.margin.left+base.yAxis.titleFontSize+5,y=base.plot.height/2-legendHeight+(base.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('transform',function(d,i){var x=base.margin.left+base.yAxis.titleFontSize+base.legend.fontSize+5,y=base.plot.height/2-legendHeight+(base.legend.fontSize/3)+(base.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});axisLeft+=legendWidth+base.legend.fontSize+5;axisWidth-=legendWidth+base.legend.fontSize;}}};function drawTitles(){if(base.xAxis.title!==''){xAxisTitle=base.plot.canvas.append('g').append('text').text(base.xAxis.title).style('fill',base.xAxis.titleFontColor).style('font-family',base.xAxis.titleFontFamily).style('font-size',base.xAxis.titleFontSize+'px').style('font-style',base.xAxis.titleFontStyle==='bold'?'normal':base.xAxis.titleFontStyle).style('font-weight',base.xAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('x',function(d){var bbox=this.getBBox();return base.plot.width/2-bbox.width/2-legendWidth/2;}).attr('y',function(d){var bbox=this.getBBox();return base.plot.height-base.margin.bottom-bbox.height;});var xAxisTitleBBox=xAxisTitle.node().getBBox();axisHeight-=xAxisTitleBBox.height;};if(base.yAxis.title!==''){yAxisTitle=base.plot.canvas.append('g').append('text').text(base.yAxis.title).style('fill',base.yAxis.titleFontColor).style('font-family',base.yAxis.titleFontFamily).style('font-size',base.yAxis.titleFontSize+'px').style('font-style',base.yAxis.titleFontStyle==='bold'?'normal':base.yAxis.titleFontStyle).style('font-weight',base.yAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('transform',function(d){var bbox=this.getBBox();return 'translate('+base.margin.left+','+(base.plot.height/2-bbox.height/2)+')rotate(-90)';});var yAxisTitleBBox=yAxisTitle.node().getBBox();axisLeft+=yAxisTitleBBox.height;axisWidth-=yAxisTitleBBox.height;};};function createXAxis(){return d3.svg.axis().scale(that.x).orient('bottom').ticks(base.xAxis.tickCount);};function createYAxis(){return d3.svg.axis().scale(that.y).orient('left').ticks(base.yAxis.tickCount);};function drawAxis(){switch(base.xAxis.dataType){case 'number':that.x=d3.scale.linear().range([0,axisWidth]);break;case 'date':that.x=d3.time.scale().range([0,axisWidth]);break;case 'string':that.x=d3.scale.ordinal().rangeRoundBands([0,axisWidth],.1);break;default:that.x=d3.scale.linear().range([0,axisWidth]);break;}if(isReversed){that.x=d3.scale.linear().range([0,axisWidth]);switch(base.xAxis.dataType){case 'number':that.y=d3.scale.linear().range([axisHeight,0]);break;case 'date':that.y=d3.time.scale().range([axisHeight,0]);break;case 'string':that.y=d3.scale.ordinal().rangeRoundBands([axisHeight,0],.1);break;default:that.y=d3.scale.linear().range([axisHeight,0]);break;}}else{that.y=d3.scale.linear().range([axisHeight,0]);}that.xAxis=createXAxis();that.yAxis=createYAxis();switch(base.xAxis.dataType){case 'date':{var xMinDate=d3.min(base.data,function(d){return(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));}),xMaxDate=d3.max(base.data,function(d){return(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));}),dayExtension=Math.ceil(xMaxDate.diff(xMinDate)*.1)*24;if(base.xAxis.startFromZero){xMinDate=new Date(xMinDate.addHours(dayExtension* -1));xMaxDate=new Date(xMaxDate.addHours(dayExtension));}if(isReversed)that.y.domain([xMinDate,xMaxDate]);else that.x.domain([xMinDate,xMaxDate]);}break;case 'string':{if(isReversed){that.y.domain(base.data.map(function(d){return d[base.xField].toString();}));}else{that.x.domain(base.data.map(function(d){return d[base.xField].toString();}));}}break;default:{if(base.xAxis.startFromZero){var xMaxValue=d3.max(base.data,function(d){return d[base.xField];});var xMinValue=0;xMaxValue+=isNaN(maxXError)?0:maxXError;xMinValue-=isNaN(maxXError)?0:maxXError;if(isReversed)that.y.domain([xMinValue,(xMaxValue+1)]);else that.x.domain([xMinValue,(xMaxValue+1)]);}else{var xMinValue=d3.min(base.data,function(d){return d[base.xField];}),xMaxValue=d3.max(base.data,function(d){return d[base.xField];});xMaxValue+=isNaN(maxXError)?0:maxXError;xMinValue-=isNaN(maxXError)?0:maxXError;if(isReversed)that.y.domain([xMinValue,xMaxValue]);else that.x.domain([xMinValue,xMaxValue]);}}}if(isReversed)that.x.domain(yDomains);else that.y.domain(yDomains);base.plot.canvas.append('g').attr('class','eve-x-grid').attr('transform',function(){return 'translate('+axisLeft+', '+axisHeight+')';}).style('stroke-opacity',base.xAxis.gridLineAlpha).style('stroke-width',base.xAxis.gridLineThickness).style('stroke',base.xAxis.gridLineColor).call(createXAxis().tickSize(-axisHeight,0,0).tickFormat(''));base.plot.canvas.append('g').attr('class','eve-y-grid').attr('transform',function(){return 'translate('+axisLeft+')';}).style('stroke-opacity',base.yAxis.gridLineAlpha).style('stroke-width',base.yAxis.gridLineThickness).style('stroke',base.yAxis.gridLineColor).call(createYAxis().tickSize(-axisWidth,0,0).tickFormat(''));yAxis=base.plot.canvas.append('g').style('fill','none').style('stroke',base.yAxis.color).style('stroke-width',base.yAxis.thickness+'px').style('shape-rendering','crispEdges').attr('transform','translate('+axisLeft+')').attr('class','eve-y-axis').call(that.yAxis);yAxis.selectAll('line').style('fill','none').style('stroke-width',base.yAxis.thickness+'px').style('shape-rendering','crispEdges').style('stroke-opacity',base.yAxis.alpha).style('stroke',base.yAxis.color);yAxis.selectAll('text').style('fill',base.yAxis.labelFontColor).style('font-size',base.yAxis.labelFontSize+'px').style('font-family',base.yAxis.labelFontFamily).style('font-style',base.yAxis.labelFontStlye==='bold'?'normal':base.yAxis.labelFontStlye).style('font-weight',base.yAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');xAxis=base.plot.canvas.append('g').style('fill','none').style('stroke',base.xAxis.color).style('stroke-width',base.xAxis.thickness+'px').style('shape-rendering','crispEdges').attr('transform','translate('+axisLeft+','+axisHeight+')').attr('class','eve-x-axis').call(that.xAxis);xAxis.selectAll('line').style('fill','none').style('stroke-width',base.xAxis.thickness+'px').style('shape-rendering','crispEdges').style('stroke-opacity',base.xAxis.alpha).style('stroke',base.xAxis.color);xAxis.selectAll('text').style('fill',base.xAxis.labelFontColor).style('font-size',base.xAxis.labelFontSize+'px').style('font-family',base.xAxis.labelFontFamily).style('font-style',base.xAxis.labelFontStlye==='bold'?'normal':base.xAxis.labelFontStlye).style('font-weight',base.xAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');};function addTrend(trend){var xAxisRange=that.x.domain(),bullet=d3.svg.symbol().type('circle').size(64);if(trend.startY<minValue)trend.startY=minValue;if(trend.endY>maxValue)trend.endY=maxValue;if(trend.startX<xAxisRange[0])trend.startX=xAxisRange[0];if(trend.endX>xAxisRange[1])trend.endX=xAxisRange[1];base.plot.canvas.append('line').attr('x1',that.x(trend.startX)+axisLeft).attr('x2',that.x(trend.endX)+axisLeft).attr('y1',that.y(trend.startY)).attr('y2',that.y(trend.endY)).style('stroke',trend.color).style('stroke-dasharray',function(d,i){if(trend.lineDrawingStyle==='dotted')return '2, 2';else if(trend.lineDrawingStyle==='dashed')return '5, 2';else return '0';});base.plot.canvas.append('path').attr('d',bullet).attr('transform','translate('+(that.x(trend.startX)+axisLeft)+','+that.y(trend.startY)+')').style('cursor','pointer').style('stroke',trend.color).style('fill',trend.color).on('mousemove',function(d,i){var serieColor=trend.color,balloonContent=formatTrendValue(trend.startBalloonFormat,trend);base.plot.balloon.style('borderColor',serieColor);showBalloon(balloonContent);d3.select(this).style('stroke-width',2);}).on('mouseout',function(d,i){hideBalloon();d3.select(this).style('stroke-width',1);});base.plot.canvas.append('path').attr('d',bullet).attr('transform','translate('+(that.x(trend.endX)+axisLeft)+','+that.y(trend.endY)+')').style('cursor','pointer').style('stroke',trend.color).style('fill',trend.color).on('mousemove',function(d,i){var serieColor=trend.color,balloonContent=formatTrendValue(trend.endBalloonFormat,trend);base.plot.balloon.style('borderColor',serieColor);showBalloon(balloonContent);d3.select(this).style('stroke-width',2);}).on('mouseout',function(d,i){hideBalloon();d3.select(this).style('stroke-width',1);});};drawLegend();drawTitles();drawAxis();base.trends.each(function(trend){addTrend(trend);});this.offset={left:axisLeft,top:axisTop,width:axisWidth,height:axisHeight};this.update=function(data){if(data==null)data=base.data;yDomains.length=[];minValues.length=[];maxValues.length=[];maxXErrors.length=[];base.data=data;this.series=this.serieNames.map(function(name,index){return{name:name,serieType:base.series[index].type,values:base.data.map(function(d){var xValue=d[base.xField],serie=base.series[index],dataObject={};switch(base.xAxis.dataType){case 'date':xValue=(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));break;case 'string':xValue=d[base.xField];break;default:xValue=d[base.xField];break;}dataObject['name']=name;dataObject['index']=index;dataObject['serieType']=serie.type;dataObject['xField']=xValue;if(serie.yField!=='')dataObject['yField']= +parseFloat(d[name]);if(serie.sizeField!=='')dataObject['sizeField']= +parseFloat(d[serie.sizeField]);if(serie.openField!=='')dataObject['openField']= +parseFloat(d[serie.openField]);if(serie.highField!=='')dataObject['highField']= +parseFloat(d[serie.highField]);if(serie.lowField!=='')dataObject['lowField']= +parseFloat(d[serie.lowField]);if(serie.closeField!=='')dataObject['closeField']= +parseFloat(d[serie.closeField]);if(serie.xErrorField!=='')dataObject['xErrorField']= +parseFloat(d[serie.xErrorField]);if(serie.yErrorField!=='')dataObject['yErrorField']= +parseFloat(d[serie.yErrorField]);return dataObject;})};});this.series.each(function(serie,index){maxValues.push(d3.max(serie.values,function(d){switch(d.serieType){case 'ohlc':case 'candlestick':return parseFloat(d.highField);default:return parseFloat(d.yField);}}));minValues.push(d3.min(serie.values,function(d){switch(d.serieType){case 'ohlc':case 'candlestick':return parseFloat(d.lowField);default:return parseFloat(d.yField);}}));maxXErrors.push(d3.max(serie.values,function(d){return parseFloat(d.xErrorField);}));var serieMin=d3.min(that.series,function(c){return d3.min(c.values,function(v){switch(v.serieType){case 'ohlc':case 'candlestick':return parseFloat(v.lowField);default:return parseFloat(v.yField);}});});var serieMax=d3.max(that.series,function(c){return d3.max(c.values,function(v){switch(v.serieType){case 'ohlc':case 'candlestick':return parseFloat(v.highField);default:return parseFloat(v.yField);}});});serieMax*=1.1;var yErrorMax=d3.max(serie.values,function(d){return parseFloat(d.yErrorField);});serieMax+=yErrorMax===undefined?0:yErrorMax;var sizeMin=d3.min(serie.values,function(d){return parseFloat(d.sizeField);});var sizeMax=d3.max(serie.values,function(d){return parseFloat(d.sizeField);});serie.minSize=sizeMin===undefined?base.series[index].minBulletSize:sizeMin;serie.maxSize=sizeMax===undefined?base.series[index].maxBulletSize:sizeMax;serieMin=base.yAxis.startFromZero?0:serieMin;serieMin-=yErrorMax===undefined?0:yErrorMax;yDomains.push(serieMin);yDomains.push(serieMax);});maxValue=maxValues.max(),minValue=minValues.min(),maxXError=maxXErrors.max(),maxValueLength=(maxValue.toString().length*base.yAxis.labelFontSize/2);switch(base.xAxis.dataType){case 'date':{var xMinDate=d3.min(base.data,function(d){return(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));}),xMaxDate=d3.max(base.data,function(d){return(eve.getType(d[base.xField])==='dateTime'?d[base.xField]:new Date(d[base.xField]));}),dayExtension=Math.ceil(xMaxDate.diff(xMinDate)*.1)*24;if(base.xAxis.startFromZero){xMinDate=new Date(xMinDate.addHours(dayExtension* -1));xMaxDate=new Date(xMaxDate.addHours(dayExtension));}if(isReversed)that.y.domain([xMinDate,xMaxDate]);else that.x.domain([xMinDate,xMaxDate]);}break;case 'string':{if(isReversed){that.y.domain(base.data.map(function(d){return d[base.xField];}));}else{that.x.domain(base.data.map(function(d){return d[base.xField];}));}}break;default:{if(base.xAxis.startFromZero){var xMaxValue=d3.max(base.data,function(d){return d[base.xField];});var xMinValue=0;xMaxValue+=isNaN(maxXError)?0:maxXError;xMinValue-=isNaN(maxXError)?0:maxXError;if(isReversed)that.y.domain([xMinValue,(xMaxValue+1)]);else that.x.domain([xMinValue,(xMaxValue+1)]);}else{var xMinValue=d3.min(base.data,function(d){return d[base.xField];}),xMaxValue=d3.max(base.data,function(d){return d[base.xField];});xMaxValue+=isNaN(maxXError)?0:maxXError;xMinValue-=isNaN(maxXError)?0:maxXError;if(isReversed)that.y.domain([xMinValue,xMaxValue]);else that.x.domain([xMinValue,xMaxValue]);}}}that.y.domain(yDomains);base.plot.canvas.select('.eve-x-axis').transition().duration(base.animationDuration).call(that.xAxis);base.plot.canvas.select('.eve-y-axis').transition().duration(base.animationDuration).call(that.yAxis);xAxis.selectAll('text').style('fill',base.xAxis.labelFontColor).style('font-size',base.xAxis.labelFontSize+'px').style('font-family',base.xAxis.labelFontFamily).style('font-style',base.xAxis.labelFontStlye==='bold'?'normal':base.xAxis.labelFontStlye).style('font-weight',base.xAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');yAxis.selectAll('text').style('fill',base.yAxis.labelFontColor).style('font-size',base.yAxis.labelFontSize+'px').style('font-family',base.yAxis.labelFontFamily).style('font-style',base.yAxis.labelFontStlye==='bold'?'normal':base.yAxis.labelFontStlye).style('font-weight',base.yAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');return this;};this.addTrend=function(trend){if(trend===null)return false;if(trend['startX']===null)return false;if(trend['endX']===null)return false;if(trend['starY']===null)return false;if(trend['endY']===null)return false;addTrend(trend);};};this.plot=new chartPlot();this.createAxis=function(isReversed){return new chartAxis(isReversed);};this.formatNumber=function(value){var result='';if(base.formatNumbers){if(base.prefix.trim()!='')result=base.prefix+' ';result+=parseFloat(value).group(base.decimalSeperator,base.thousandSeperator,base.precision);if(base.suffix.trim()!='')result+=' '+base.suffix;}else{result=value;}return result;};this.formatDate=function(value){return dateFormatter(value);};this.export=function(type,fileName){if(type==null)type='png';if(fileName==null)fileName=this.id;var svg=document.getElementById(this.id+'_svg'),html=d3.select(svg).attr('version',1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;var chartDataURI='data:image/svg+xml;base64,'+btoa(html),canvas=document.createElement('canvas'),context=canvas.getContext('2d');canvas.width=this.plot.width;canvas.height=this.plot.height;var image=new Image;image.src=chartDataURI;image.onload=function(){context.drawImage(image,0,0);if(type!='pdf'){var canvasData=canvas.toDataURL('image/'+type);var canvasBlob=eve.toBlob(canvasData);saveAs(canvasBlob,fileName+'.'+type);}else{var canvasData=canvas.toDataURL('image/jpeg'),width=(canvas.width*25.4)/90,height=(canvas.height*25.4)/90;var pdf=new jsPDF();pdf.addImage(canvasData,'JPEG',0,0,width,height);var pdfDataString=pdf.output('dataurlstring');var pdfBlob=eve.toBlob(pdfDataString,'pdf');saveAs(pdfBlob,fileName+'.pdf');}};};this.resize=function(){var newWidth=this.plot.container.offset().width;this.plot.canvas.attr('width',newWidth).attr('height',newWidth/this.plot.aspectRatio);};this.hideBalloon=function(){this.plot.balloon.style('display','none');};this.showBalloon=function(content){if(content==null)hideBalloon();if(!this.balloon.enabled)hideBalloon();this.plot.balloon.html(content);this.plot.balloon.style('left',(parseInt(d3.event.pageX)+5)+'px');this.plot.balloon.style('top',(parseInt(d3.event.pageY)+5)+'px');this.plot.balloon.style('display','block');};this.setBalloonContent=function(cfg){if(arguments.length===0)return '';var formatted=cfg.format;switch(cfg.type){case 'pie':case 'donut':case 'funnel':case 'pyramid':{var data=this.data[cfg.dataIndex],serie=cfg.serie,totalValue=d3.sum(this.data,function(d){return d[serie.valueField];}),currentValue=data[serie.valueField]===null?0:data[serie.valueField],percentValue=currentValue/totalValue*100;if(serie['titleField']!=null)formatted=formatted.replaceAll('{{title}}',data[serie.titleField]==null?'':data[serie.titleField]);if(serie['valueField']!=null)formatted=formatted.replaceAll('{{value}}',(this.formatNumbers?currentValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):currentValue));if(serie['alphaField']!=null)formatted=formatted.replaceAll('{{alpha}}',(this.formatNumbers?data[serie.alphaField].group(this.decimalSeperator,this.thousandSeperator,this.precision):data[serie.alphaField]));if(serie['colorField']!=null)formatted=formatted.replaceAll('{{color}}',data[serie.colorField]==null?'':data[serie.colorField]);if(totalValue!=null)formatted=formatted.replaceAll('{{total}}',(this.formatNumbers?totalValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):totalValue));if(percentValue!=null)formatted=formatted.replaceAll('{{percent}}','%'+percentValue.group(this.decimalSeperator,this.thousandSeperator,this.precision));}break;case 'gauge':{var data=cfg.data,serie=cfg.serie;formatted=formatted.replaceAll('{{value}}',this.formatNumber(data.value));formatted=formatted.replaceAll('{{percent}}','%'+data.percent);formatted=formatted.replaceAll('{{max}}',this.formatNumber(data.max));formatted=formatted.replaceAll('{{min}}',this.formatNumber(data.min));if(data.trend!=null){formatted=formatted.replaceAll('{{trendTitle}}',data.trend.title);formatted=formatted.replaceAll('{{trendStart}}',this.formatNumber(data.trend.start));formatted=formatted.replaceAll('{{trendEnd}}',this.formatNumber(data.trend.end));}}break;case 'bullet':{var ranges=[],data=cfg.data,serie=cfg.serie,markerValue=data[serie.markerField]===null?'':data[serie.markerField],exactValue=data[serie.valueField]===null?'':data[serie.valueField],title=data[serie.titleField]===null?'':data[serie.titleField];serie.rangeFields.each(function(rangeField,rangeIndex){var rangeValue=data[rangeField]===null?'':data[rangeField],rangeFormatted=this.formatNumbers?rangeValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):rangeValue;ranges.push(rangeFormatted);if(formatted.indexOf('range'+rangeIndex)!== -1)formatted=formatted.replaceAll('{{range'+rangeIndex+'}}',rangeFormatted);});if(formatted.indexOf('{{ranges}}')!== -1&&ranges.length>0)formatted=formatted.replaceAll('{{ranges}}',ranges.join(' - '));if(data[serie.titleField]!=null)formatted=formatted.replaceAll('{{title}}',title);if(data[serie.markerField]!=null)formatted=formatted.replaceAll('{{marker}}',(this.formatNumbers?markerValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):markerValue));if(data[serie.valueField]!=null)formatted=formatted.replaceAll('{{value}}',(this.formatNumbers?exactValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):exactValue));if(data['sizeField']!=null)formatted=formatted.replaceAll('{{size}}',(this.formatNumbers?sizeValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):sizeValue));}break;case 'parallel':{var measuresText='',data=cfg.data,serie=cfg.serie,dimension=data[serie.dimensionField]==null?'':data[serie.dimensionField];serie.measureFields.each(function(m,i){var measure={key:m,val:data[m]},text=measure.key+': '+measure.val;measuresText+=text+'<br/>';formatted=formatted.replaceAll('{{'+m+'}}',measure.val);formatted=formatted.replaceAll('{{measureName'+i+'}}',measure.key);formatted=formatted.replaceAll('{{measureValue'+i+'}}',measure.val);});formatted=formatted.replaceAll('{{dimension}}',dimension);formatted=formatted.replaceAll('{{measures}}',measuresText);}break;default:{var data=cfg.data,serie=cfg.serie,xValue=data['xField']==null?'':data['xField'],yValue=data['yField']==null?'':data['yField'],sizeValue=data['sizeField']==null?'':data['sizeField'],xError=data['xErrorField']==null?'':data['xErrorField'],yError=data['yErrorField']==null?'':data['yErrorField'],openValue=data['openField']==null?'':data['openField'],highValue=data['highField']==null?'':data['highField'],lowValue=data['lowField']==null?'':data['lowField'],closeValue=data['closeField']==null?'':data['closeField'],serieName=data['name']==null?'':data['name'];if(this.xAxis.dataType==='date')xValue=this.formatDate(xValue);if(data['xField']!=null)formatted=formatted.replaceAll('{{title}}',xValue);if(data['xField']!=null)formatted=formatted.replaceAll('{{x}}',xValue);if(data['name']!=null)formatted=formatted.replaceAll('{{serie}}',serieName);if(data['yField']!=null)formatted=formatted.replaceAll('{{value}}',(this.formatNumbers?yValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):yValue));if(data['yField']!=null)formatted=formatted.replaceAll('{{y}}',(this.formatNumbers?yValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):yValue));if(data['xErrorField']!=null)formatted=formatted.replaceAll('{{xError}}',xError);if(data['yErrorField']!=null)formatted=formatted.replaceAll('{{yError}}',yError);if(data['openField']!=null)formatted=formatted.replaceAll('{{open}}',(this.formatNumbers?openValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):openValue));if(data['highField']!=null)formatted=formatted.replaceAll('{{high}}',(this.formatNumbers?highValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):highValue));if(data['lowField']!=null)formatted=formatted.replaceAll('{{low}}',(this.formatNumbers?lowValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):lowValue));if(data['closeField']!=null)formatted=formatted.replaceAll('{{close}}',(this.formatNumbers?closeValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):closeValue));if(data['sizeField']!=null)formatted=formatted.replaceAll('{{size}}',(this.formatNumbers?sizeValue.group(this.decimalSeperator,this.thousandSeperator,this.precision):sizeValue));}break;}return formatted;};};function balloon(options){this.backColor='#ffffff';this.borderColor='#0066cc';this.borderRadius=3;this.borderSize=2;this.borderStyle='solid';this.enabled=true;this.fontColor='#333333';this.fontFamily='Tahoma';this.fontSize=12;this.fontStyle='normal';this.format='{{title}}: {{value}}';this.opacity=0.9;this.padding=5;for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function legend(options){this.enabled=true;this.fontColor='#333333';this.fontFamily='Tahoma';this.fontSize=12;this.fontStyle='normal';this.format='{{title}}';this.iconType='square';this.position='right';for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function trend(options){this.start=null;this.end=null;this.startX=null;this.endX=null;this.startY=null;this.endY=null;this.lineDrawingStyle='solid';this.title='';this.fontColor='#333333';this.fontSize=11;this.fontStyle='normal';this.fontFamily='Tahoma';this.color='';this.thickness=0;this.balloonFormat='{{title}}<br/>{{start}} - {{end}}';this.startBalloonFormat='{{title}}<br/>{{startX}} - {{startY}}';this.endBalloonFormat='{{title}}<br/>{{startY}} - {{endY}}';for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function slice(options){this.colorField='';this.alphaField='';this.hoverOpacity=0.9;this.labelPosition='inside';this.labelFontColor='#ffffff';this.labelFontFamily='Tahoma';this.labelFontSize=11;this.labelFontStyle='normal';this.labelFormat='{{percent}}';this.labelsEnabled=true;this.sliceBorderColor='#ffffff';this.sliceBorderOpacity=0.1;this.titleField='';this.valueField='';};function pieSerie(options){this.innerRadius=0;this.type='pie';eve.extend(this,new slice(options));for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function funnelSerie(options){this.neckHeight=0;this.type='funnel';eve.extend(this,new slice(options));for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function gaugeSerie(options){this.behavior='standard';this.min=0;this.max=100;this.value=0;this.color='#006600';this.handleColor='#006600';this.handleFontColor='#666666';this.handleFontFamily='Tahoma';this.handleFontStyle='normal';this.handleCircleColor='#f2f2f2';this.handleCircleBorderColor='#cdcdcd';this.handleCircleSize=15;this.label='';this.labelFontColor='#999999';this.labelFontFamily='Tahoma';this.labelFontStyle='normal';this.minText='Min';this.maxText='Max';this.majorTicks=5,this.minorTicks=5,this.trendHeight=10,this.innerRadius=0,this.gaugeBackColor='#f2f2f2';this.gaugeBorderColor='#cdcdcd';this.gaugeBorderSize=1,this.innerBackColor='#ffffff';this.innerBorderColor='#e0e0e0';this.innerBorderSize=1,this.minorTickColor='#aaaaaa';this.minorTickSize=1,this.majorTickColor='#999999';this.majorTickSize=2;this.type='gauge';for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function axisBase(options){this.alpha=1;this.color='#cccccc';this.gridLineColor='#cccccc';this.gridLineThickness=.5;this.gridLineAlpha=0.5;this.labelFontColor='#999999';this.labelFontFamily='Tahoma';this.labelFontSize=10;this.labelFontStyle='normal';this.startFromZero=true;this.tickCount=10;this.title='';this.titleFontColor='#666666';this.titleFontFamily='Tahoma';this.titleFontSize=11;this.titleFontStyle='bold';this.thickness=1;};function xAxis(options){this.dataType='number';eve.extend(this,new axisBase(options));for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function yAxis(options){this.isStacked=true;eve.extend(this,new axisBase(options));for(var key in options){if(this[key]!==undefined||this[key]!==null)this[key]=options[key];};};function xySerie(options){this.alpha=.8;this.bullet='none';this.bulletAlpha=.5;this.bulletColor='';this.bulletSize=8;this.bulletStrokeSize=1;this.bulletStrokeAlpha=1;this.color='';this.lineColor='#000000';this.lineDrawingStyle='solid';this.lineSize=1.5;this.lineAlpha=1;this.lineType='linear';this.minBulletSize=5;this.maxBulletSize=50;this.sizeField='';this.title='';this.type='line';this.yField='';this.closeField='';this.highField='';this.lowField='';this.openField='';this.upDayColor='#83AA30';this.downDayColor='#1499D3';this.totalText='Total';this.negativeColor='#FF6464';this.positiveColor='#83AA30';this.totalColor='#1499D3';this.valueFontColor='#ffffff';this.valueFontFamily='Tahoma';this.valueFontSize=13;this.valueFontStyle='bold';this.errorDrawingStyle='dashed';this.xErrorField='';this.yErrorField='';for(var key in options){if(this[key]!==undefined||this[key]!==null){switch(key){default:this[key]=options[key];break;}}};};function bulletSerie(options){this.color=eveCharts.charts.colors[0];this.colorField='';this.labelFontColor='#333333';this.labelFontFamily='Tahoma';this.labelFontSize=11;this.labelFontStyle='normal';this.markerColor='#000000';this.markerField='';this.markerFormat='{{title}}: {{marker}}';this.markerWidth=2;this.rangeColor='#cdcdcd';this.rangeFields=[];this.titleField='';this.titleFontColor='#666666';this.titleFontFamily='Tahoma';this.titleFontSize=14;this.titleFontStyle='bold';this.valueField='';this.valueFormat='{{title}}: {{value}}';for(var key in options){if(this[key]!==undefined||this[key]!==null){switch(key){default:this[key]=options[key];break;}}};};function parallelSerie(options){this.brushAlpha=0.3;this.brushBorderColor='#ffffff';this.brushColor='#0066CC';this.colorField='';this.dimensionField='';this.lineAlpha=0.8;this.lineDrawingStyle='solid';this.lineSize=2.5;this.measureFields=[];for(var key in options){if(this[key]!==undefined||this[key]!==null){switch(key){default:this[key]=options[key];break;}}};};eveCharts.charts={configurator:chart};})(eve); (function(eveCharts){eveCharts.instances={};eveCharts.version='0.0.1 beta';eveCharts.constants={min:'Min',max:'Max',total:'Total',average:'Average',sum:'Sum',count:'Count',records:'Records'};eveCharts.colors=['#83AA30','#1499D3','#4D6684','#3D3D3D','#B9340B','#CEA45C','#C5BE8B','#498379','#3F261C','#E74700','#F1E68F','#FF976F','#FF6464','#554939','#706C4D'];eveCharts.getChartCount=function(){var chartCount=0;for(var key in this.instances){if(key.indexOf('eveCharts')> -1)chartCount++;};return chartCount;};eveCharts.remove=function(chart){if(this.instances[chart.id])delete this.instances[chart.id];};})(eve.charts); (function(eveCharts){function areaChart(chart,isStream){var plot=chart.plot,axis,areaSeries,areaBullets,areaPoints;var stack=d3.layout.stack().values(function(d){return d.values;}).x(function(d){return axis.x(d.xField);}).y(function(d){return axis.y(d.yField);});var areaF=d3.svg.area().x(function(d){return axis.x(d.xField);}).y0(function(d){return axis.y(d.y0);}).y1(function(d){return axis.y(d.y0+d.y);});var lineBullet=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){return Math.pow(chart.series[d.index].bulletSize+4,2);});function createAreaSeries(){areaSeries=plot.canvas.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');areaSeries.append('path').attr('class',function(d,i){return 'eve-area-serie eve-area-serie-'+i;}).attr('d',function(d,i){if(chart.series[i].lineType==='stepLine')areaF.interpolate('step');else if(chart.series[i].lineType==='spLine')areaF.interpolate('cardinal');return areaF(d.values);}).attr('transform','translate('+axis.offset.left+')').style('fill',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).style('stroke-width',function(d,i){return chart.series[i].lineSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].lineAlpha;}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;});areaBullets=areaSeries.selectAll('.eve-area-points').data(axis.series).enter().append('g').attr('class','eve-area-points');areaPoints=areaBullets.selectAll('.eve-area-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-area-point eve-are-point-'+d.index;}).attr('d',lineBullet).style('cursor','pointer').style('fill',function(d){return '#ffffff';if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}).style('stroke',function(d){if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}).style('stroke-width',function(d){return chart.series[d.index].bulletStrokeSize+'px';}).style('stroke-opacity',0).style('fill-opacity',0).attr('transform',function(d){return 'translate('+(axis.x(d.xField)+axis.offset.left)+','+axis.y(d.y0+d.y)+')';}).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});if(chart.series[d.index].color==='')serieColor=d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else serieColor=chart.series[d.index].color;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).style('stroke-opacity',chart.series[d.index].bulletAlpha).style('fill-opacity',chart.series[d.index].alpha);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize).style('stroke-opacity',0).style('fill-opacity',0);});};function init(){axis=chart.createAxis();if(isStream)stack.offset('wiggle');stack(axis.series);axis.y.domain([0,d3.max(axis.series,function(d){return d3.max(d.values,function(d2){return d2.y0+d2.y;});})]);createAreaSeries();};init();return chart;};eveCharts.area=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='area';});}var area=areaChart(new this.configurator(options),false);if(area!==null)this.instances[area.id]=area;return area;}else{return null;}};eveCharts.stream=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='area';});}var stream=areaChart(new this.configurator(options),true);if(stream!==null)this.instances[stream.id]=stream;return stream;}else{return null;}};})(eve.charts); (function(eveCharts){function barChart(chart,isReversed){var plot=chart.plot,axis,groupAxis,stackedBars,stackedBarsRects,groupedBars,groupedBarsRects;function createStackedBars(){chart.data.each(function(d){var y0=0;d.values=axis.serieNames.map(function(name){var dataObj={name:'name',xField:d[chart.xField],yField: +d[name],y0:y0,y1:y0+= +d[name]};return dataObj;});d.total=d.values[d.values.length-1].y1;});if(isReversed)axis.x.domain([0,d3.max(chart.data,function(d){return d.total;})]);else axis.y.domain([0,d3.max(chart.data,function(d){return d.total;})]);if(isReversed){plot.canvas.select('.eve-x-axis').call(axis.xAxis).selectAll('text').style('fill',chart.xAxis.labelFontColor).style('font-size',chart.xAxis.labelFontSize+'px').style('font-family',chart.xAxis.labelFontFamily).style('font-style',chart.xAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.xAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');}else{plot.canvas.select('.eve-y-axis').call(axis.yAxis).selectAll('text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.yAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');}stackedBars=plot.canvas.selectAll('.eve-series').data(chart.data).enter().append('g').attr('class','eve-series').attr('transform',function(d){if(isReversed){if(chart.xAxis.dataType==='number')return 'translate('+axis.offset.left+','+(axis.y(d[chart.xField])-(groupAxis.rangeBand()/2))+')';else return 'translate('+axis.offset.left+','+(axis.y(d[chart.xField])+(groupAxis.rangeBand()/2))+')';}else{if(chart.xAxis.dataType==='number')return 'translate('+(axis.x(d[chart.xField])+axis.offset.left-groupAxis.rangeBand()/2)+',0)';else return 'translate('+(axis.x(d[chart.xField])+axis.offset.left+groupAxis.rangeBand()/2)+',0)';}});stackedBarsRects=stackedBars.selectAll('rect').data(function(d){return d.values;}).enter().append('rect').attr('class',function(d,i){return 'eve-bar-serie eve-bar-serie-'+i;}).attr('width',function(d){return isReversed?(axis.x(d.y1)-axis.x(d.y0)):groupAxis.rangeBand();}).attr('height',function(d){return isReversed?groupAxis.rangeBand():(axis.y(d.y0)-axis.y(d.y1));}).style('fill',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;}).style('stroke-width',function(d,i){return chart.series[i].lineSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].lineAlpha;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});;if(chart.series[i].color==='')serieColor=i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else serieColor=chart.series[i].color;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',chart.series[i].bulletStrokeSize+1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',chart.series[i].bulletStrokeSize);});if(isReversed){stackedBarsRects.attr('x',function(d){return axis.x(d.y0);});}else{stackedBarsRects.attr('y',function(d){return axis.y(d.y1);});}};function createGroupedBars(){chart.data.each(function(d){d.values=axis.serieNames.map(function(name){return{name:name,xField:d[chart.xField],yField: +d[name]};})});var newYDomain=[0,d3.max(chart.data,function(d){return d3.max(d.values,function(d2){return d2.yField*1.1;});})];if(isReversed){newYDomain=[d3.max(chart.data,function(d){return d3.max(d.values,function(d2){return d2.yField*1.1;});}),0];axis.x.domain(newYDomain);}else{axis.y.domain(newYDomain);}var rangeBand=groupAxis.rangeBand();groupedBars=plot.canvas.selectAll('.eve-series').data(chart.data).enter().append('g').attr('class','eve-series').attr('transform',function(d){if(isReversed)return 'translate('+(axis.offset.left)+','+(axis.y(d[chart.xField]))+')';else return 'translate('+(axis.x(d[chart.xField])+axis.offset.left)+',0)';});groupedBarsRects=groupedBars.selectAll('rect').data(function(d){return d.values;}).enter().append('rect').attr('class',function(d,i){return 'eve-bar-serie eve-bar-serie-'+i;}).attr('width',function(d){return isReversed?(axis.offset.width-axis.x(d.yField)):rangeBand;}).attr('x',function(d){return isReversed?0:groupAxis(d.name);}).attr('y',function(d){return isReversed?groupAxis(d.name):axis.y(d.yField);}).attr('height',function(d){return isReversed?rangeBand:(axis.offset.height-axis.y(d.yField));}).style('fill',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;}).style('stroke-width',function(d,i){return chart.series[i].lineSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].lineAlpha;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});;if(chart.series[i].color==='')serieColor=i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else serieColor=chart.series[i].color;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',chart.series[i].bulletStrokeSize+1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',chart.series[i].bulletStrokeSize);});};function init(){var rangeBand=0,barPadding=25;axis=chart.createAxis(isReversed);switch(chart.xAxis.dataType){case 'string':rangeBand=isReversed?axis.y.rangeBand():axis.x.rangeBand();break;case 'date':rangeBand=(isReversed?plot.height:plot.width)/chart.data.length-barPadding+(barPadding/axis.series.length);break;default:rangeBand=(isReversed?plot.height:plot.width)/chart.data.length-barPadding+(barPadding/axis.series.length);break;}groupAxis=d3.scale.ordinal().domain(axis.serieNames).rangeRoundBands([0,rangeBand]);if(chart.yAxis.isStacked)createStackedBars();else createGroupedBars();};init();return chart;};eveCharts.bar=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='bar';});}var config=new this.configurator(options);config.xAxis.dataType='string';var bar=barChart(config,true);if(bar!==null)this.instances[bar.id]=bar;return bar;}else{return null;}};eveCharts.column=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='bar';});}var config=new this.configurator(options);config.xAxis.dataType='string';var column=barChart(config,false);if(column!==null)this.instances[column.id]=column;return column;}else{return null;}};})(eve.charts); (function(eveCharts){function bulletChart(chart){var plot=chart.plot,serie=chart.series[0],maxTextLength=0,sectorHeight=(plot.height-chart.margin.top-chart.margin.bottom)/chart.data.length,itemHeight=sectorHeight-sectorHeight*.1-serie.labelFontSize-5,itemWidth=0,arrRanges=[],arrMeasures=[],arrMarkers=[],arrTickLines=[],arrTickLabels=[],arrDomains=[];plot.canvas.attr('transform','translate('+chart.margin.left+','+chart.margin.top+')');function getRanges(data){var ranges=[];serie.rangeFields.each(function(rangeField){if(data[rangeField]!==null)ranges.push(parseFloat(data[rangeField]));});return ranges.sort(d3.descending);};function init(){var labels=plot.canvas.selectAll('.bullet-label').data(chart.data);labels.enter().append('text').attr('class','bullet-label').style('fill',serie.titleFontColor).style('font-weight',serie.titleFontStyle=='bold'?'bold':'normal').style('font-style',serie.titleFontStyle=='bold'?'normal':serie.titleFontStyle).style("font-family",serie.titleFontFamily).style("font-size",serie.titleFontSize+'px').text(function(d){return d[serie.titleField];}).attr('transform',function(d,i){var bbox=this.getBBox();if(bbox.width>maxTextLength)maxTextLength=bbox.width;var ypos=sectorHeight*i+sectorHeight/2-bbox.height/2+chart.margin.top;return 'translate('+chart.margin.left+', '+ypos+')';});itemWidth=plot.width-maxTextLength-(chart.margin.left*2)-chart.margin.right;chart.data.each(function(d,i){var ranges=getRanges(d),marker=d[serie.markerField]===null?0:parseFloat(d[serie.markerField]),value=d[serie.valueField]===null?0:parseFloat(d[serie.valueField]),maxWidth=Math.max(ranges[0],marker,value),xDomain=d3.scale.linear().domain([0,maxWidth]).range([0,itemWidth]);arrDomains.push(xDomain);var rangeRects=plot.canvas.selectAll('.bullet-range-'+i).data(ranges);rangeRects=rangeRects.enter().append('rect').style('fill',serie.rangeColor).style('fill-opacity',function(r,j){return(j+1)/ranges.length;}).attr('class','bullet-range-'+i).attr('width',function(r,j){return r/maxWidth*itemWidth;}).attr('height',itemHeight).attr('transform',function(){var xpos=maxTextLength+chart.margin.left,ypos=((itemHeight+(sectorHeight*.1)+serie.labelFontSize+5)*i);return 'translate('+xpos+','+ypos+')'});arrRanges.push(rangeRects);var measureRect=plot.canvas.append('rect').style('fill',serie.color).style('cursor','pointer').attr('width',value/maxWidth*itemWidth).attr('height',itemHeight-(itemHeight*.3)).attr('transform',function(){var xpos=maxTextLength+chart.margin.left,ypos=(((itemHeight+(sectorHeight*.1)+serie.labelFontSize+5)*i)+(itemHeight*.3)/2);return 'translate('+xpos+','+ypos+')'}).on('mousemove',function(){var serieColor='',balloonContent=chart.setBalloonContent({type:'bullet',data:d,format:serie.valueFormat,dataIndex:i,serie:serie});if(serie.colorField!==''){serieColor=d[serie.colorField];}else{if(serie.color==='')serieColor=eve.randomColor();else serieColor=serie.color;}plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).attr('fill-opacity',.9);}).on('mouseout',function(){chart.hideBalloon();d3.select(this).attr('fill-opacity',1);});arrMeasures.push(measureRect);var markerRect=plot.canvas.append('rect').style('fill',serie.markerColor).style('cursor','pointer').attr('width',serie.markerWidth).attr('height',itemHeight-(itemHeight*.3)).attr('transform',function(){var xpos=(maxTextLength+chart.margin.left+(marker/maxWidth*itemWidth)),ypos=(((itemHeight+(sectorHeight*.1)+serie.labelFontSize+5)*i)+(itemHeight*.3)/2);return 'translate('+xpos+','+ypos+')'}).on('mousemove',function(){var serieColor=serie.markerColor!==''?serie.markerColor:eve.randomColor(),balloonContent=chart.setBalloonContent({type:'bullet',data:d,format:serie.markerFormat,dataIndex:i,serie:serie});plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).attr('fill-opacity',.9);}).on('mouseout',function(){chart.hideBalloon();d3.select(this).attr('fill-opacity',1);});arrMarkers.push(markerRect);var tickLines=plot.canvas.selectAll('.bullet-tick-line-'+i).data(xDomain.ticks(10)),tickLabels=plot.canvas.selectAll('.bullet-tick-text-'+i).data(xDomain.ticks(10));tickLines.enter().append('rect').style('fill','#aaaaaa').attr('width',1).attr('height',5).attr('transform',function(t,j){var xpos=(maxTextLength+chart.margin.left+(t/maxWidth*itemWidth)),ypos=itemHeight+((itemHeight+(sectorHeight*.1)+serie.labelFontSize+5)*i);return 'translate('+xpos+','+ypos+')';});tickLabels.enter().append('text').style('fill',serie.labelFontColor).style('font-size',serie.labelFontSize+'px').style('font-family',serie.labelFontFamily).style('font-style',serie.labelFontStlye==='bold'?'normal':serie.labelFontStlye).style('font-weight',serie.labelFontStlye==='bold'?'bold':'normal').style('text-anchor',function(t,j){if(j===0)return 'start';else if(j===xDomain.ticks(10).length-1)return 'end';else return 'middle';}).text(function(t,j){return t;}).attr('transform',function(t,j){var xpos=(maxTextLength+chart.margin.left+(t/maxWidth*itemWidth)),ypos=itemHeight+((itemHeight+(sectorHeight*.1)+serie.labelFontSize+5)*i)+serie.labelFontSize+5;return 'translate('+xpos+','+ypos+')';});arrTickLabels.push(tickLabels);arrTickLines.push(tickLines);});};init();return chart;};eveCharts.bullet=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='bullet';});}var bullet=bulletChart(new this.configurator(options));if(bullet!==null)this.instances[bullet.id]=bullet;return bullet;}else{return null;}};})(eve.charts); (function(eveCharts){function funnelChart(chart){var plot=chart.plot,baseData=chart.data,serie=chart.series[0],legendIcons=null,legendTexts=null,base=this,slices,labels,lines,neck;if(serie.type!=='funnel'&&serie.type!=='pyramid'){throw new Error('Serie type mistmatch! When creating a funnel chart, serie type should be set as "funnel" or "pyramid"...');return null;}function init(){var legendWidth=0,legendHeight=0,alphaMin=0,alphaMax=0,totalData=d3.sum(chart.data,function(d){return d[serie.valueField];}),gradePercent=1/10,funnelWidth=plot.width-chart.margin.left-chart.margin.right,funnelHeight=plot.height-chart.margin.top-chart.margin.bottom,transX=chart.margin.left,transY=chart.margin.top;if(serie.alphaField!==''){alphaMin=d3.min(chart.data,function(d){return d[serie.alphaField];});alphaMax=d3.max(chart.data,function(d){return d[serie.alphaField];});}if(serie.type==='pyramid')gradePercent=1/200;var funnel=d3.svg.line().x(function(d){return d[0];}).y(function(d){return d[1];});function getPaths(){var paths=[],pathPoints=[];function createPathPoints(ll,lr,lh,i){if(i>=chart.data.length)return;v=chart.data[i][serie.valueField];a=v*totalArea/totalData;pw=lr-ll;nw=Math.sqrt((grade*pw*pw-4*a)/grade);nl=(pw-nw)/2+ll;nr=lr-(pw-nw)/2;nh=(grade*(pw-nw)/2+lh);pathPoints=[[nr,nh]];pathPoints.push([lr,lh]);pathPoints.push([ll,lh]);pathPoints.push([nl,nh]);pathPoints.push([nr,nh]);paths.push(pathPoints);createPathPoints(nl,nr,nh,i+1);};createPathPoints(0,funnelWidth,0,0);return paths;};plot.canvas.append('g').attr('class','eve-funnel-slices');if(chart.legend.enabled){plot.canvas.append('g').attr('class','eve-legend-icon');plot.canvas.append('g').attr('class','eve-legend-text');var symbolSize=Math.pow(chart.legend.fontSize,2);legendWidth=chart.legend.fontSize+5;legendHeight=chart.data.length*chart.legend.fontSize;legendTexts=plot.canvas.select('.eve-legend-text').selectAll('text.eve-legend-text').data(chart.data);legendIcons=plot.canvas.select('.eve-legend-icon').selectAll('path.eve-legend-icon').data(chart.data);legendTexts.enter().insert('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').style("text-anchor",'left').text(function(d,i){return chart.setBalloonContent({type:'funnel',format:chart.legend.format,dataIndex:i,data:d,serie:serie});});legendTexts[0].each(function(legendText){var bboxWidth=legendText.getBBox().width+chart.legend.fontSize+5;if(bboxWidth>legendWidth)legendWidth=bboxWidth;});legendIcons.enter().insert('path').attr('d',d3.svg.symbol().type(chart.legend.iconType).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(slices!==undefined)return d3.select(slices[0][i]).style('fill');if(serie.colorField!=='')return d[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();});legendIcons.exit().remove();legendTexts.exit().remove();}if(chart.legend.enabled)funnelWidth-=legendWidth*2;if(serie.type==='funnel'&&serie.neckHeight>0)funnelHeight-=serie.neckHeight;var grade=2*funnelHeight/(funnelWidth-gradePercent*funnelWidth),totalArea=(funnelWidth+gradePercent*funnelWidth)*funnelHeight/2,paths=getPaths();plot.canvas.attr('transform','translate('+transX+', '+transY+')');slices=plot.canvas.select('.eve-funnel-slices').selectAll('path.eve-funnel-slice').data(chart.data);slices.enter().insert('path').attr('class',function(d,i){return 'eve-funnel-slice eve-funnel-slice-'+i;}).attr('d',function(d,i){return funnel(paths[i]);}).style('fill',function(d,i){if(serie.colorField!=='')return d[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();}).style('fill-opacity',function(d,i){if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).style("stroke-width",0).on('mousemove',function(d,i){var dataColor='';var balloonContent=chart.setBalloonContent({type:'funnel',data:d,dataIndex:i,serie:serie,format:chart.balloon.format});if(serie.colorField!=='')dataColor=d[serie.colorField];else dataColor=i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();plot.balloon.style('borderColor',dataColor);chart.showBalloon(balloonContent);d3.select(this).style('opacity',serie.hoverOpacity);if(neck!==undefined&&i===chart.data.length-1)neck.style('opacity',serie.hoverOpacity);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('opacity',1);if(neck!==undefined&&i===chart.data.length-1)neck.style('opacity',1);});if(serie.type==='funnel'&&serie.neckHeight>0){var lastVal=chart.data[chart.data.length-1][serie.valueField],lfp=slices[0][chart.data.length-1].getBBox(),neckY=lfp.height+lfp.y,neckH=serie.neckHeight,lfpArea=lastVal*totalArea/totalData,neckW=Math.sqrt((grade*lfp.width*lfp.width-4*lfpArea)/grade),neckX=lfp.x+lfp.width/2-neckW/2;neck=plot.canvas.insert('rect').style('fill',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;if(serie.colorField!=='')return d[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();}).style('fill-opacity',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).style("stroke-width",0).attr('width',neckW).attr('height',neckH).attr('y',neckY).attr('x',neckX).on('mousemove',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;var dataColor='';var balloonContent=chart.setBalloonContent({type:'funnel',data:d,dataIndex:i,serie:serie,format:chart.balloon.format});if(serie.colorField!=='')dataColor=d[serie.colorField];else dataColor=i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();plot.balloon.style('borderColor',dataColor);chart.showBalloon(balloonContent);d3.select(this).style('opacity',serie.hoverOpacity);if(i===chart.data.length-1)d3.select(slices[0][chart.data.length-1]).style('opacity',serie.hoverOpacity);}).on('mouseout',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;chart.hideBalloon();d3.select(this).style('opacity',1);if(i===chart.data.length-1)d3.select(slices[0][chart.data.length-1]).style('opacity',1);})}if(serie.type==='pyramid'){slices.attr('transform','translate('+(funnelWidth)+','+(funnelHeight)+')rotate(180)');}slices.exit().remove();if(chart.legend.enabled){if(chart.legend.position==='right'){legendIcons.attr('transform',function(d,i){var x=funnelWidth+10,y=funnelHeight/2-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('x',funnelWidth+chart.legend.fontSize+10).attr('y',function(d,i){return funnelHeight/2-legendHeight+(chart.legend.fontSize/3)+(chart.legend.fontSize*i)*2;});}else{legendIcons.attr('transform',function(d,i){var x=chart.margin.left,y=funnelHeight/2-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('x',chart.margin.left+10).attr('y',function(d,i){return funnelHeight/2-legendHeight+(chart.legend.fontSize*i)*2;});}}if(serie.labelsEnabled){plot.canvas.append('g').attr('class','eve-funnel-labels');labels=plot.canvas.select('.eve-funnel-labels').selectAll('text').data(chart.data);labels.enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').style('text-anchor','left').text(function(d,i){return chart.setBalloonContent({type:'funnel',format:serie.labelFormat,dataIndex:i,data:d,serie:serie});}).attr('transform',function(d,i){var fSlice=slices[0][i].getBBox(),bbox=this.getBBox(),xPos=funnelWidth/2-bbox.width/2,yPos=fSlice.y+fSlice.height/2+bbox.height/2;if(serie.type==='pyramid')yPos=(funnelHeight-fSlice.y)-fSlice.height/2+bbox.height/2;return 'translate('+xPos+','+yPos+')';});}};init();return chart;};eveCharts.funnel=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='funnel';});}var funnel=funnelChart(new this.configurator(options));if(funnel!==null)this.instances[funnel.id]=funnel;return funnel;}else{return null;}};eveCharts.pyramid=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='pyramid';});}var pyramid=funnelChart(new this.configurator(options));if(pyramid!==null)this.instances[pyramid.id]=pyramid;return pyramid;}else{return null;}};})(eve.charts); (function(eveCharts){function gaugeChart(chart){var plot=chart.plot,serie=chart.series[0],baseValue=serie.value,trendHeight=chart.trends.length>0?serie.trendHeight:0,size=Math.min(plot.width-chart.margin.left-chart.margin.right,plot.height-chart.margin.top-chart.margin.bottom),percentValue=getPercent(serie.value),minValue=chart.formatNumber(serie.min),maxValue=chart.formatNumber(serie.max),range=serie.max-serie.min,majorDelta=range/(serie.majorTicks-1),radius,innerRadius,btx,bty,titleTextSize,handleTextSize,valueTextSize,labelTextSize,matchTrend=null,gaugeValueHandle=null,gaugeValueHandleCircle=null,gaugeValueText=null,standardGaugeArc=null,standardGaugeInnerArc=null,base=this;if(serie.type!=='gauge'){throw new Error('Serie type mistmatch! When creating a gauge chart, serie type should be set as "gauge"...');return null;}function getPercent(value){var percent=value/range*100-(serie.min/range*100);return percent;};function standardGaugeTween(b){var interpolated=d3.interpolate(0,b);return function(t){return standardGaugeInnerArc(interpolated(t));}};function convertToDegrees(val){return val/range*270-(serie.min/range*270+45);};function convertToRadians(val){return convertToDegrees(val)*Math.PI/180;};function convertToPoint(val,factor){return{x:btx-radius*factor*Math.cos(convertToRadians(val)),y:bty-radius*factor*Math.sin(convertToRadians(val))};};function getNeedlePath(val){var _delta=range/13,_head=valueToPoint(val,0.85),_head1=valueToPoint(val-_delta,0.12),_head2=valueToPoint(val+_delta,0.12),_tailValue=val-(range*(1/(270/360))/2),_tail=valueToPoint(_tailValue,0.28),_tail1=valueToPoint(_tailValue-_delta,0.12),_tail2=valueToPoint(_tailValue+_delta,0.12);function valueToPoint(value,factor){var point=convertToPoint(value,factor);point.x-=btx;point.y-=bty;return point;};return[_head,_head1,_tail2,_tail,_tail1,_head2,_head];};function initGauge(){size=Math.min(plot.width-chart.margin.left-chart.margin.right,plot.height-chart.margin.top-chart.margin.bottom);percentValue=getPercent(baseValue);minValue=chart.formatNumber(serie.min);maxValue=chart.formatNumber(serie.max);range=serie.max-serie.min;majorDelta=range/(serie.majorTicks-1);switch(serie.behavior){case 'standard':{radius=(size-trendHeight)/2;innerRadius=serie.innerRadius==0?(radius/2):serie.innerRadius;btx=(plot.width+chart.margin.left-chart.margin.right-trendHeight)/2;bty=(plot.height+chart.margin.top-chart.margin.bottom+innerRadius)/2;titleTextSize=radius/4;handleTextSize=titleTextSize*.5;labelTextSize=titleTextSize*.4;valueTextSize=titleTextSize*.9;}break;case 'dial':{radius=size/2;btx=(plot.width+chart.margin.left-chart.margin.right)/2;bty=(plot.height+chart.margin.top-chart.margin.bottom)/2;titleTextSize=size/12;handleTextSize=size/20;labelTextSize=size/20;valueTextSize=size/11;}break;}standardGaugeArc=d3.svg.arc().outerRadius(radius).innerRadius(innerRadius).startAngle(0).endAngle(Math.PI);standardGaugeInnerArc=d3.svg.arc().outerRadius(radius).innerRadius(innerRadius).startAngle(0).endAngle(function(d){return d/100*Math.PI});switch(serie.behavior){case 'standard':initStandard();break;case 'dial':initDial();break;}update(baseValue);};function initStandard(){var minHandle=plot.canvas.append('text').text(minValue).style('fill',serie.handleFontColor).style('font-size',handleTextSize+'px').style('font-family',serie.handleFontFamily).style('font-style',serie.handleFontStyle=='bold'?'normal':serie.handleFontStyle).style('font-weight',serie.handleFontStyle=='bold'?'bold':'normal').style('text-anchor','start').attr('x',function(d){return btx-radius;}).attr('y',function(d){return bty+this.getBBox().height;});var maxHandle=plot.canvas.append('text').text(maxValue).style('fill',serie.handleFontColor).style('font-size',handleTextSize+'px').style('font-family',serie.handleFontFamily).style('font-style',serie.handleFontStyle=='bold'?'normal':serie.handleFontStyle).style('font-weight',serie.handleFontStyle=='bold'?'bold':'normal').style('text-anchor','end').attr('x',function(d){return btx+radius+trendHeight;}).attr('y',function(d){return bty+this.getBBox().height;});var backCircle=plot.canvas.append('path').attr('transform','translate('+btx+','+bty+')rotate(270)').style('fill',serie.gaugeBackColor).style('stroke',serie.gaugeBorderColor).style('stroke-width',serie.gaugeBorderSize+'px').attr('d',standardGaugeArc);chart.trends.each(function(trend){var trendStartAngle=trend.start/serie.max*Math.PI;var trendEndAngle=trend.end/serie.max*Math.PI;var trendArc=d3.svg.arc().outerRadius(radius+trendHeight).innerRadius(radius).startAngle(trendStartAngle).endAngle(trendEndAngle);var trendCircle=plot.canvas.append('path').attr('transform','translate('+btx+','+bty+')rotate(270)').style('fill',trend.color).attr('d',trendArc).on('mousemove',function(d){var balloonContent=trend.balloonFormat.replaceAll('{{title}}',trend.title).replaceAll('{{start}}',chart.formatNumber(trend.start)).replaceAll('{{end}}',chart.formatNumber(trend.end)).replaceAll('{{value}}',chart.formatNumber(baseValue)).replaceAll('{{percent}}',percentValue);plot.balloon.style('borderColor',trend.color);chart.showBalloon(balloonContent);}).on('mouseout',function(d){chart.hideBalloon();});});gaugeValueHandle=plot.canvas.append('path').attr('transform','translate('+btx+','+bty+')rotate(270)').style('fill',serie.color).on('mousemove',function(d){var balloonData={value:baseValue,percent:percentValue,max:serie.max,min:serie.min,trend:matchTrend};var balloonContent=chart.setBalloonContent({data:balloonData,dataIndex:0,format:chart.balloon.format,serie:serie,type:'gauge'});plot.balloon.style('borderColor',serie.color);chart.showBalloon(balloonContent);}).on('mouseout',function(d){chart.hideBalloon();});;gaugeValueText=plot.canvas.append('text').style('fill',serie.handleFontColor).style('text-anchor','middle').style('font-family',serie.handleFontFamily).style('font-style',serie.handleFontStyle=='bold'?'normal':serie.handleFontStyle).style('font-weight',serie.handleFontStyle=='bold'?'bold':'normal').style('font-size',valueTextSize+'px');if(serie.label.trim()!=''){plot.canvas.append('text').text(serie.label).style('fill',serie.labelFontColor).style('font-family',serie.labelFontFamily).style('text-anchor','middle').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').attr('x',(plot.width+trendHeight)/2).attr('y',bty+valueTextSize/2);}};function initDial(){var topCircle=plot.canvas.append('circle').attr('cx',btx).attr('cy',bty).attr('r',radius).style('fill',serie.gaugeBackColor).style('stroke',serie.gaugeBorderColor).style('stroke-width',serie.gaugeBorderSize+'px');var innerCircle=plot.canvas.append('circle').attr('cx',btx).attr('cy',bty).attr('r',radius*0.9).style('fill',serie.innerBackColor).style('stroke',serie.innerBorderColor).style('stroke-width',serie.innerBorderSize+'px');chart.trends.each(function(trend){var trendStartAngle=convertToRadians(trend.start);var trendEndAngle=convertToRadians(trend.end);var trendArc=d3.svg.arc().outerRadius(radius*0.88).innerRadius(radius*0.8).startAngle(trendStartAngle).endAngle(trendEndAngle);var trendCircle=plot.canvas.append('path').attr('transform','translate('+btx+','+bty+')rotate(270)').style('fill',trend.color).attr('d',trendArc).on('mousemove',function(d){var balloonContent=trend.balloonFormat.replaceAll('{{title}}',trend.title).replaceAll('{{start}}',chart.formatNumber(trend.start)).replaceAll('{{end}}',chart.formatNumber(trend.end)).replaceAll('{{value}}',chart.formatNumber(baseValue)).replaceAll('{{percent}}',percentValue);plot.balloon.style('borderColor',trend.color);chart.showBalloon(balloonContent);}).on('mouseout',function(d){chart.hideBalloon();});});for(var major=serie.min;major<=serie.max;major+=majorDelta){var minorDelta=majorDelta/serie.minorTicks;for(var minor=major+minorDelta;minor<=Math.min(major+majorDelta,serie.max);minor+=minorDelta){var minorPoint1=convertToPoint(minor,0.75);var minorPoint2=convertToPoint(minor,0.85);plot.canvas.append('line').attr('x1',minorPoint1.x).attr('y1',minorPoint1.y).attr('x2',minorPoint2.x).attr('y2',minorPoint2.y).style('stroke',serie.minorTickColor).style('stroke-width',serie.minorTickSize+'px');}var majorPoint1=convertToPoint(major,0.7);var majorPoint2=convertToPoint(major,0.85);plot.canvas.append('line').attr('x1',majorPoint1.x).attr('y1',majorPoint1.y).attr('x2',majorPoint2.x).attr('y2',majorPoint2.y).style('stroke',serie.majorTickColor).style('stroke-width',serie.majorTickSize+'px');if(major==serie.min||major==serie.max){var handlePoint=convertToPoint(major,0.63);plot.canvas.append('text').attr('x',handlePoint.x).attr('y',function(d){return handlePoint.y+handleTextSize;}).attr('dy',handleTextSize/3).text(chart.formatNumber(major)).attr('text-anchor',major==serie.max?'end':'start').style('fill',serie.handleFontColor).style('font-family',serie.handleFontFamily).style('font-style',serie.handleFontStyle=='bold'?'normal':serie.handleFontStyle).style('font-weight',serie.handleFontStyle=='bold'?'bold':'normal');}}var midVal=(serie.min+serie.max)/2,needlePath=getNeedlePath(midVal),needleLine=d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;}).interpolate('basis');gaugeValueHandle=plot.canvas.append('g').selectAll('path').data([needlePath]).enter().append('svg:path').attr('d',needleLine).style('fill',serie.handleColor).style('stroke',serie.handleBorderColor).style('fill-opacity',0.7).style('stroke-opacity',0.7).on('mousemove',function(d){var balloonData={value:baseValue,percent:percentValue,max:serie.max,min:serie.min,trend:matchTrend};var balloonContent=chart.setBalloonContent({data:balloonData,dataIndex:0,format:chart.balloon.format,serie:serie,type:'gauge'});plot.balloon.style('borderColor',serie.handleColor);chart.showBalloon(balloonContent);}).on('mouseout',function(d){chart.hideBalloon();});;plot.canvas.append('circle').attr('cx',btx).attr('cy',bty).attr('r',serie.handleCircleSize>radius?10:serie.handleCircleSize).style('fill',serie.handleCircleColor).style('stroke',serie.handleCircleBorderColor);gaugeValueText=plot.canvas.append('text').style('fill',serie.handleFontColor).style('text-anchor','middle').style('font-family',serie.handleFontFamily).style('font-style',serie.handleFontStyle=='bold'?'normal':serie.handleFontStyle).style('font-weight',serie.handleFontStyle=='bold'?'bold':'normal').style('font-size',valueTextSize+'px');if(serie.label.trim()!=''){plot.canvas.append('text').text(serie.label).style('fill',serie.labelFontColor).style('font-family',serie.labelFontFamily).style('text-anchor','middle').style('font-size',labelTextSize+'px').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').attr('x',btx).attr('y',bty+valueTextSize*2+labelTextSize*2);}};function update(value){if(value==null)return null;baseValue=value;percentValue=getPercent(value);chart.trends.each(function(trend){if(baseValue>=trend.start&&baseValue<=trend.end)matchTrend=trend;});switch(serie.behavior){case 'standard':{gaugeValueHandle.transition().ease('linear').duration(chart.animationDuration).attrTween('d',function(){return standardGaugeTween(percentValue);});gaugeValueText.text(chart.formatNumber(value)).attr('x',(plot.width+trendHeight)/2).attr('y',bty);}break;case 'dial':{gaugeValueHandle.transition().duration(chart.animationDuration).attrTween('transform',function(){var needleValue=value;if(baseValue>serie.max)needleValue=serie.max+0.02*range;else if(baseValue<serie.min)needleValue=serie.min-0.02*range;var target=(convertToDegrees(needleValue)-90);var current=this._current||target;this._current=target;return function(step){var pos=current+(target-current)*step;return 'translate('+btx+','+bty+')rotate('+pos+')';};});gaugeValueText.text(chart.formatNumber(value)).attr('x',function(d){return btx;}).attr('y',function(d){return bty+(radius*0.12)+this.getBBox().height+valueTextSize/2;});}break;}};initGauge(baseValue);return chart;};eveCharts.gauge=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='gauge';});}var gauge=gaugeChart(new this.configurator(options));if(gauge!==null)this.instances[gauge.id]=gauge;return gauge;}else{return null;}};})(eve.charts); (function(eveCharts){function lineChart(chart){var plot=chart.plot,axis,lineSeries,lineBullets;var lineF=d3.svg.line().x(function(d){return axis.x(d.xField);}).y(function(d){return axis.y(d.yField);});var lineBullet=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){return Math.pow(chart.series[d.index].bulletSize,2);});function createErrorPath(d){var serie=chart.series[d.index],h=serie.yErrorField===''?[-5,5]:[(axis.y(d.yField-d.yErrorField)-axis.y(d.yField)),(axis.y(d.yField+d.yErrorField)-axis.y(d.yField))],w=serie.xErrorField===''?[-5,5]:[(axis.x(d.xField-d.xErrorField)-axis.x(d.xField)),(axis.x(d.xField+d.xErrorField)-axis.x(d.xField))];return "M 0,"+h[0]+" L 0,"+h[1]+" M "+w[0]+","+h[1]+" L "+w[1]+","+h[1]+" M "+w[0]+","+h[0]+" L "+w[1]+","+h[0];};function createLineSeries(){lineSeries=plot.canvas.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');lineSeries.append('path').attr('class',function(d,i){return 'eve-line-serie eve-line-serie-'+i;}).attr('d',function(d,i){if(chart.series[i].lineType==='stepLine')lineF.interpolate('step');else if(chart.series[i].lineType==='spLine')lineF.interpolate('cardinal');return lineF(d.values);}).attr('transform','translate('+axis.offset.left+')').style('fill','none').style('stroke-width',function(d,i){return chart.series[i].lineSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].lineAlpha;}).style('stroke-dasharray',function(d,i){if(chart.series[i].lineDrawingStyle==='dotted')return '2, 2';else if(chart.series[i].lineDrawingStyle==='dashed')return '5, 2';else return '0';}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;});lineBullets=lineSeries.selectAll('.eve-line-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-line-point eve-line-point-'+d.index;}).attr('d',function(d){return chart.series[d.index].bullet==='error'?createErrorPath(d):lineBullet(d);}).style('cursor','pointer').style('fill',function(d){if(chart.series[d.index].bullet==='error'){return 'none';}else{if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}}).style('stroke',function(d){if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineColor;}else{if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}}).style('stroke-width',function(d){if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineSize+'px';}else{return chart.series[d.index].bulletStrokeSize+'px';}}).style('stroke-opacity',function(d){if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineAlpha;}else{return chart.series[d.index].bulletStrokeAlpha;}}).style('stroke-dasharray',function(d,i){if(chart.series[d.index].bullet==='error'){if(chart.series[d.index].errorDrawingStyle==='dotted')return '2, 2';else if(chart.series[d.index].errorDrawingStyle==='dashed')return '5, 2';else return '0';}else{return '0';}}).style('fill-opacity',function(d){if(chart.series[d.index].bullet==='error'){return 0;}else{return chart.series[d.index].bulletAlpha;}}).attr('transform',function(d){return 'translate('+(axis.x(d.xField)+axis.offset.left)+','+axis.y(d.yField)+')';}).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});if(chart.series[d.index].color==='')serieColor=d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else serieColor=chart.series[d.index].color;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);if(chart.series[d.index].bullet==='error'){d3.select(this).style('stroke-width',chart.series[d.index].lineSize+1);}else{d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize+1);}}).on('mouseout',function(d,i){chart.hideBalloon();if(chart.series[d.index].bullet==='error'){d3.select(this).style('stroke-width',chart.series[d.index].lineSize);}else{d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize);}});};function init(){axis=chart.createAxis();createLineSeries();};init();return chart;};eveCharts.line=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='line';});}var line=lineChart(new this.configurator(options));if(line!==null)this.instances[line.id]=line;return line;}else{return null;}};})(eve.charts); (function(eveCharts){function ohlcChart(chart,isCandlestick){var plot=chart.plot,isUp=function(d){return d.closeField>d.openField;},isDown=function(d){return!isUp(d);},line=d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;}),axis,ohlcSeries,ohlcLines,ohlcOpenSeries,ohlcOpenLines,ohlcCloseSeries,ohlcCloseLines,candlestickBarSeries,candlestickBars;function createOHLCSeries(){ohlcSeries=plot.canvas.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');ohlcLines=ohlcSeries.selectAll('.eve-ohlc-serie').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-ohlc-serie eve-ohlc-serie-'+d.index;}).attr('d',function(d,i){return line([{x:axis.x(d.xField)+axis.offset.left,y:axis.y(d.lowField)},{x:axis.x(d.xField)+axis.offset.left,y:axis.y(d.highField)}]);}).style('stroke',function(d,i){return isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor;}).style('stroke-width',function(d,i){return chart.series[d.index].lineSize;}).style('stroke-opacity',function(d,i){return chart.series[d.index].lineAlpha;}).style('stroke-dasharray',function(d,i){if(chart.series[d.index].lineDrawingStyle==='dotted')return '2, 2';else if(chart.series[d.index].lineDrawingStyle==='dashed')return '5, 2';else return '0';}).style('cursor','pointer').on('mousemove',function(d,i){var serieColor=isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor,balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);}).on('mouseout',function(d,i){chart.hideBalloon();});if(isCandlestick){candlestickBarSeries=plot.canvas.selectAll('.eve-series-candlestick').data(axis.series).enter().append('g').attr('class','eve-series-candlestick');candlestickBars=candlestickBarSeries.selectAll('eve-candlestick-serie').data(function(d){return d.values;}).enter().append('rect').attr('class',function(d,i){return 'eve-candlestick-serie eve-candlestick-serie-'+d.index;}).style('fill',function(d,i){return isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor;}).attr('x',function(d,i){var rectWidth=chart.series[d.index].lineSize*8;return axis.x(d.xField)+axis.offset.left-rectWidth/2;}).attr('y',function(d,i){return isUp(d)?axis.y(d.closeField):axis.y(d.openField);}).attr('width',function(d,i){return chart.series[d.index].lineSize*8;}).attr('height',function(d,i){return isUp(d)?(axis.y(d.openField)-axis.y(d.closeField)):(axis.y(d.closeField)-axis.y(d.openField));}).on('mousemove',function(d,i){var serieColor=isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor,balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);}).on('mouseout',function(d,i){chart.hideBalloon();});}else{ohlcOpenSeries=plot.canvas.selectAll('.eve-series-open').data(axis.series).enter().append('g').attr('class','eve-series-open');ohlcCloseSeries=plot.canvas.selectAll('.eve-series-close').data(axis.series).enter().append('g').attr('class','eve-series-close');ohlcOpenLines=ohlcOpenSeries.selectAll('.eve-ohlc-serie-open').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-ohlc-serie-open eve-ohlc-serie-open-'+d.index;}).attr('d',function(d,i){var tickWidth=chart.series[d.index].lineSize*4;return line([{x:axis.x(d.xField)+axis.offset.left-tickWidth,y:axis.y(d.openField)},{x:axis.x(d.xField)+axis.offset.left,y:axis.y(d.openField)}]);}).style('stroke',function(d,i){return isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor;}).style('stroke-width',function(d,i){return chart.series[d.index].lineSize;}).style('stroke-opacity',function(d,i){return chart.series[d.index].lineAlpha;}).style('stroke-dasharray',function(d,i){if(chart.series[d.index].lineDrawingStyle==='dotted')return '2, 2';else if(chart.series[d.index].lineDrawingStyle==='dashed')return '5, 2';else return '0';}).style('cursor','pointer').on('mousemove',function(d,i){var serieColor=isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor,balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);}).on('mouseout',function(d,i){chart.hideBalloon();});ohlcCloseLines=ohlcCloseSeries.selectAll('.eve-ohlc-serie-close').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-ohlc-serie-close eve-ohlc-serie-close-'+d.index;}).attr('d',function(d,i){var tickWidth=chart.series[d.index].lineSize*4;return line([{x:axis.x(d.xField)+axis.offset.left,y:axis.y(d.closeField)},{x:axis.x(d.xField)+axis.offset.left+tickWidth,y:axis.y(d.closeField)}]);}).style('stroke',function(d,i){return isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor;}).style('stroke-width',function(d,i){return chart.series[d.index].lineSize;}).style('stroke-opacity',function(d,i){return chart.series[d.index].lineAlpha;}).style('stroke-dasharray',function(d,i){if(chart.series[d.index].lineDrawingStyle==='dotted')return '2, 2';else if(chart.series[d.index].lineDrawingStyle==='dashed')return '5, 2';else return '0';}).style('cursor','pointer').on('mousemove',function(d,i){var serieColor=isUp(d)?chart.series[d.index].upDayColor:chart.series[d.index].downDayColor,balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);}).on('mouseout',function(d,i){chart.hideBalloon();});}};function init(){axis=chart.createAxis();createOHLCSeries(isCandlestick);};init();return chart;};eveCharts.candleStick=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='candlestick';});}var config=new this.configurator(options);config.legend.enabled=false;var candlestick=ohlcChart(config,true);if(candlestick!==null)this.instances[candlestick.id]=candlestick;return candlestick;}else{return null;}};eveCharts.ohlc=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='ohlc';});}var config=new this.configurator(options);config.legend.enabled=false;var ohlc=ohlcChart(config,false);if(ohlc!==null)this.instances[ohlc.id]=ohlc;return ohlc;}else{return null;}};})(eve.charts); (function(eveCharts){function parallelLinesChart(chart){var plot=chart.plot,serie=chart.series[0],legendIcons,legendTexts,legendWidth,legendHeight,axisLeft=chart.margin.left,axisWidth=plot.width-chart.margin.left-chart.margin.right,axisTop=(chart.margin.top+(chart.yAxis.labelFontSize*2)),axisHeight=plot.height-chart.margin.top-chart.margin.bottom-(chart.yAxis.labelFontSize*2);if(serie.type!=='parallel'){throw new Error('Serie type mistmatch! When creating a parallel lines chart, serie type should be set as "parallel"...');return null;}function drawLegend(){if(chart.legend.enabled){var symbolSize=Math.pow(chart.legend.fontSize,2);legendWidth=chart.legend.fontSize+5;legendHeight=chart.data.length*chart.legend.fontSize;legendTexts=plot.canvas.selectAll('.eve-legend-text').data(chart.data).enter().append('g');legendIcons=plot.canvas.selectAll('.eve-legend-icon').data(chart.data).enter().append('g');legendTexts.append('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').style("text-anchor",'left').text(function(d,i){return d[serie.dimensionField];});legendTexts[0].each(function(legendText){var bboxWidth=legendText.getBBox().width+chart.legend.fontSize+5;if(bboxWidth>legendWidth)legendWidth=bboxWidth;});legendIcons.append('path').attr('d',d3.svg.symbol().type(chart.legend.iconType).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){var serieColor=eve.randomColor();if(serie.colorField!==''){if(colors[i]!=null)serieColor=colors[i];else serieColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i];}else{serieColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i]}return serieColor;});if(chart.legend.position==='right'){legendIcons.attr('transform',function(d,i){var x=plot.width-legendWidth-chart.legend.fontSize-chart.margin.right,y=plot.height/2-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('transform',function(d,i){var x=plot.width-legendWidth-chart.margin.right,y=plot.height/2-legendHeight+(chart.legend.fontSize/3)+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});axisWidth-=legendWidth+chart.legend.fontSize;}else{legendIcons.attr('transform',function(d,i){var x=chart.margin.left+chart.yAxis.titleFontSize+5,y=plot.height/2-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('transform',function(d,i){var x=chart.margin.left+chart.yAxis.titleFontSize+chart.legend.fontSize+5,y=plot.height/2-legendHeight+(chart.legend.fontSize/3)+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});axisLeft+=legendWidth+chart.legend.fontSize+5;axisWidth-=legendWidth+chart.legend.fontSize;}}};function init(){drawLegend();var dimensions=[],colors=[],yRanges={},dragging={},xRange=d3.scale.ordinal().rangePoints([0,axisWidth],1),lineF=d3.svg.line(),yAxis=d3.svg.axis().orient('left'),parallelSerie,measureSerie,lineSerie;function position(d){var v=dragging[d];return v==null?xRange(d):v;};function transition(g){return g.transition().duration(chart.animationDuration);};function linePath(d){return lineF(serie.measureFields.map(function(p){return[position(p),yRanges[p](d[p])];}));};function brushstart(){d3.event.sourceEvent.stopPropagation();};function brush(){var actives=serie.measureFields.filter(function(p){return!yRanges[p].brush.empty();}),extents=actives.map(function(p){return yRanges[p].brush.extent();});lineSerie.style("display",function(d){return actives.every(function(p,i){return extents[i][0]<=d[p]&&d[p]<=extents[i][1];})?null:"none";});};chart.data.each(function(d){dimensions.push(d[serie.dimensionField]);if(serie.colorField!=='')colors.push(d[serie.colorField]);});plot.canvas.attr('transform','translate('+axisLeft+','+axisTop+')');xRange.domain(d3.keys(chart.data[0]).filter(function(d){if(serie.measureFields.indexOf(d)> -1){return yRanges[d]=d3.scale.linear().domain(d3.extent(chart.data,function(d2){return+d2[d];})).range([axisHeight,0]);}else{return false;}}));parallelSerie=plot.canvas.append("g").attr("class","eve-parallel-serie").selectAll("path").data(chart.data).enter().append("path").style('fill','none').style('stroke','none').style('shape-rendering','crispEdges').attr("d",linePath);lineSerie=plot.canvas.append("g").selectAll("path").data(chart.data).enter().append("path").attr('class',function(d,i){return 'eve-parallel-lines eve-parallel-line-'+i;}).attr("d",linePath).style('fill','none').style('fill-opacity',0).style('stroke',function(d,i){var strokeColor=eve.randomColor();if(serie.colorField!==''){if(colors[i]!=null)strokeColor=colors[i];else strokeColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i];}else{strokeColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i]}return strokeColor;}).style('stroke-width',serie.lineSize).style('stroke-opacity',serie.lineAlpha).style('stroke-dasharray',function(d,i){if(serie.lineDrawingStyle==='dotted')return '2, 2';else if(serie.lineDrawingStyle==='dashed')return '5, 2';else return '0';}).on('mousemove',function(d,i){var serieColor=eve.randomColor(),balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});if(serie.colorField!==''){if(colors[i]!=null)serieColor=colors[i];else serieColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i];}else{serieColor=i>(eveCharts.colors.length-1)?eve.randomColor():eveCharts.colors[i]}plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',serie.lineSize+1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',serie.lineSize);});measureSerie=plot.canvas.selectAll('.eve-parallel-measure').data(serie.measureFields).enter().append('g').attr('class','eve-parallel-measure').attr('transform',function(d,i){return 'translate('+xRange(d)+')';}).call(d3.behavior.drag().origin(function(d){return{x:xRange(d)};}).on("dragstart",function(d){dragging[d]=xRange(d);parallelSerie.attr("visibility","hidden");}).on("drag",function(d){dragging[d]=Math.min(plot.width,Math.max(0,d3.event.x));lineSerie.attr("d",linePath);serie.measureFields.sort(function(a,b){return position(a)-position(b);});xRange.domain(serie.measureFields);measureSerie.attr('transform',function(d){return 'translate('+position(d)+')';})}).on("dragend",function(d){delete dragging[d];transition(d3.select(this)).attr('transform','translate('+xRange(d)+')');transition(lineSerie).attr("d",linePath);parallelSerie.attr("d",linePath).transition().delay(500).duration(0).attr("visibility",null);}));measureSerie.append("g").attr("class","eve-parallel-axis").each(function(d){d3.select(this).call(yAxis.scale(yRanges[d]));}).append("text").attr('class','eve-parallel-axis-title').style("text-anchor","middle").attr("y",-9).text(function(d){return d});measureSerie.append("g").attr("class","eve-parallel-brush").each(function(d){d3.select(this).call(yRanges[d].brush=d3.svg.brush().y(yRanges[d]).on('brushstart',brushstart).on('brush',brush));}).selectAll("rect").style('fill',serie.brushColor).style('fill-opacity',serie.brushAlpha).style('stroke',serie.brushBorderColor).style('shape-rendering','crispEdges').attr("x",-8).attr("width",16);measureSerie.selectAll('.eve-parallel-axis line').style('fill','none').style('stroke-width',chart.yAxis.thickness+'px').style('shape-rendering','crispEdges').style('stroke-opacity',chart.yAxis.alpha).style('stroke',chart.yAxis.color);measureSerie.selectAll('.eve-parallel-axis path').style('fill','none').style('stroke-width',chart.yAxis.thickness+'px').style('stroke-opacity',chart.yAxis.alpha).style('stroke',chart.yAxis.color);measureSerie.selectAll('.eve-parallel-axis text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.yAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');measureSerie.selectAll('.eve-parallel-axis-title').style('fill',chart.yAxis.titleFontColor).style('font-size',chart.yAxis.titleFontSize+'px').style('font-family',chart.yAxis.titleFontFamily).style('font-style',chart.yAxis.titleFontStlye==='bold'?'normal':chart.yAxis.titleFontStlye).style('font-weight',chart.yAxis.titleFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');};init();return chart;};eveCharts.parallel=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='parallel';});}var config=new this.configurator(options);var parallel=parallelLinesChart(config);if(parallel!==null)this.instances[parallel.id]=parallel;return parallel;}else{return null;}};})(eve.charts); (function(eveCharts){function pieChart(chart){var plot=chart.plot,baseData=chart.data,serie=chart.series[0],isDonut=false,pie=d3.layout.pie().sort(null).value(function(d){return d[serie.valueField];}),key=function(d){return d.data[serie.titleField];},legendIcons=null,legendTexts=null,base=this,slices,labels,lines;if(serie.type!=='pie'&&serie.type!=='donut'){throw new Error('Serie type mistmatch! When creating a pie chart, serie type should be set as "pie" or "donut"...');return null;}if(serie.type==='donut')isDonut=true;plot.canvas.append('g').attr('class','eve-pie-slices');function init(){var legendWidth=0,legendHeight=0,transX=(plot.width+chart.margin.left-chart.margin.right)/2,transY=(plot.height+chart.margin.top-chart.margin.bottom)/2,alphaMin=0,alphaMax=0,pieWidth=plot.width-chart.margin.left-chart.margin.right,pieHeight=plot.height-chart.margin.top-chart.margin.bottom;if(serie.alphaField!==''){alphaMin=d3.min(baseData,function(d){return d[serie.alphaField];});alphaMax=d3.max(baseData,function(d){return d[serie.alphaField];});}if(chart.legend.enabled){plot.canvas.append('g').attr('class','eve-legend-icon');plot.canvas.append('g').attr('class','eve-legend-text');var symbolSize=Math.pow(chart.legend.fontSize,2);legendWidth=chart.legend.fontSize+5;legendHeight=baseData.length*chart.legend.fontSize;legendTexts=plot.canvas.select('.eve-legend-text').selectAll('text.eve-legend-text').data(pie(baseData),key);legendIcons=plot.canvas.select('.eve-legend-icon').selectAll('path.eve-legend-icon').data(pie(baseData),key);legendTexts.enter().insert('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').style("text-anchor",'left').text(function(d,i){return chart.setBalloonContent({format:chart.legend.format,dataIndex:i,data:d,serie:serie,type:'pie'});}).on('click',function(d,i){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(slices[0][i]).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*10,newY= -Math.cos(newAngle)*10;return 'translate('+newX+','+newY+')';});}else{d3.select(slices[0][i]).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}if(chart['legendClick']!==null)chart.legendClick(d.data);});legendTexts[0].each(function(legendText){var bboxWidth=legendText.getBBox().width+chart.legend.fontSize+5;if(bboxWidth>legendWidth)legendWidth=bboxWidth;});legendIcons.enter().insert('path').attr('d',d3.svg.symbol().type(chart.legend.iconType).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(slices!==undefined)return d3.select(slices[0][i]).style('fill');if(serie.colorField!=='')return d.data[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();}).on('click',function(d,i){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(slices[0][i]).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*10,newY= -Math.cos(newAngle)*10;return 'translate('+newX+','+newY+')';});}else{d3.select(slices[0][i]).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}if(chart['legendClick']!==null)chart.legendClick(d.data);});legendIcons.exit().remove();legendTexts.exit().remove();}if(chart.legend.enabled){if(chart.legend.position==='left')transX=transX+legendWidth/2;else transX=transX-legendWidth/2;pieWidth-=legendWidth*2;}var radius=Math.min((pieWidth),(pieHeight))/2,outerRadius=serie.labelsEnabled?(serie.labelPosition==='outside'?radius*.8:radius*.9):radius*.9,innerRadius=0;if(isDonut)innerRadius=serie.innerRadius===0?radius/2:serie.innerRadius;var arc=d3.svg.arc().outerRadius(outerRadius).innerRadius(innerRadius);plot.canvas.attr('transform','translate('+transX+','+transY+')');slices=plot.canvas.select('.eve-pie-slices').selectAll('path.eve-pie-slice').data(pie(baseData),key);slices.enter().insert('path').style('fill',function(d,i){if(serie.colorField!=='')return d.data[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();}).style('fill-opacity',function(d,i){if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d.data[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).style("stroke",serie.sliceBorderColor).style("stroke-width",1).style("stroke-opacity",serie.sliceBorderOpacity).attr("class","eve-pie-slice").on('click',function(d,i){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(this).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*10,newY= -Math.cos(newAngle)*10;return 'translate('+newX+','+newY+')';});}else{d3.select(this).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}if(chart['serieClick']!==null)chart.serieClick(d.data);}).on('mousemove',function(d,i){var dataColor='';var thisObj=eve(this);var balloonContent=chart.setBalloonContent({format:chart.balloon.format,dataIndex:i,data:d,serie:serie,type:'pie'});if(serie.colorField!=='')dataColor=d.data[serie.colorField];else dataColor=i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();plot.balloon.style('borderColor',dataColor);chart.showBalloon(balloonContent);thisObj.style('opacity',serie.hoverOpacity);}).on('mouseout',function(d){chart.hideBalloon();eve(this).style('opacity',1);});slices.transition().duration(chart.animationDuration).attrTween('d',function(d){this._current=this._current||d;var interpolated=d3.interpolate(this._current,d);this._current=interpolated(0);return function(t){return arc(interpolated(t));};});slices.exit().remove();if(chart.legend.enabled){if(chart.legend.position==='right'){legendIcons.attr('transform',function(d,i){var x=radius+10,y=0-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('x',radius+chart.legend.fontSize+10).attr('y',function(d,i){return 0-legendHeight+(chart.legend.fontSize/3)+(chart.legend.fontSize*i)*2;});}else{legendIcons.attr('transform',function(d,i){var x=0-radius-legendWidth-chart.legend.fontSize-10,y=0-legendHeight+(chart.legend.fontSize*i)*2;return 'translate('+x+','+y+')';});legendTexts.attr('x',0-radius-legendWidth-10).attr('y',function(d,i){return 0-legendHeight+(chart.legend.fontSize/3)+(chart.legend.fontSize*i)*2;});}}if(serie.labelsEnabled){plot.canvas.append('g').attr('class','eve-pie-labels');if(serie.labelPosition==='inside'){labels=plot.canvas.select('.eve-pie-labels').selectAll('text').data(pie(baseData),key);labels.enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').style('text-anchor','middle');labels.text(function(d,i){return chart.setBalloonContent({format:serie.labelFormat,dataIndex:i,data:d,serie:serie,type:'pie'});});labels.transition().duration(chart.animationDuration).attr('transform',function(d){return 'translate('+arc.centroid(d)+')';});labels.exit().remove();}else{plot.canvas.append('g').attr('class','eve-pie-labels-lines');lines=plot.canvas.select('.eve-pie-labels-lines').selectAll('line').data(pie(baseData),key);lines.enter().append('line').style('stroke',function(d,i){if(serie.colorField!=='')return d.data[serie.colorField];else return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();}).style('stroke-width',1).style('stroke-opacity',0.2);lines.transition().duration(chart.animationDuration).attr("x1",function(d){return arc.centroid(d)[0];}).attr("y1",function(d){return arc.centroid(d)[1];}).attr("x2",function(d){var _centroid=arc.centroid(d);var _midAngle=Math.atan2(_centroid[1],_centroid[0]);var _x=Math.cos(_midAngle)*(radius*0.9);return _x;}).attr("y2",function(d){var _centroid=arc.centroid(d);var _midAngle=Math.atan2(_centroid[1],_centroid[0]);var _y=Math.sin(_midAngle)*(radius*0.9);return _y;});lines.exit().remove();labels=plot.canvas.select('.eve-pie-labels').selectAll('text').data(pie(baseData),key);labels.enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').text(function(d,i){return chart.setBalloonContent({format:serie.labelFormat,dataIndex:i,data:d,serie:serie,type:'pie'});});labels.transition().duration(chart.animationDuration).attr('x',function(d){var _centroid=arc.centroid(d);var _midAngle=Math.atan2(_centroid[1],_centroid[0]);var _x=Math.cos(_midAngle)*(radius*0.9);return _x+(5*((_x>0)?1: -1));}).attr('y',function(d){var _centroid=arc.centroid(d);var _midAngle=Math.atan2(_centroid[1],_centroid[0]);return Math.sin(_midAngle)*(radius*0.9);}).style("text-anchor",function(d){var _centroid=arc.centroid(d);var _midAngle=Math.atan2(_centroid[1],_centroid[0]);var _x=Math.cos(_midAngle)*(radius*0.9);return(_x>0)?"start":"end";});labels.exit().remove();}}};init();return chart;};eveCharts.pie=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='pie';});}var pie=pieChart(new this.configurator(options));if(pie!==null)this.instances[pie.id]=pie;return pie;}else{return null;}};eveCharts.donut=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='donut';});}var pie=pieChart(new this.configurator(options));if(pie!==null)this.instances[pie.id]=pie;return pie;}else{return null;}};})(eve.charts); (function(eveCharts){function scatterChart(chart,isBubble){var plot=chart.plot,axis,scatterSeries,scatterBullets;var scatterBullet=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){var chartSerie=chart.series[d.index];var axisSerie=axis.series[d.index];if(chartSerie.sizeField!==''){var axisSerieRange=axisSerie.maxSize-axisSerie.minSize,chartSerieRange=chartSerie.maxBulletSize-chartSerie.minBulletSize,bulletSize=d.sizeField/axisSerieRange*chartSerieRange-(axisSerie.minSize/axisSerieRange*chartSerieRange)+chartSerie.minBulletSize;return Math.pow(bulletSize,2);}else{return Math.pow(chartSerie.bulletSize,2);}});function createErrorPath(d){var serie=chart.series[d.index],h=serie.yErrorField===''?[-5,5]:[(axis.y(d.yField-d.yErrorField)-axis.y(d.yField)),(axis.y(d.yField+d.yErrorField)-axis.y(d.yField))],w=serie.xErrorField===''?[-5,5]:[(axis.x(d.xField-d.xErrorField)-axis.x(d.xField)),(axis.x(d.xField+d.xErrorField)-axis.x(d.xField))];return "M 0,"+h[0]+" L 0,"+h[1]+" M "+w[0]+","+h[1]+" L "+w[1]+","+h[1]+" M "+w[0]+","+h[0]+" L "+w[1]+","+h[0];};function createScatterPoints(){scatterSeries=plot.canvas.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');var grads=plot.canvas.append('defs').selectAll('radialGradient').data(axis.series).enter().append('radialGradient').attr('cx',0).attr('cy',0).attr('r','100%').attr('id',function(d,i){return 'eve-grad-'+i;});grads.append('stop').attr('offset','10%').attr('stop-color','#ffffff');grads.append('stop').attr('offset','100%').attr('stop-color',function(d,i){if(chart.series[i].color==='')return i<=eveCharts.colors.length?eveCharts.colors[i]:eve.randomColor();else return chart.series[i].color;});scatterBullets=scatterSeries.selectAll('.eve-scatter-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-scatter-point eve-scatter-point-'+d.index;}).attr('d',function(d){if(isBubble)return scatterBullet(d);return chart.series[d.index].bullet==='error'?createErrorPath(d):scatterBullet(d);}).style('cursor','pointer').style('fill',function(d){if(isBubble){return 'url(#eve-grad-'+d.index+')';}else{if(chart.series[d.index].bullet==='error'){return 'none';}else{if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}}}).style('stroke',function(d){if(isBubble){if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}else{if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineColor;}else{if(chart.series[d.index].color==='')return d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else return chart.series[d.index].color;}}}).style('stroke-width',function(d){if(isBubble){return chart.series[d.index].bulletStrokeSize+'px';}else{if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineSize+'px';}else{return chart.series[d.index].bulletStrokeSize+'px';}}}).style('stroke-opacity',function(d){if(isBubble){return chart.series[d.index].bulletStrokeAlpha;}else{if(chart.series[d.index].bullet==='error'){return chart.series[d.index].lineAlpha;}else{return chart.series[d.index].bulletStrokeAlpha;}}}).style('stroke-dasharray',function(d,i){if(isBubble){return '0';}else{if(chart.series[d.index].bullet==='error'){if(chart.series[d.index].errorDrawingStyle==='dotted')return '2, 2';else if(chart.series[d.index].errorDrawingStyle==='dashed')return '5, 2';else return '0';}else{return '0';}}}).style('fill-opacity',function(d){if(isBubble){return chart.series[d.index].bulletAlpha;}else{if(chart.series[d.index].bullet==='error'){return 0;}else{return chart.series[d.index].bulletAlpha;}}}).attr('transform',function(d){return 'translate('+(axis.x(d.xField)+axis.offset.left)+','+axis.y(d.yField)+')';}).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});if(chart.series[d.index].color==='')serieColor=d.index<=eveCharts.colors.length?eveCharts.colors[d.index]:eve.randomColor();else serieColor=chart.series[d.index].color;plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);if(isBubble){d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize+1);}else{if(chart.series[d.index].bullet==='error'){d3.select(this).style('stroke-width',chart.series[d.index].lineSize+1);}else{d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize+1);}}}).on('mouseout',function(d,i){chart.hideBalloon();if(isBubble){d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize);}else{if(chart.series[d.index].bullet==='error'){d3.select(this).style('stroke-width',chart.series[d.index].lineSize);}else{d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize);}}});};function init(){axis=chart.createAxis();createScatterPoints();};init();return chart;};eveCharts.scatter=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='scatter';});}var scatter=scatterChart(new this.configurator(options),false);if(scatter!==null)this.instances[scatter.id]=scatter;return scatter;}else{return null;}};eveCharts.bubble=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='scatter';});}var bubble=scatterChart(new this.configurator(options),true);if(bubble!==null)this.instances[bubble.id]=bubble;return bubble;}else{return null;}};})(eve.charts); (function(eveCharts){function waterfallChart(chart){var plot=chart.plot,axis,waterfallSeries,waterfallBars,waterfallTexts,waterfallLines;function createXAxis(){return d3.svg.axis().scale(axis.x).orient('bottom').ticks(chart.xAxis.tickCount);};function createYAxis(){return d3.svg.axis().scale(axis.y).orient('left').ticks(chart.yAxis.tickCount);};function createWaterfall(){var totalValue=0,serie=chart.series[0],data=eve.clone(chart.data);data.each(function(d,i){d.xField=d[chart.xField];d.yField=d[serie.yField];d.start=totalValue;totalValue+=d[chart.series[0].yField];d.end=totalValue;d.isTotal=false;});var totalDataObj={xField:serie.totalText,yField:totalValue,start:0,end:totalValue,isTotal:true};totalDataObj[chart.xField]=chart.series[0].totalText;data.push(totalDataObj);axis.x.domain(data.map(function(d){return d[chart.xField];}));axis.y.domain([0,d3.max(data,function(d){return d.end;})]);plot.canvas.select('.eve-x-axis').call(axis.xAxis).selectAll('text').style('fill',chart.xAxis.labelFontColor).style('font-size',chart.xAxis.labelFontSize+'px').style('font-family',chart.xAxis.labelFontFamily).style('font-style',chart.xAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.xAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');plot.canvas.select('.eve-y-grid').attr('transform',function(){return 'translate('+axis.offset.left+', '+axis.offset.height+')';}).call(createXAxis().tickSize(-axis.offset.height,0,0).tickFormat(''));plot.canvas.select('.eve-y-axis').call(axis.yAxis).selectAll('text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.yAxis.labelFontStlye==='bold'?'bold':'normal').style('stroke-width','0px');plot.canvas.select('.eve-x-grid').attr('transform',function(){return 'translate('+axis.offset.left+')';}).call(createYAxis().tickSize(-axis.offset.width,0,0).tickFormat(''));waterfallSeries=plot.canvas.selectAll('.eve-series').data(data).enter().append('g').attr('class',function(d){return 'eve-series';}).attr("transform",function(d){return "translate("+(axis.x(d[chart.xField])+axis.offset.left)+",0)";});waterfallBars=waterfallSeries.append('rect').attr('class','eve-waterfall-bar').style('fill',function(d){if(d.isTotal)return serie.totalColor;else{return d[serie.yField]>=0?serie.positiveColor:serie.negativeColor;}}).style('fill-opacity',serie.alpha).on('mousemove',function(d,i){var serieColor='',balloonContent=chart.setBalloonContent({data:d,dataIndex:i,format:chart.balloon.format,serie:chart.series[d.index]});if(d.isTotal)serieColor=serie.totalColor;else{serieColor=d[serie.yField]>=0?serie.positiveColor:serie.negativeColor;}plot.balloon.style('borderColor',serieColor);chart.showBalloon(balloonContent);d3.select(this).style('fill-opacity',1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('fill-opacity',serie.alpha);}).attr("y",function(d){return axis.y(Math.max(d.start,d.end));}).attr("height",function(d){return Math.abs(axis.y(d.start)-axis.y(d.end));}).attr("width",axis.x.rangeBand());waterfallTexts=waterfallSeries.append("text").attr('class','eve-waterfall-text').style('fill',serie.valueFontColor).style('text-anchor','middle').style('font-size',serie.valueFontSize+'px').style('font-family',serie.valueFontFamily).style('font-style',serie.valueFontStlye==='bold'?'normal':serie.valueFontStlye).style('font-weight',serie.valueFontStlye==='bold'?'bold':'normal').text(function(d){var value=(d.end-d.start);return chart.formatNumbers?value.group(chart.decimalSeperator,chart.thousandSeperator,chart.precision):value;}).attr("x",function(d){return axis.x.rangeBand()/2-this.getBBox().width/2;}).attr("y",function(d){return axis.y(d.end)+5;}).attr("dy",function(d){return(d[serie.yField]<0?'-':'')+".75em"});waterfallLines=waterfallSeries.filter(function(d){return!d.isTotal}).append("line").attr('class','eve-waterfall-line').style('stroke',serie.lineColor).style("stroke-length",serie.lineSize).style("stroke-opacity",serie.lineAlpha).style('stroke-dasharray',function(d,i){if(serie.lineDrawingStyle==='dotted')return '2, 2';else if(serie.lineDrawingStyle==='dashed')return '5, 2';else return '0';}).attr("x1",axis.x.rangeBand()).attr("y1",function(d){return axis.y(d.end)}).attr("x2",axis.x.rangeBand()+(plot.width/axis.x.rangeBand()*chart.data.length)).attr("y2",function(d){return axis.y(d.end)});};function init(){axis=chart.createAxis();createWaterfall();};init();return chart;};eveCharts.waterfall=function(options){if(this.configurator){if(options['series']!==null){options.series.each(function(serie){serie.type='waterfall';});}var config=new this.configurator(options);config.xAxis.dataType='string';config.series[0].lineDrawingStyle='dashed';var waterfall=waterfallChart(config,true);if(waterfall!==null)this.instances[waterfall.id]=waterfall;return waterfall;}else{return null;}};})(eve.charts); 