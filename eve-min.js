/*!
 * eve charts
 * https://github.com/eveui/eve
 *
 * Copyright 2015, Ismail Ozdemir
 * Released under the MIT license
 * https://github.com/eveui/eve/blob/master/LICENSE
 *
 * Date: 2015-04-09 09:15 AM (EST)
 *
 * DEFINITION
 * EVE Chart library classes.
 */
(function(){var eve={isIE:false|| ! !document.documentMode,colors:['#83AA30','#1499D3','#4D6684','#3D3D3D','#B9340B','#CEA45C','#C5BE8B','#498379','#3F261C','#E74700','#F1E68F','#FF976F','#FF6464','#554939','#706C4D']};eve.setLocale=function(locale){d3.json('locales/'+locale+'.json',function(){eve.consts=arguments[1];})};eve.getType=function(obj){var objType=typeof obj,returnType='null';if(obj===null)return 'null';if(obj===undefined)return 'undefined';switch(objType){case 'string':case 'number':case 'boolean':case 'function':returnType=objType;break;default:{if(typeof obj.getMonth==='undefined'){if(Object.prototype.toString.call(obj)==='[object Array]')returnType='array';else if(Object.prototype.toString.call(obj)==='[object Function]')returnType='function';else if(Object.prototype.toString.call(obj)==='[object NodeList]')returnType='nodeList';else if(Object.prototype.toString.call(obj)==='[object Object]'){returnType='object';}else{var isHTMLElement=(typeof HTMLElement==="object"?obj instanceof HTMLElement:obj&&typeof obj==="object"&&obj!==null&&obj.nodeType===1&&typeof obj.nodeName==="string");if(isHTMLElement)returnType='htmlElement';else returnType='wtf';}}else{returnType='date';}}break;}return returnType;};eve.randInt=function(min,max){if(min==null)min=0;if(max==null)max=1;if(min>=max){throw Error('Max argument should be greater than min argument!')}return Math.floor(Math.random()*(max-min+1))+min;};eve.randColor=function(){var chars='0123456789ABCDEF'.split(''),color='#';for(var i=0;i<6;i++)color+=chars[Math.floor(Math.random()*16)];return color;};eve.clone=function(obj){var type=eve.getType(obj),result;if(type==='array'){result=[];obj.forEach(function(a){result.push(eve.clone(a));});}else if(type==='object'){result={};for(var key in obj){result[key]=obj[key];}}else{result=obj;}return result;};eve.isPrime=function(num){if(isNaN(num)|| !isFinite(num)||num%1||num<2)return false;if(num%2===0)return(num==2);var r=Math.sqrt(num);for(var i=3;i<=r;i+=2)if(num%i===0)return false;return true;};eve.getPrimeFactors=function(num){if(isNaN(num)|| !isFinite(num))return[];var r=Math.sqrt(num),res=arguments[1]||[],x=2;if(num%x){x=3;while((num%x)&&((x=x+2)<r)){}}x=(x<=r)?x:num;res.push(x);return(x===num)?res:eve.getPrimeFactors(num/x,res);};eve.extend=function(sub,base){function extended(){};extended.prototype=base.prototype;if(eve.getType(sub)==='function'&&eve.getType(base)==='function'){for(var key in base)eval('sub.'+key+' = base.'+key);return sub;}else if(eve.getType(sub)==='object'&&eve.getType(base)==='object'){for(var key in base){var baseType=eve.getType(base[key]);if(baseType==='object'){if(sub[key])eve.extend(sub[key],base[key]);else sub[key]=base[key];}else{if(sub[key]==null)sub[key]=base[key];}}return sub;}};eve.queryString=function(name){if(arguments.length===0)return '';name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),res=regex.exec(window.location.search);if(res===null)return '';else return decodeURIComponent(res[1].replace(/\+/g,' '));};eve.offset=function(el){var offset={width:0,height:0,left:0,top:0};if(el==null)return offset;if(eve.getType(el)!=='htmlElement')return offset;if(el.getBoundingClientRect){var bcr=el.getBoundingClientRect();offset.width=bcr.width;offset.height=bcr.height;offset.left=bcr.left;offset.top=bcr.top;}else{offset.width=el['offsetWidth']==null?0:parseFloat(el['offsetWidth']);offset.height=el['offsetHeight']==null?0:parseFloat(el['offsetHeight']);offset.left=el['offsetLeft']==null?0:parseFloat(el['offsetLeft']);offset.top=el['offsetTop']==null?0:parseFloat(el['offsetTop']);}return offset;};eve.appendHTML=function(reference,html){if(reference==null)return;if(html==null)return;if(eve.getType(html)!=='string')return;var refType=eve.getType(reference),ref=reference,dummy=null;if(refType!=='string'&&refType!=='htmlElement')return;if(refType==='string'){ref=document.getElementById(reference);if(ref==null)return;}dummy=document.createElement('div');dummy.innerHTML=html;for(var i=0;i<dummy.childNodes.length;i++)ref.appendChild(dummy.childNodes[i]);try{document.removeChild(dummy);}catch(e){}};eve.setLocale('en');String.prototype.replaceAll=function(term,replacement){return this.replace(new RegExp(term,'g'),replacement);};Date.prototype.diff=function(date){return(this.getTime()-date.getTime())/(1000*60*60*24);};Date.prototype.addHours=function(hours){return this.setHours(this.getHours()+hours);;};if(!Array.prototype.max){Array.prototype.max=function(){return Math.max.apply(null,this);};}if(!Array.prototype.min){Array.prototype.min=function(){return Math.min.apply(null,this);};}if(typeof amd!=='undefined'){define(function(){return eve;});}else if(typeof module==='object'&&module.exports){module.exports=eve;}else{window.eve=eve;}}).call(this);(function(e){var defaults={animationDuration:500,balloon:{backColor:'#ffffff',borderColor:'#61c9f6',borderRadius:3,borderSize:1,borderStyle:'solid',enabled:true,fontColor:'#333333',fontFamily:'Tahoma',fontSize:12,fontStyle:'normal',format:'',opacity:.9,padding:10,dateFormat:'',numberFormat:''},backColor:'#ffffff',container:null,data:null,legend:{enabled:true,fontColor:'#333333',fontFamily:'Tahoma',fontSize:12,fontStyle:'normal',icon:'square',position:'right'},series:[],title:{text:'',fontColor:'#333333',fontFamily:'Tahoma',fontSize:13,fontStyle:'bold',},trends:[],width:'auto',height:'auto',xField:'',xAxis:{alpha:1,color:'#cccccc',gridLineColor:'#cccccc',gridLineThickness:.5,gridLineAlpha:.5,labelAngle:0,labelFontColor:'#999999',labelFontFamily:'Tahoma',labelFontSize:10,labelFontStyle:'normal',labelFormat:'',startsFromZero:true,tickCount:10,title:'',titleFontColor:'#666666',titleFontFamily:'Tahoma',titleFontSize:11,titleFontStyle:'bold',thickness:1},yAxis:{alpha:1,color:'#cccccc',gridLineColor:'#cccccc',gridLineThickness:.5,gridLineAlpha:.5,labelAngle:0,labelFontColor:'#999999',labelFontFamily:'Tahoma',labelFontSize:10,labelFontStyle:'normal',labelFormat:'',startsFromZero:true,tickCount:10,title:'',titleFontColor:'#666666',titleFontFamily:'Tahoma',titleFontSize:11,titleFontStyle:'bold',thickness:1,stacked:true},zoomable:false};function chart(options,type){var members=options?e.extend(options,defaults):defaults,that=this,offset=null,parent=null,balloon=null,element=members.container;for(var key in members)that[key]=members[key];if(that.container==null||that.container==''){throw Error('Chart container could not found!');}if(that.data==null){throw new Error('Could not found chart data!');}if(e.getType(element)==='string')element=document.getElementById(element);element.innerHTML='';parent=element.parentNode;offset=e.offset(parent);if(that.width==='auto')that.width=offset.width;if(that.height==='auto')that.height=offset.height;that.aspectRatio=that.width/that.height;if(that.balloon.enabled){eve.appendHTML(document.body,'<div id="'+that.container+'_balloon" style="position: absolute; display: none; z-index: 1000; box-shadow: 0 3px 6px rgba(0, 0, 0, .15)"></div>');balloon=document.getElementById(that.container+'_balloon');balloon.style['backgroundColor']=that.balloon.backColor;balloon.style['borderStyle']=that.balloon.borderStyle;balloon.style['borderColor']=that.balloon.borderColor;balloon.style['borderRadius']=that.balloon.borderRadius+'px';balloon.style['borderWidth']=that.balloon.borderSize+'px';balloon.style['color']=that.balloon.fontColor;balloon.style['fontFamily']=that.balloon.fontFamily;balloon.style['fontSize']=that.balloon.fontSize+'px';balloon.style['paddingLeft']=that.balloon.padding+'px';balloon.style['paddingTop']=that.balloon.padding+'px';balloon.style['paddingRight']=that.balloon.padding+'px';balloon.style['paddingBottom']=that.balloon.padding+'px';if(that.balloon.fontStyle=='bold')balloon.style['fontWeight']='bold';else balloon.style['fontStyle']=that.balloon.fontStyle;}that.svg=d3.select(element).append('svg').attr('id',that.container+'_svg').attr('viewBox','0 0 '+that.width+' '+that.height).attr('preserveAspectRatio','xMidYMid').attr('width',that.width).attr('height',that.height).attr('fill',that.backColor).append('g');if(chart.zoomable){that.svg.append('rect').attr('fill',that.backColor).attr('width',that.width).attr('height',that.height);}that.showBalloon=function(content,x,y){if(content==null)return;if(e.getType(content)!=='string')content=content.toString();if(x==null)x=parseInt(d3.event.pageX+5);if(y==null)y=parseInt(d3.event.pageY+5);if(that.balloon.enabled&&balloon!=null){balloon.innerHTML=content;balloon.style['left']=x+'px';balloon.style['top']=y+'px';balloon.style['display']='block';}};that.hideBalloon=function(){if(that.balloon.enabled&&balloon!=null)balloon.style['display']='none';};that.getSlicedFormat=function(dataIndex,serie,section){var content='',currentData=that.data[dataIndex],totalValue=d3.sum(that.data,function(d){return d[serie.valueField];}),currentValue=currentData[serie.valueField]==null?0:currentData[serie.valueField],percentValue=(currentValue/totalValue*100).toFixed(2),formatter=d3.format();if(section==null)section='balloon';switch(section){case 'label':{if(serie.numberFormat!=='')formatter=d3.format(serie.numberFormat);content=serie.labelFormat;}break;case 'balloon':{if(that.balloon.numberFormat!=='')formatter=d3.format(that.balloon.numberFormat);content=that.balloon.format;}break;}if(serie.titleField)content=content.replaceAll('{title}',currentData[serie.titleField]);if(serie.valueField)content=content.replaceAll('{value}',formatter(currentValue));if(serie.alphaField)content=content.replaceAll('{alpha}',currentData[serie.alphaField]);if(serie.colorField)content=content.replaceAll('{color}',currentData[serie.colorField]);if(totalValue!=null)content=content.replaceAll('{total}',formatter(totalValue));if(percentValue!=null)content=content.replaceAll('{percent}',percentValue+'%');return content;};that.getXYFormat=function(data,serie,section){var content='',formatter=d3.format(),dateFormatter=d3.time.format('%m/%d/%Y'),xValue=data.xValue,yValue=data.yValue,sizeValue=data.sizeValue;if(section==null)section='balloon';switch(section){case 'label':{if(serie.numberFormat!=='')formatter=d3.format(serie.numberFormat);if(serie.dateFormat!=='')dateFormatter=d3.format(serie.dateFormat);content=serie.labelFormat;}break;case 'balloon':{if(that.balloon.numberFormat!=='')formatter=d3.format(that.balloon.numberFormat);if(that.balloon.dateFormat!=='')dateFormatter=d3.time.format(that.balloon.dateFormat);content=that.balloon.format;}break;}if(xValue){if(e.getType(xValue)==='date'){content=content.replaceAll('{x}',dateFormatter(xValue));content=content.replaceAll('{title}',dateFormatter(xValue));}else if(e.getType(xValue)==='number'){content=content.replaceAll('{x}',formatter(xValue));content=content.replaceAll('{title}',formatter(xValue));}else{content=content.replaceAll('{x}',xValue);content=content.replaceAll('{title}',xValue);}}if(yValue){content=content.replaceAll('{y}',formatter(yValue));content=content.replaceAll('{value}',formatter(yValue));}if(sizeValue)content=content.replaceAll('{size}',formatter(sizeValue));if(data.name)content=content.replaceAll('{serie}',data.name);return content;};};e.charts={init:function(options,type){return new chart(options,type);}};})(eve);(function(e){function axis(chart){if(chart==null||e.getType(chart)!=='object'){throw Error('Invalid chart data!');}this.x=null;this.y=null;this.xAxis=null;this.yAxis=null;this.series=null;this.serieNames=[];var that=this,xAxis,yAxis,legendWidth=0,isReversed=chart.type==='bar',legendHeight=chart.series.length*(chart.legend.fontSize+5),axisLeft=0,axisTop=0,axisWidth=chart.width-chart.yAxis.labelFontSize*2,axisHeight=chart.height-chart.xAxis.labelFontSize*2,serieMin=0,serieMax=0,xDataType=e.getType(chart.data[0][chart.xField]),maxValues=[],minValues=[],yDomains=[];if(chart.type==='bar'||chart.type==='column')xDataType='string';axisLeft+=chart.yAxis.titleFontSize;axisWidth-=chart.yAxis.titleFontSize;axisTop+=chart.xAxis.titleFontSize;axisHeight-=chart.xAxis.titleFontSize*2;chart.svg.attr('transform','translate('+axisLeft+','+axisTop+')');chart.series.forEach(function(serie){that.serieNames.push(serie.yField);});that.series=that.serieNames.map(function(name,index){return{name:name,serieType:chart.series[index].type,values:chart.data.map(function(d){var xValue=d[chart.xField],serie=chart.series[index],dataObject={};dataObject.name=name;dataObject.index=index;dataObject.serieType=serie.type;dataObject.xValue=xValue;if(serie.yField&&e.getType(serie.yField)==='string'&&serie.yField!=='')dataObject.yValue= +parseFloat(d[name]);if(serie.sizeField&&e.getType(serie.sizeField)==='string'&&serie.sizeField!=='')dataObject.sizeValue= +parseFloat(d[serie.sizeField]);return dataObject;})};});var serieMin=d3.min(that.series,function(c){return d3.min(c.values,function(v){return parseFloat(v.yValue);});});var serieMax=d3.max(that.series,function(c){return d3.max(c.values,function(v){return parseFloat(v.yValue);});});serieMax*=1.1;serieMin=chart.yAxis.startsFromZero?0:serieMin;that.series.forEach(function(serie,index){maxValues.push(d3.max(serie.values,function(d){return parseFloat(d.yValue);}));minValues.push(d3.min(serie.values,function(d){return parseFloat(d.yValue);}));if(chart.series[index].sizeField!=null&&chart.series[index].sizeField!==''){var sizeMin=d3.min(serie.values,function(d){return parseFloat(d.sizeValue);});var sizeMax=d3.max(serie.values,function(d){return parseFloat(d.sizeValue);});serie.minSize=sizeMin===undefined?chart.series[index].minBulletSize:sizeMin;serie.maxSize=sizeMax===undefined?chart.series[index].maxBulletSize:sizeMax;}yDomains.push(serieMin);yDomains.push(serieMax);});var maxValue=maxValues.max(),minValue=minValues.min(),symbolSize=Math.pow(chart.legend.fontSize,2);maxValueLength=(maxValue.toString().length*chart.yAxis.labelFontSize/2);if(isReversed){maxValueLength=0;chart.data.forEach(function(d){if(d[chart.xField].toString().length>maxValueLength)maxValueLength=d[chart.xField].toString().length*chart.xAxis.labelFontSize/2+chart.xAxis.titleFontSize;});}axisWidth-=maxValueLength;axisLeft+=maxValueLength;function createXAxis(){return d3.svg.axis().scale(that.x).orient('bottom').ticks(chart.xAxis.tickCount);};function createYAxis(){return d3.svg.axis().scale(that.y).orient('left').ticks(chart.yAxis.tickCount);};function drawLegend(){if(chart.legend.enabled){chart.svg.selectAll('.eve-legend-text').data(chart.series).enter().append('g').append('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').text(function(d,i){return chart.series[i].title===''?chart.series[i].yField:chart.series[i].title;}).style("text-anchor",function(d){var textWidth=this.getBBox().width+chart.legend.fontSize;if(textWidth>legendWidth)legendWidth=textWidth;return 'left';}).attr('transform',function(d,i){var x=chart.width-legendWidth,y=(chart.height-legendHeight)/2+((chart.legend.fontSize+5)*i);return 'translate('+x+','+y+')';}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}switch(d.type){case 'line':{var selectedSerie=chart.svg.selectAll('.eve-line-serie-'+i),selectedBullet=chart.svg.selectAll('.eve-line-point-'+i);if(d.selected){chart.svg.selectAll('.eve-series path').style('stroke-opacity',.1);selectedSerie.style('stroke-width',d.strokeSize+2);selectedSerie.style('stroke-opacity',1);selectedBullet.style('stroke-opacity',1);}else{chart.svg.selectAll('.eve-series path').style('stroke-opacity',1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('stroke-width',d.strokeSize);}}break;case 'scatter':{var allSeries=chart.svg.selectAll('.eve-series path.eve-scatter-point'),selectedBullet=chart.svg.selectAll('.eve-scatter-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedBullet.style('stroke-opacity',d.bulletStrokeAlpha);selectedBullet.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'bubble':{var allSeries=chart.svg.selectAll('.eve-series path.eve-bubble-point'),selectedBullet=chart.svg.selectAll('.eve-bubble-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedBullet.style('stroke-opacity',d.bulletStrokeAlpha);selectedBullet.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'area':{var allSeries=chart.svg.selectAll('.eve-series path.eve-area-serie'),selectedSerie=chart.svg.selectAll('.eve-area-serie-'+i),selectedPoints=chart.svg.selectAll('.eve-area-point-'+i);if(d.selected){selectedSerie.style('stroke-width',d.strokeSize+2);allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-width',d.strokeSize);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.strokeSize);allSeries.style('fill-opacity',d.alpha);}}break;case 'bar':{var allSeries=chart.svg.selectAll('.eve-series rect'),selectedSerie=chart.svg.selectAll('.eve-bar-serie-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-opacity',d.alpha);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.alpha);allSeries.style('fill-opacity',d.alpha);}}break;}if(chart.legendClick)chart.legendClick(d,i);});var legendIcons=chart.svg.selectAll('.eve-legend-icon').data(chart.series).enter().append('g').append('path').attr('d',d3.svg.symbol().type(chart.legend.icon).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(d.color!=='')return d.color;else return i<=e.colors.length?e.colors[i]:e.randColor();}).attr('transform',function(d,i){var bbox=this.getBBox(),x=chart.width-legendWidth-10,y=((chart.height-legendHeight)/2)+((bbox.height+5)*i)-5;return 'translate('+x+','+y+')';}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}switch(d.type){case 'line':{var selectedSerie=chart.svg.selectAll('.eve-line-serie-'+i),selectedBullet=chart.svg.selectAll('.eve-line-point-'+i);if(d.selected){chart.svg.selectAll('.eve-series path').style('stroke-opacity',.1);selectedSerie.style('stroke-width',d.strokeSize+2);selectedSerie.style('stroke-opacity',1);selectedBullet.style('stroke-opacity',1);}else{chart.svg.selectAll('.eve-series path').style('stroke-opacity',1);selectedSerie.style('stroke-opacity',d.lineAlpha);selectedSerie.style('stroke-width',d.strokeSize);}}break;case 'scatter':{var allSeries=chart.svg.selectAll('.eve-series path.eve-scatter-point'),selectedBullet=chart.svg.selectAll('.eve-scatter-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedBullet.style('stroke-opacity',d.bulletStrokeAlpha);selectedBullet.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'bubble':{var allSeries=chart.svg.selectAll('.eve-series path.eve-bubble-point'),selectedBullet=chart.svg.selectAll('.eve-bubble-point-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedBullet.style('stroke-opacity',d.bulletStrokeAlpha);selectedBullet.style('fill-opacity',d.bulletAlpha);}else{allSeries.style('stroke-opacity',d.bulletStrokeAlpha);allSeries.style('fill-opacity',d.bulletAlpha);}}break;case 'area':{var allSeries=chart.svg.selectAll('.eve-series path.eve-area-serie'),selectedSerie=chart.svg.selectAll('.eve-area-serie-'+i),selectedPoints=chart.svg.selectAll('.eve-area-point-'+i);if(d.selected){selectedSerie.style('stroke-width',d.strokeSize+2);allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-width',d.strokeSize);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.strokeSize);allSeries.style('fill-opacity',d.alpha);}}break;case 'bar':{var allSeries=chart.svg.selectAll('.eve-series rect'),selectedSerie=chart.svg.selectAll('.eve-bar-serie-'+i);if(d.selected){allSeries.style('stroke-opacity',.1);allSeries.style('fill-opacity',.1);selectedSerie.style('stroke-opacity',d.alpha);selectedSerie.style('fill-opacity',d.alpha);}else{allSeries.style('stroke-opacity',d.alpha);allSeries.style('fill-opacity',d.alpha);}}break;}if(chart.legendClick)chart.legendClick(d,i);});axisWidth-=legendWidth+chart.legend.fontSize;}};function drawTitles(){if(isReversed){if(chart.xAxis.title!==''){chart.svg.append('g').append('text').text(chart.yAxis.title).style('fill',chart.yAxis.titleFontColor).style('font-family',chart.yAxis.titleFontFamily).style('font-size',chart.yAxis.titleFontSize+'px').style('font-style',chart.yAxis.titleFontStyle==='bold'?'normal':chart.yAxis.titleFontStyle).style('font-weight',chart.yAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('x',function(d){var bbox=this.getBBox();return((chart.width-legendWidth-bbox.width)/2)+(Math.sqrt(symbolSize)/2);}).attr('y',function(d){var bbox=this.getBBox();axisHeight-=bbox.height;return chart.height-bbox.height;});}if(chart.yAxis.title!==''){chart.svg.append('g').append('text').text(chart.xAxis.title).style('fill',chart.xAxis.titleFontColor).style('font-family',chart.xAxis.titleFontFamily).style('font-size',chart.xAxis.titleFontSize+'px').style('font-style',chart.xAxis.titleFontStyle==='bold'?'normal':chart.xAxis.titleFontStyle).style('font-weight',chart.xAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('transform',function(d){var bbox=this.getBBox();axisLeft+=bbox.height;axisWidth-=bbox.height;return 'translate(0,'+(chart.height/2-bbox.height/2)+')rotate(-90)';});}}else{if(chart.xAxis.title!==''){chart.svg.append('g').append('text').text(chart.xAxis.title).style('fill',chart.xAxis.titleFontColor).style('font-family',chart.xAxis.titleFontFamily).style('font-size',chart.xAxis.titleFontSize+'px').style('font-style',chart.xAxis.titleFontStyle==='bold'?'normal':chart.xAxis.titleFontStyle).style('font-weight',chart.xAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('x',function(d){var bbox=this.getBBox();return((chart.width-legendWidth-bbox.width)/2)+(Math.sqrt(symbolSize)/2);}).attr('y',function(d){var bbox=this.getBBox();axisHeight-=bbox.height;return chart.height-bbox.height;});}if(chart.yAxis.title!==''){chart.svg.append('g').append('text').text(chart.yAxis.title).style('fill',chart.yAxis.titleFontColor).style('font-family',chart.yAxis.titleFontFamily).style('font-size',chart.yAxis.titleFontSize+'px').style('font-style',chart.yAxis.titleFontStyle==='bold'?'normal':chart.yAxis.titleFontStyle).style('font-weight',chart.yAxis.titleFontStyle==='bold'?'bold':'normal').style('text-anchor','middle').attr('transform',function(d){var bbox=this.getBBox();axisLeft+=bbox.height;axisWidth-=bbox.height;return 'translate(0,'+(chart.height/2-bbox.height/2)+')rotate(-90)';});}}};function drawAxes(){if(xDataType==='date')that.x=d3.time.scale().range([0,axisWidth]);else if(xDataType==='string')that.x=d3.scale.ordinal().rangeRoundBands([0,axisWidth],.1);else that.x=d3.scale.linear().range([0,axisWidth]);if(isReversed){that.x=d3.scale.linear().range([0,axisWidth]);if(xDataType==='date')that.y=d3.time.scale().range([axisHeight,0]);else if(xDataType==='string')that.y=d3.scale.ordinal().rangeRoundBands([axisHeight,0],.1);else that.y=d3.scale.linear().range([axisHeight,0]);}else{that.y=d3.scale.linear().range([axisHeight,0]);}that.xAxis=createXAxis();that.yAxis=createYAxis();switch(xDataType){case 'date':{var xMin=d3.min(chart.data,function(d){return d[chart.xField];}),xMax=d3.max(chart.data,function(d){return d[chart.xField];});if(isReversed)that.y.domain([xMin,xMax]);else that.x.domain([xMin,xMax]);}break;case 'string':{if(isReversed){that.y.domain(chart.data.map(function(d){return d[chart.xField].toString();}));}else{that.x.domain(chart.data.map(function(d){return d[chart.xField].toString();}));}}break;default:{var xMin=chart.xAxis.startsFromZero?0:d3.min(chart.data,function(d){return d[chart.xField];}),xMax=d3.max(chart.data,function(d){return d[chart.xField];});if(isReversed)that.y.domain([xMin,(chart.xAxis.startsFromZero?(xMax+1):xMax)]);else that.x.domain([xMin,(chart.xAxis.startsFromZero?(xMax+1):xMax)]);}break;}if(isReversed)that.x.domain(yDomains);else that.y.domain(yDomains);chart.svg.append('g').attr('class','eve-x-grid').attr('transform',function(){return 'translate('+axisLeft+', '+axisHeight+')';}).style('stroke-opacity',chart.xAxis.gridLineAlpha).style('stroke-width',chart.xAxis.gridLineThickness).style('stroke',chart.xAxis.gridLineColor).call(createXAxis().tickSize(-axisHeight,0,0).tickFormat(''));chart.svg.append('g').attr('class','eve-y-grid').attr('transform',function(){return 'translate('+axisLeft+')';}).style('stroke-opacity',chart.yAxis.gridLineAlpha).style('stroke-width',chart.yAxis.gridLineThickness).style('stroke',chart.yAxis.gridLineColor).call(createYAxis().tickSize(-axisWidth,0,0).tickFormat(''));yAxis=chart.svg.append('g').style('fill','none').style('stroke',chart.yAxis.color).style('stroke-width',chart.yAxis.thickness+'px').style('shape-rendering','crispEdges').attr('transform','translate('+axisLeft+')').attr('class','eve-y-axis').call(that.yAxis);yAxis.selectAll('line').style('fill','none').style('stroke-width',chart.yAxis.thickness+'px').style('shape-rendering','crispEdges').style('stroke-opacity',chart.yAxis.alpha).style('stroke',chart.yAxis.color);yAxis.selectAll('text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.yAxis.labelFontStlye==='bold'?'bold':'normal').text(function(d){if(isReversed){if(xDataType==='number')return d3.format(chart.xAxis.labelFormat)(d);else if(xDataType==='date')return d3.time.format(chart.xAxis.labelFormat)(d);else return d;}else{return d3.format(chart.yAxis.labelFormat)(d);}}).attr('transform',function(){var bbox=this.getBBox(),xMid=5,yMid=bbox.height/2;if(chart.yAxis.labelAngle!==0&&chart.yAxis.labelAngle!==45&&chart.yAxis.labelAngle!== -45)chart.yAxis.labelAngle=0;if(chart.yAxis.labelAngle<0)return 'translate(-'+xMid+', -'+yMid+')rotate('+chart.yAxis.labelAngle+')';else if(chart.yAxis.labelAngle>0)return 'translate(-'+xMid+', '+yMid+')rotate('+chart.yAxis.labelAngle+')';else return 'rotate('+chart.yAxis.labelAngle+')';}).style('stroke-width','0px');xAxis=chart.svg.append('g').style('fill','none').style('stroke',chart.xAxis.color).style('stroke-width',chart.xAxis.thickness+'px').style('shape-rendering','crispEdges').attr('transform','translate('+axisLeft+','+axisHeight+')').attr('class','eve-x-axis').call(that.xAxis);xAxis.selectAll('line').style('fill','none').style('stroke-width',chart.xAxis.thickness+'px').style('shape-rendering','crispEdges').style('stroke-opacity',chart.xAxis.alpha).style('stroke',chart.xAxis.color);xAxis.selectAll('text').style('fill',chart.xAxis.labelFontColor).style('font-size',chart.xAxis.labelFontSize+'px').style('font-family',chart.xAxis.labelFontFamily).style('font-style',chart.xAxis.labelFontStlye==='bold'?'normal':chart.xAxis.labelFontStlye).style('font-weight',chart.xAxis.labelFontStlye==='bold'?'bold':'normal').text(function(d){if(isReversed){return d3.format(chart.yAxis.labelFormat)(d);}else{if(xDataType==='number')return d3.format(chart.xAxis.labelFormat)(d);else if(xDataType==='date')return d3.time.format(chart.xAxis.labelFormat)(d);else return d;}}).attr('transform',function(d){var bbox=this.getBBox(),yMid=bbox.height/2;if(chart.xAxis.labelAngle!==0&&chart.xAxis.labelAngle!==45&&chart.xAxis.labelAngle!== -45)chart.xAxis.labelAngle=0;if(chart.xAxis.labelAngle<0)return 'translate(-'+bbox.width+', '+yMid+')rotate('+chart.xAxis.labelAngle+')';else if(chart.xAxis.labelAngle>0)return 'translate('+bbox.width+', '+yMid+')rotate('+chart.xAxis.labelAngle+')';else return 'rotate('+chart.xAxis.labelAngle+')';}).style('stroke-width','0px');};drawLegend();drawTitles();drawAxes();this.offset={left:axisLeft,top:axisTop,width:axisWidth,height:axisHeight};that.makeXAxis=function(){return createXAxis();};that.makeYAxis=function(){return createYAxis();};that.update=function(data){if(data==null)data=chart.data;yDomains.length=[];minValues.length=[];maxValues.length=[];that.series=that.serieNames.map(function(name,index){return{name:name,serieType:chart.series[index].type,values:chart.data.map(function(d){var xValue=d[chart.xField],serie=chart.series[index],dataObject={};dataObject.name=name;dataObject.index=index;dataObject.serieType=serie.type;dataObject.xValue=xValue;if(serie.yField&&e.getType(serie.yField)==='string'&&serie.yField!=='')dataObject.yValue= +parseFloat(d[name]);if(serie.sizeField&&e.getType(serie.sizeField)==='string'&&serie.sizeField!=='')dataObject.sizeValue= +parseFloat(d[serie.sizeField]);return dataObject;})};});serieMin=d3.min(that.series,function(c){return d3.min(c.values,function(v){return parseFloat(v.yValue);});});serieMax=d3.max(that.series,function(c){return d3.max(c.values,function(v){return parseFloat(v.yValue);});});serieMax*=1.1;serieMin=chart.yAxis.startsFromZero?0:serieMin;that.series.forEach(function(serie,index){maxValues.push(d3.max(serie.values,function(d){return parseFloat(d.yValue);}));minValues.push(d3.min(serie.values,function(d){return parseFloat(d.yValue);}));if(chart.series[index].sizeField!=null&&chart.series[index].sizeField!==''){var sizeMin=d3.min(serie.values,function(d){return parseFloat(d.sizeValue);});var sizeMax=d3.max(serie.values,function(d){return parseFloat(d.sizeValue);});serie.minSize=sizeMin===undefined?chart.series[index].minBulletSize:sizeMin;serie.maxSize=sizeMax===undefined?chart.series[index].maxBulletSize:sizeMax;}yDomains.push(serieMin);yDomains.push(serieMax);});maxValue=maxValues.max();minValue=minValues.min();symbolSize=Math.pow(chart.legend.fontSize,2);maxValueLength=(maxValue.toString().length*chart.yAxis.labelFontSize/2);if(isReversed){maxValueLength=0;chart.data.forEach(function(d){if(d[chart.xField].toString().length>maxValueLength)maxValueLength=d[chart.xField].toString().length*chart.xAxis.labelFontSize/2+chart.xAxis.titleFontSize;});}switch(xDataType){case 'date':{var xMin=d3.min(chart.data,function(d){return d[chart.xField];}),xMax=d3.max(chart.data,function(d){return d[chart.xField];});if(isReversed)that.y.domain([xMin,xMax]);else that.x.domain([xMin,xMax]);}break;case 'string':{if(isReversed){that.y.domain(chart.data.map(function(d){return d[chart.xField].toString();}));}else{that.x.domain(chart.data.map(function(d){return d[chart.xField].toString();}));}}break;default:{var xMin=chart.xAxis.startsFromZero?0:d3.min(chart.data,function(d){return d[chart.xField];}),xMax=d3.max(chart.data,function(d){return d[chart.xField];});if(isReversed)that.y.domain([xMin,(chart.xAxis.startsFromZero?(xMax+1):xMax)]);else that.x.domain([xMin,(chart.xAxis.startsFromZero?(xMax+1):xMax)]);}break;}if(isReversed)that.x.domain(yDomains);else that.y.domain(yDomains);chart.svg.select('.eve-x-axis').transition().duration(chart.animationDuration).call(that.xAxis);chart.svg.select('.eve-y-axis').transition().duration(chart.animationDuration).call(that.yAxis);xAxis.selectAll('text').style('fill',chart.xAxis.labelFontColor).style('font-size',chart.xAxis.labelFontSize+'px').style('font-family',chart.xAxis.labelFontFamily).style('font-style',chart.xAxis.labelFontStlye==='bold'?'normal':chart.xAxis.labelFontStlye).style('font-weight',chart.xAxis.labelFontStlye==='bold'?'bold':'normal').text(function(d){if(xDataType==='number')return d3.format(chart.xAxis.labelFormat)(d);else if(xDataType==='date')return d3.time.format(chart.xAxis.labelFormat)(d);else return d;}).attr('transform',function(d){var bbox=this.getBBox(),yMid=bbox.height/2;if(chart.xAxis.labelAngle!==0&&chart.xAxis.labelAngle!==45&&chart.xAxis.labelAngle!== -45)chart.xAxis.labelAngle=0;if(chart.xAxis.labelAngle<0)return 'translate(-'+bbox.width+', '+yMid+')rotate('+chart.xAxis.labelAngle+')';else if(chart.xAxis.labelAngle>0)return 'translate('+bbox.width+', '+yMid+')rotate('+chart.xAxis.labelAngle+')';else return 'rotate('+chart.xAxis.labelAngle+')';}).style('stroke-width','0px');yAxis.selectAll('text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStlye==='bold'?'normal':chart.yAxis.labelFontStlye).style('font-weight',chart.yAxis.labelFontStlye==='bold'?'bold':'normal').text(function(d){return d3.format(chart.yAxis.labelFormat)(d);}).attr('transform',function(){var bbox=this.getBBox(),xMid=5,yMid=bbox.height/2;if(chart.yAxis.labelAngle!==0&&chart.yAxis.labelAngle!==45&&chart.yAxis.labelAngle!== -45)chart.yAxis.labelAngle=0;if(chart.yAxis.labelAngle<0)return 'translate(-'+xMid+', -'+yMid+')rotate('+chart.yAxis.labelAngle+')';else if(chart.yAxis.labelAngle>0)return 'translate(-'+xMid+', '+yMid+')rotate('+chart.yAxis.labelAngle+')';else return 'rotate('+chart.yAxis.labelAngle+')';}).style('stroke-width','0px');return this;};};eve.charts.createAxis=function(chart){return new axis(chart);};})(eve);(function(e){var defaults={alpha:.7,bullet:'none',bulletAlpha:.5,bulletColor:'',bulletSize:8,bulletStrokeSize:1,bulletStrokeAlpha:1,color:'',dateFormat:'',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'',numberFormat:'',title:'',type:'area',yField:''};function area(options){if(options.series==null&&e.getType(options.series)!=='array'){throw new Error('Invalid chart series!');}for(var i=0;i<options.series.length;i++){e.extend(options.series[i],defaults);}var that=this,chart=e.charts.init(options),axis=e.charts.createAxis(chart),areaSeries,bulletSeries,areaF,bulletF,stackF;var zoom=d3.behavior.zoom().x(axis.x).y(axis.y).on("zoom",zoomHandler);function zoomHandler(){chart.svg.select('.eve-x-axis').call(axis.xAxis);chart.svg.select('.eve-y-axis').call(axis.yAxis);chart.svg.select(".eve-x-grid").call(axis.makeXAxis().tickSize(-axis.offset.height,0,0));chart.svg.select(".eve-y-grid").call(axis.makeYAxis().tickSize(-axis.offset.width,0,0));};if(chart.zoomable)chart.svg.call(zoom);function init(){stackF=d3.layout.stack().values(function(d){return d.values;}).x(function(d){return axis.x(d.xValue);}).y(function(d){return axis.y(d.yValue);});stackF(axis.series);axis.y.domain([0,d3.max(axis.series,function(d){return d3.max(d.values,function(d2){return d2.y0+d2.y;});})]);areaF=d3.svg.area().x(function(d){return axis.x(d.xValue);}).y0(function(d){return axis.y(d.y0);}).y1(function(d){return axis.y(d.y0+d.y);});bulletF=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){return Math.pow(chart.series[d.index].bulletSize,2);});if(chart.balloon.format==='')chart.balloon.format='{x}: {y}';areaSeries=chart.svg.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');areaSeries.append('path').attr('class',function(d,i){return 'eve-area-serie eve-area-serie-'+i;}).attr('d',function(d,i){return areaF(d.values);}).attr('transform','translate('+axis.offset.left+')').style('fill',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).style('stroke-width',1.5).style('stroke-opacity',1).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;});bulletSeries=areaSeries.selectAll('.eve-area-points').data(axis.series).enter().append('g').attr('class','eve-area-points');bulletSeries.selectAll('.eve-area-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-area-point eve-are-point-'+d.index;}).attr('d',bulletF).style('cursor','pointer').style('fill',function(d){return '#ffffff';}).style('stroke',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke-width',function(d){return chart.series[d.index].bulletStrokeSize+'px';}).style('stroke-opacity',0).style('fill-opacity',0).attr('transform',function(d){return 'translate('+(axis.x(d.xValue)+axis.offset.left)+','+axis.y(d.y0+d.y)+')';}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-opacity',function(d){return chart.series[d.index].bulletStrokeAlpha;}).style('fill-opacity',function(d){return chart.series[d.index].bulletAlpha;});}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-opacity',0).style('fill-opacity',0);})};init();return chart;};e.areaChart=function(options){options.type='area';return new area(options);};})(eve);(function(e){var defaults={alpha:1,color:'',dateFormat:'',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'',numberFormat:'',strokeSize:1,title:'',type:'bar',yField:''};function bar(options){if(options.series==null&&e.getType(options.series)!=='array'){throw new Error('Invalid chart series!');}for(var i=0;i<options.series.length;i++){e.extend(options.series[i],defaults);}var that=this,chart=e.charts.init(options),isReversed=chart.type==='bar',axis=e.charts.createAxis(chart),barPadding=25,groupAxis,stackedBars,stackedBarsRects,groupedBars,groupedBarsRects;function init(){if(chart.balloon.format==='')chart.balloon.format='{x}: {y}';if(chart.yAxis.stacked){createStackedBars();}else{var rangeBand=chart.type==='bar'?axis.y.rangeBand():axis.x.rangeBand();groupAxis=d3.scale.ordinal().domain(axis.serieNames).rangeRoundBands([0,rangeBand]);createGroupedBars();}};function createStackedBars(){chart.data.forEach(function(d){var y0=0;d.values=axis.serieNames.map(function(name){var dataObj={name:'name',xValue:d[chart.xField],yValue: +d[name],y0:y0,y1:y0+= +d[name]};return dataObj;});d.total=d.values[d.values.length-1].y1;});chart.data.sort(function(a,b){return b.total-a.total;});if(isReversed)axis.x.domain([0,d3.max(chart.data,function(d){return d.total;})]);else axis.y.domain([0,d3.max(chart.data,function(d){return d.total;})]);if(isReversed){chart.svg.select('.eve-x-axis').call(axis.xAxis).selectAll('text').style('fill',chart.xAxis.labelFontColor).style('font-size',chart.xAxis.labelFontSize+'px').style('font-family',chart.xAxis.labelFontFamily).style('font-style',chart.xAxis.labelFontStyle==='bold'?'normal':chart.yAxis.labelFontStyle).style('font-weight',chart.xAxis.labelFontStyle==='bold'?'bold':'normal').style('stroke-width','0px');}else{chart.svg.select('.eve-y-axis').call(axis.yAxis).selectAll('text').style('fill',chart.yAxis.labelFontColor).style('font-size',chart.yAxis.labelFontSize+'px').style('font-family',chart.yAxis.labelFontFamily).style('font-style',chart.yAxis.labelFontStyle==='bold'?'normal':chart.yAxis.labelFontStyle).style('font-weight',chart.yAxis.labelFontStyle==='bold'?'bold':'normal').style('stroke-width','0px');}stackedBars=chart.svg.selectAll('.eve-series').data(chart.data).enter().append('g').attr('class','eve-series').attr('transform',function(d){if(isReversed){return 'translate('+axis.offset.left+','+(axis.y(d[chart.xField]))+')';}else{return 'translate('+(axis.x(d[chart.xField])+axis.offset.left)+',0)';}});stackedBarsRects=stackedBars.selectAll('rect').data(function(d){return d.values;}).enter().append('rect').attr('class',function(d,i){return 'eve-bar-serie eve-bar-serie-'+i;}).attr('width',function(d){return isReversed?(axis.x(d.y1)-axis.x(d.y0)):axis.x.rangeBand();}).attr('height',function(d){return isReversed?axis.y.rangeBand():(axis.y(d.y0)-axis.y(d.y1));}).style('fill',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;}).style('stroke-width',function(d,i){return chart.series[i].strokeSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].alpha;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',function(d){return chart.series[i].strokeSize+1;});}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',function(d){return chart.series[i].strokeSize;});});if(isReversed)stackedBarsRects.attr('x',function(d){return axis.x(d.y0);});else stackedBarsRects.attr('y',function(d){return axis.y(d.y1);});};function createGroupedBars(){chart.data.forEach(function(d){d.values=axis.serieNames.map(function(name){return{name:name,xValue:d[chart.xField],yValue: +d[name]};})});var newYDomain=[0,d3.max(chart.data,function(d){return d3.max(d.values,function(v){return v.yValue*1.1;});})];if(isReversed){newYDomain=[d3.max(chart.data,function(d){return d3.max(d.values,function(v){return v.yValue*1.1;});}),0];axis.x.domain(newYDomain);}else{axis.y.domain(newYDomain);}var rangeBand=groupAxis.rangeBand();groupedBars=chart.svg.selectAll('.eve-series').data(chart.data).enter().append('g').attr('class','eve-series').attr('transform',function(d){if(isReversed)return 'translate('+(axis.offset.left)+','+(axis.y(d[chart.xField]))+')';else return 'translate('+(axis.x(d[chart.xField])+axis.offset.left)+',0)';});groupedBarsRects=groupedBars.selectAll('rect').data(function(d){return d.values;}).enter().append('rect').attr('class',function(d,i){return 'eve-bar-serie eve-bar-serie-'+i;}).attr('width',function(d){return isReversed?(axis.offset.width-axis.x(d.yValue)):rangeBand;}).attr('x',function(d){return isReversed?0:groupAxis(d.name);}).attr('y',function(d){return isReversed?groupAxis(d.name):axis.y(d.yValue);}).attr('height',function(d){return isReversed?rangeBand:(axis.offset.height-axis.y(d.yValue));}).style('fill',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;}).style('stroke','#ffffff').style('stroke-width',function(d,i){return chart.series[i].strokeSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].alpha;}).style('fill-opacity',function(d,i){return chart.series[i].alpha;}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',function(d){return chart.series[i].strokeSize+1;});}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',function(d){return chart.series[i].strokeSize;});});};init();return chart;};e.barChart=function(options){options.type='bar';return new bar(options);};e.columnChart=function(options){options.type='column';return new bar(options);};})(eve);(function(e){var defaults={bullet:'none',bulletAlpha:.5,bulletColor:'',bulletSize:8,bulletStrokeSize:1,bulletStrokeAlpha:1,color:'',dateFormat:'',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'',maxBulletSize:50,minBulletSize:5,numberFormat:'',title:'',type:'bubble',yField:''};function bubble(options){if(options.series==null&&e.getType(options.series)!=='array'){throw new Error('Invalid chart series!');}for(var i=0;i<options.series.length;i++){e.extend(options.series[i],defaults);}var that=this,chart=e.charts.init(options),axis=e.charts.createAxis(chart),bubbleSeries,bulletF;function init(){bulletF=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){var chartSerie=chart.series[d.index];var axisSerie=axis.series[d.index];if(chartSerie.sizeField!==''){var axisSerieRange=axisSerie.maxSize-axisSerie.minSize,chartSerieRange=chartSerie.maxBulletSize-chartSerie.minBulletSize,bulletSize=d.sizeValue/axisSerieRange*chartSerieRange-(axisSerie.minSize/axisSerieRange*chartSerieRange)+chartSerie.minBulletSize;return Math.pow(bulletSize,2);}else{return Math.pow(chartSerie.bulletSize,2);}});if(chart.balloon.format==='')chart.balloon.format='x: {x}: y: {y}, size: {size}';var grads=chart.svg.append('defs').selectAll('radialGradient').data(axis.series).enter().append('radialGradient').attr('cx',0).attr('cy',0).attr('r','100%').attr('id',function(d,i){return 'eve-grad-'+i;});grads.append('stop').attr('offset','10%').attr('stop-color','#ffffff');grads.append('stop').attr('offset','100%').attr('stop-color',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;});bubbleSeries=chart.svg.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');bubbleSeries.selectAll('.eve-bubble-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-bubble-point eve-bubble-point-'+d.index;}).attr('d',function(d){return bulletF(d);}).style('cursor','pointer').style('fill',function(d){return 'url(#eve-grad-'+d.index+')';}).style('stroke',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke-width',function(d){return chart.series[d.index].bulletStrokeSize+'px';}).style('stroke-opacity',function(d){return chart.series[d.index].bulletStrokeAlpha;}).style('stroke-dasharray',0).style('fill-opacity',function(d){return chart.series[d.index].bulletAlpha;}).attr('transform',function(d){return 'translate('+(axis.x(d.xValue)+axis.offset.left)+','+axis.y(d.yValue)+')';}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize+1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize);});};init();return chart;};e.bubbleChart=function(options){options.type='bubble';return new bubble(options);};})(eve);(function(e){var defaults={alphaField:'',colorField:'',hoverOpacity:.9,labelPosition:'inside',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'{percent}',neckHeight:25,sliceBorderOpacity:.1,titleField:'',valueField:'',valueFormat:''};function funnel(options){var that=this,chart=e.charts.init(options),isPyramid=options.type==='pyramid',serie=e.extend(chart.series[0],defaults),symbolSize=Math.pow(chart.legend.fontSize,2),margin={left:10+Math.sqrt(symbolSize),top:10+Math.sqrt(symbolSize),right:10+Math.sqrt(symbolSize),bottom:10+Math.sqrt(symbolSize)},transX=margin.left,transY=margin.top,funnelWidth=chart.width-margin.left-margin.right,funnelHeight=(!isPyramid&&serie.neckHeight>0)?(chart.height-serie.neckHeight-margin.top-margin.bottom):chart.height-margin.top-margin.bottom,gradePercent=isPyramid?1/200:1/10,grade=2*funnelHeight/(funnelWidth-gradePercent*funnelWidth),totalArea=(funnelWidth+gradePercent*funnelWidth)*funnelHeight/2,totalData=d3.sum(chart.data,function(d){return d[serie.valueField];}),legendWidth=0,legendHeight=0,alphaMin=0,alphaMax=0,slices,neck,legendTexts,legendIcons,funnel=d3.svg.line().x(function(d){return d[0];}).y(function(d){return d[1];});if(chart.series.length===0){throw Error('Chart serie could not found!');}if(chart.balloon.format==='')chart.balloon.format='{title}: {value}';if(serie.alphaField!==''){alphaMin=d3.min(chart.data,function(d){return d[serie.alphaField];});alphaMax=d3.max(chart.data,function(d){return d[serie.alphaField];})}function getPaths(){var paths=[],pathPoints=[];function createPathPoints(ll,lr,lh,i){if(i>=chart.data.length)return;v=chart.data[i][serie.valueField];a=v*totalArea/totalData;pw=lr-ll;nw=Math.sqrt((grade*pw*pw-4*a)/grade);nl=(pw-nw)/2+ll;nr=lr-(pw-nw)/2;nh=(grade*(pw-nw)/2+lh);pathPoints=[[nr,nh]];pathPoints.push([lr,lh]);pathPoints.push([ll,lh]);pathPoints.push([nl,nh]);pathPoints.push([nr,nh]);paths.push(pathPoints);createPathPoints(nl,nr,nh,i+1);};createPathPoints(0,funnelWidth,0,0);return paths;};function init(){chart.svg.append('g').attr('class','eve-funnel-slices');if(chart.legend.enabled){chart.svg.append('g').attr('class','eve-legend-icon');chart.svg.append('g').attr('class','eve-legend-text');legendHeight=chart.data.length*(chart.legend.fontSize+5);legendTexts=chart.svg.select('.eve-legend-text').selectAll('text.eve-legend-text').data(chart.data).enter().insert('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').text(function(d,i){return d[serie.titleField]}).style("text-anchor",function(d,i){var textWidth=this.getBBox().width+chart.legend.fontSize;if(textWidth>legendWidth)legendWidth=textWidth;return 'left';}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}if(d.selected){d3.select(slices[0][i]).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});}}else{d3.select(slices[0][i]).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});if(i===chart.data.length-1){if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});}}}if(chart.legendClick)chart.legendClick(d,i);});legendIcons=chart.svg.select('.eve-legend-icon').selectAll('path.eve-legend-icon').data(chart.data).enter().insert('path').attr('d',d3.svg.symbol().type(chart.legend.icon).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(slices!==undefined)return d3.select(slices[0][i]).style('fill');if(serie.colorField!=='')return d[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}if(d.selected){d3.select(slices[0][i]).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});}}else{d3.select(slices[0][i]).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});if(i===chart.data.length-1){if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});}}}if(chart.legendClick)chart.legendClick(d,i);});funnelWidth-=legendWidth;grade=2*funnelHeight/(funnelWidth-gradePercent*funnelWidth);totalArea=(funnelWidth+gradePercent*funnelWidth)*funnelHeight/2;}var paths=getPaths();chart.svg.attr('transform','translate('+transX+', '+transY+')');slices=chart.svg.select('.eve-funnel-slices').selectAll('path.eve-funnel-slice').data(chart.data).enter().insert('path').attr('class',function(d,i){return 'eve-funnel-slice eve-funnel-slice-'+i;}).attr('d',function(d,i){return funnel(paths[i]);}).style('stroke','#ffffff').style("stroke-width",0).style('fill',function(d,i){if(serie.colorField!=='')return d.data[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).style('fill-opacity',function(d,i){if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d.data[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).on('click',function(d,i){if(d.selected){d.selected=false;}else{d.selected=true;}if(d.selected){d3.select(this).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(10)';});}}else{d3.select(this).transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});if(i===chart.data.length-1){if(i===chart.data.length-1&&neck!=null){neck.transition().duration(chart.animationDuration/2).attr('transform',function(){return 'translate(0)';});}}}}).on('mousemove',function(d,i){var balloonContent=chart.getSlicedFormat(i,serie);chart.showBalloon(balloonContent);d3.select(this).style('opacity',serie.hoverOpacity);if(neck!==undefined&&i===chart.data.length-1)neck.style('opacity',serie.hoverOpacity);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('opacity',1);if(neck!==undefined&&i===chart.data.length-1)neck.style('opacity',1);});if(!isPyramid&&serie.neckHeight>0){var lastVal=chart.data[chart.data.length-1][serie.valueField],lfp=slices[0][chart.data.length-1].getBBox(),neckY=lfp.height+lfp.y,neckH=serie.neckHeight,lfpArea=lastVal*totalArea/totalData,neckW=Math.sqrt((grade*lfp.width*lfp.width-4*lfpArea)/grade),neckX=lfp.x+lfp.width/2-neckW/2;neck=chart.svg.insert('rect').style('fill',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;if(serie.colorField!=='')return d[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).style('fill-opacity',function(){var d=chart.data[chart.data.length-1],i=chart.data.length-1;if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).style("stroke-width",0).attr('width',neckW).attr('height',neckH).attr('y',neckY).attr('x',neckX).on('mousemove',function(){var balloonContent=chart.getSlicedFormat((chart.data.length-1),serie);chart.showBalloon(balloonContent);d3.select(this).style('opacity',serie.hoverOpacity);d3.select(slices[0][chart.data.length-1]).style('opacity',serie.hoverOpacity);}).on('mouseout',function(){chart.hideBalloon();d3.select(this).style('opacity',1);d3.select(slices[0][chart.data.length-1]).style('opacity',1);});}if(isPyramid)slices.attr('transform','translate('+(funnelWidth)+','+(funnelHeight)+')rotate(180)');if(chart.legend.enabled){legendTexts.attr('x',chart.width-legendWidth-margin.left).attr('y',function(d,i){var iconHeight=Math.sqrt(symbolSize)/2,y=((chart.height-legendHeight)/2)+((chart.legend.fontSize+iconHeight)*i)-Math.sqrt(symbolSize);return y;});legendIcons.attr('transform',function(d,i){var bbox=this.getBBox(),iconHeight=Math.sqrt(symbolSize)/2,x=chart.width-legendWidth-margin.left-Math.sqrt(symbolSize),y=((chart.height-legendHeight)/2)+((chart.legend.fontSize+iconHeight)*i)-(chart.legend.fontSize+iconHeight);return 'translate('+x+','+y+')';});}if(serie.labelFormat!==''){var labelTexts=chart.svg.append('g').attr('class','eve-funnel-labels');chart.svg.select('.eve-funnel-labels').selectAll('text').data(chart.data).enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').style('text-anchor','left').text(function(d,i){return chart.getSlicedFormat(i,serie,'label');}).attr('transform',function(d,i){var fSlice=slices[0][i].getBBox(),bbox=this.getBBox(),xPos=funnelWidth/2-bbox.width/2,yPos=fSlice.y+fSlice.height/2+bbox.height/2;if(isPyramid)yPos=(funnelHeight-fSlice.y)-fSlice.height/2+bbox.height/2;return 'translate('+xPos+','+yPos+')';});}};init();return chart;};e.funnelChart=function(options){options.type='funnel';return new funnel(options);};e.pyramidChart=function(options){options.type='pyramid';return new funnel(options);}})(eve);(function(e){var defaults={behavior:'linear',bullet:'none',bulletAlpha:.5,bulletColor:'',bulletSize:8,bulletStrokeSize:1,bulletStrokeAlpha:1,color:'',dateFormat:'',drawingStyle:'solid',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'',lineAlpha:1,numberFormat:'',strokeSize:1.5,title:'',type:'line',yField:''};function line(options){if(options.series==null&&e.getType(options.series)!=='array'){throw new Error('Invalid chart series!');}for(var i=0;i<options.series.length;i++){e.extend(options.series[i],defaults);}var that=this,chart=e.charts.init(options),axis=e.charts.createAxis(chart),lineSeries,bulletSeries,lineF,bulletF;var zoom=d3.behavior.zoom().x(axis.x).y(axis.y).on("zoom",zoomHandler);function zoomHandler(){chart.svg.select('.eve-x-axis').call(axis.xAxis);chart.svg.select('.eve-y-axis').call(axis.yAxis);chart.svg.select(".eve-x-grid").call(axis.makeXAxis().tickSize(-axis.offset.height,0,0));chart.svg.select(".eve-y-grid").call(axis.makeYAxis().tickSize(-axis.offset.width,0,0));chart.svg.selectAll('.eve-line-serie').attr('d',function(d){return lineF(d.values);});chart.svg.selectAll('.eve-line-point').attr('d',function(d){return bulletF(d);});};if(chart.zoomable)chart.svg.call(zoom);function init(){lineF=d3.svg.line().x(function(d){return axis.x(d.xValue);}).y(function(d){return axis.y(d.yValue);});bulletF=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){return Math.pow(chart.series[d.index].bulletSize,2)});if(chart.balloon.format==='')chart.balloon.format='{x}: {y}';lineSeries=chart.svg.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');lineSeries.append('path').attr('class',function(d,i){return 'eve-line-serie eve-line-serie-'+i;}).attr('d',function(d,i){if(chart.series[i].behavior==='stepLine')lineF.interpolate('step');else if(chart.series[i].behavior==='spLine')lineF.interpolate('cardinal');return lineF(d.values);}).attr('transform','translate('+axis.offset.left+')').style('fill','none').style('stroke-width',function(d,i){return chart.series[i].strokeSize+'px';}).style('stroke-opacity',function(d,i){return chart.series[i].lineAlpha;}).style('stroke-dasharray',function(d,i){if(chart.series[i].drawingStyle==='dotted')return '2, 2';else if(chart.series[i].drawingStyle==='dashed')return '5, 2';else return '0';}).style('stroke',function(d,i){if(chart.series[i].color==='')return i<=e.colors.length?e.colors[i]:e.randColor();else return chart.series[i].color;});lineBullets=lineSeries.selectAll('.eve-line-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-line-point eve-line-point-'+d.index;}).attr('d',function(d){return bulletF(d);}).style('cursor','pointer').style('fill',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke-dasharray',0).style('stroke-width',function(d){return chart.series[d.index].bulletStrokeSize+'px';}).style('stroke-opacity',0).style('fill-opacity',0).attr('transform',function(d){return 'translate('+(axis.x(d.xValue)+axis.offset.left)+','+axis.y(d.yValue)+')';}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-opacity',function(d){return chart.series[d.index].bulletStrokeAlpha;}).style('fill-opacity',function(d){return chart.series[d.index].bulletAlpha;});}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-opacity',0).style('fill-opacity',0);});};init();return chart;};e.lineChart=function(options){options.type='line';return new line(options);};})(eve);(function(e){var defaults={alphaField:'',colorField:'',hoverOpacity:.9,labelPosition:'inside',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'{percent}',sliceBorderOpacity:.1,titleField:'',valueField:'',valueFormat:''};function pie(options){var that=this,chart=e.charts.init(options),isDonut=options.type==='donut',serie=e.extend(chart.series[0],defaults),transX=chart.width/2,transY=chart.height/2,pieWidth=chart.width,pieHeight=chart.height,pieData=d3.layout.pie().sort(null).value(function(d){return d[serie.valueField];}),key=function(d){return d.data[serie.titleField];},legendWidth=0,legendHeight=0,alphaMin=0,alphaMax=0,symbolSize=Math.pow(chart.legend.fontSize,2),radius=Math.min(pieWidth,pieHeight)/2,outerRadius=serie.labelFormat!==''?(serie.labelPosition==='outside'?radius*.8:radius*.9):radius*.9,innerRadius=isDonut?radius/2:0,slices,legendTexts,legendIcons;if(chart.series.length===0){throw Error('Chart serie could not found!');}if(chart.balloon.format==='')chart.balloon.format='{title}: {value}';if(serie.alphaField!==''){alphaMin=d3.min(chart.data,function(d){return d[serie.alphaField];});alphaMax=d3.max(chart.data,function(d){return d[serie.alphaField];})}function init(){if(chart.legend.enabled){chart.svg.append('g').attr('class','eve-legend-icon');chart.svg.append('g').attr('class','eve-legend-text');legendHeight=chart.data.length*(chart.legend.fontSize+5);legendTexts=chart.svg.select('.eve-legend-text').selectAll('text.eve-legend-text').data(pieData(chart.data),key).enter().insert('text').attr('class','eve-legend-text').style('cursor','pointer').style('fill',chart.legend.fontColor).style('font-weight',chart.legend.fontStyle=='bold'?'bold':'normal').style('font-style',chart.legend.fontStyle=='bold'?'normal':chart.legend.fontStyle).style("font-family",chart.legend.fontFamily).style("font-size",chart.legend.fontSize+'px').text(function(d,i){return d.data[serie.titleField]}).style("text-anchor",function(d,i){var textWidth=this.getBBox().width+chart.legend.fontSize;if(textWidth>legendWidth)legendWidth=textWidth;return 'left';}).on('click',function(d,i){if(slices!=null){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(slices[0][i]).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*5,newY= -Math.cos(newAngle)*5;return 'translate('+newX+','+newY+')';});}else{d3.select(slices[0][i]).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}}if(chart.legendClick)chart.legendClick(d,i);});legendIcons=chart.svg.select('.eve-legend-icon').selectAll('path.eve-legend-icon').data(pieData(chart.data),key).enter().insert('path').attr('d',d3.svg.symbol().type(chart.legend.icon).size(symbolSize)).attr('class','eve-legend-icon').style('cursor','pointer').style('fill',function(d,i){if(slices!==undefined)return d3.select(slices[0][i]).style('fill');if(serie.colorField!=='')return d.data[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).on('click',function(d,i){if(slices!=null){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(slices[0][i]).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*5,newY= -Math.cos(newAngle)*5;return 'translate('+newX+','+newY+')';});}else{d3.select(slices[0][i]).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}}if(chart.legendClick)chart.legendClick(d,i);});if(chart.legend.position==='left')transX=transX+legendWidth/2;else transX=transX-legendWidth/2;pieWidth-=legendWidth*2;radius=Math.min(pieWidth,pieHeight)/2;outerRadius=serie.labelFormat!==''?(serie.labelPosition==='outside'?radius*.8:radius*.9):radius*.9;innerRadius=isDonut?radius/2:0;}chart.svg.append('g').attr('class','eve-pie-slices');var arc=d3.svg.arc().outerRadius(outerRadius).innerRadius(innerRadius);chart.svg.attr('transform','translate('+transX+','+transY+')');slices=chart.svg.select('.eve-pie-slices').selectAll('path.eve-pie-slice').data(pieData(chart.data),key);slices.enter().insert('path').style('fill',function(d,i){if(serie.colorField!=='')return d.data[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).style('fill-opacity',function(d,i){if(serie.alphaField!==''){var range=alphaMax-alphaMin,alpha=d.data[serie.alphaField]/range*.8-(alphaMin/range*.8)+.2;return alpha;;}else return 1;}).style("stroke",serie.sliceBorderColor).style("stroke-width",1).style("stroke-opacity",serie.sliceBorderOpacity).attr('class','eve-pie-slice').on('click',function(d,i){if(d.data.selected){d.data.selected=false;}else{d.data.selected=true;}if(d.data.selected){d3.select(this).style("stroke-opacity",1).transition().duration(chart.animationDuration/2).attr('transform',function(){var newAngle=(d.startAngle+d.endAngle)/2,newX=Math.sin(newAngle)*5,newY= -Math.cos(newAngle)*5;return 'translate('+newX+','+newY+')';});}else{d3.select(this).style("stroke-opacity",0.1).transition().duration(chart.animationDuration/2).attr('transform','translate(0,0)');}if(chart.serieClick)chart.serieClick(d.data);}).on('mousemove',function(d,i){var balloonContent=chart.getSlicedFormat(i,serie);chart.showBalloon(balloonContent);this.style['opacity']=serie.hoverOpacity;}).on('mouseout',function(d){chart.hideBalloon();this.style['opacity']=1;});slices.transition().duration(chart.animationDuration).attrTween('d',function(d){this._current=this._current||d;var interpolated=d3.interpolate(this._current,d);this._current=interpolated(0);return function(t){return arc(interpolated(t));};});slices.exit().remove();if(chart.legend.enabled){legendTexts.attr('x',radius+Math.sqrt(symbolSize)).attr('y',function(d,i){return((legendHeight/chart.data.length)*i)-(legendHeight/2)+chart.legend.fontSize;});legendIcons.attr('transform',function(d,i){var bbox=this.getBBox(),x=radius,iconHeight=Math.sqrt(symbolSize)/2,y=((legendHeight/chart.data.length)*i)-(legendHeight/2)+chart.legend.fontSize-iconHeight;return 'translate('+x+','+y+')';});}if(serie.labelFormat!==''){chart.svg.append('g').attr('class','eve-pie-labels');if(serie.labelPosition==='inside'){chart.svg.select('.eve-pie-labels').selectAll('text').data(pieData(chart.data),key).enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').style('text-anchor','middle').text(function(d,i){return chart.getSlicedFormat(i,serie,'label');}).transition().duration(chart.animationDuration).attr('transform',function(d){return 'translate('+arc.centroid(d)+')';});}else{chart.svg.append('g').attr('class','eve-pie-labels-lines');chart.svg.select('.eve-pie-labels-lines').selectAll('line').data(pieData(chart.data),key).enter().append('line').style('stroke',function(d,i){if(serie.colorField!=='')return d.data[serie.colorField];else return i<=e.colors.length?e.colors[i]:e.randColor();}).style('stroke-width',1).style('stroke-opacity',0.2).transition().duration(chart.animationDuration).attr("x1",function(d){return arc.centroid(d)[0];}).attr("y1",function(d){return arc.centroid(d)[1];}).attr("x2",function(d){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*(radius*0.9);return x;}).attr("y2",function(d){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var y=Math.sin(midAngle)*(radius*0.9);return y;});chart.svg.select('.eve-pie-labels').selectAll('text').data(pieData(chart.data),key).enter().append('text').style('fill',serie.labelFontColor).style('font-weight',serie.labelFontStyle=='bold'?'bold':'normal').style('font-style',serie.labelFontStyle=='bold'?'normal':serie.labelFontStyle).style("font-family",serie.labelFontFamily).style("font-size",serie.labelFontSize+'px').text(function(d,i){return chart.getSlicedFormat(i,serie,'label');}).transition().duration(chart.animationDuration).attr('x',function(d){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*(radius*0.9);return x+(5*((x>0)?1: -1));}).attr('y',function(d){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);return Math.sin(midAngle)*(radius*0.9);}).style("text-anchor",function(d){var centroid=arc.centroid(d);var midAngle=Math.atan2(centroid[1],centroid[0]);var x=Math.cos(midAngle)*(radius*0.9);return(x>0)?"start":"end";});}}};init();return chart;};e.pieChart=function(options){options.type='pie';return new pie(options,false);};e.donutChart=function(options){options.type='donut';return new pie(options,true);}})(eve);(function(e){var defaults={bullet:'none',bulletAlpha:.5,bulletColor:'',bulletSize:8,bulletStrokeSize:1,bulletStrokeAlpha:1,color:'',dateFormat:'',labelFontColor:'#ffffff',labelFontFamily:'Tahoma',labelFontSize:11,labelFontStyle:'normal',labelFormat:'',numberFormat:'',title:'',type:'scatter',yField:''};function scatter(options){if(options.series==null&&e.getType(options.series)!=='array'){throw new Error('Invalid chart series!');}for(var i=0;i<options.series.length;i++){e.extend(options.series[i],defaults);}var that=this,chart=e.charts.init(options),axis=e.charts.createAxis(chart),scatterSeries,bulletF;var zoom=d3.behavior.zoom().x(axis.x).y(axis.y).on("zoom",zoomHandler);function zoomHandler(){chart.svg.select('.eve-x-axis').call(axis.xAxis);chart.svg.select('.eve-y-axis').call(axis.yAxis);chart.svg.select(".eve-x-grid").call(axis.makeXAxis().tickSize(-axis.offset.height,0,0));chart.svg.select(".eve-y-grid").call(axis.makeYAxis().tickSize(-axis.offset.width,0,0));};if(chart.zoomable)chart.svg.call(zoom);function init(){bulletF=d3.svg.symbol().type(function(d){return chart.series[d.index].bullet==='none'?'circle':chart.series[d.index].bullet;}).size(function(d){return Math.pow(chart.series[d.index].bulletSize,2)});if(chart.balloon.format==='')chart.balloon.format='{x}: {y}';scatterSeries=chart.svg.selectAll('.eve-series').data(axis.series).enter().append('g').attr('class','eve-series');scatterSeries.selectAll('.eve-scatter-point').data(function(d){return d.values;}).enter().append('path').attr('class',function(d,i){return 'eve-scatter-point eve-scatter-point-'+d.index;}).attr('d',function(d){return bulletF(d);}).style('cursor','pointer').style('fill',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke',function(d){if(chart.series[d.index].color==='')return d.index<=e.colors.length?e.colors[d.index]:e.randColor();else return chart.series[d.index].color;}).style('stroke-width',function(d){return chart.series[d.index].bulletStrokeSize+'px';}).style('stroke-opacity',function(d){return chart.series[d.index].bulletStrokeAlpha;}).style('stroke-dasharray',0).style('fill-opacity',function(d){return chart.series[d.index].bulletAlpha;}).attr('transform',function(d){return 'translate('+(axis.x(d.xValue)+axis.offset.left)+','+axis.y(d.yValue)+')';}).on('mousemove',function(d,i){var balloonContent=chart.getXYFormat(d,chart.series[d.index]);chart.showBalloon(balloonContent);d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize+1);}).on('mouseout',function(d,i){chart.hideBalloon();d3.select(this).style('stroke-width',chart.series[d.index].bulletStrokeSize);});};init();return chart;};e.scatterChart=function(options){options.type='scatter';return new scatter(options);};})(eve);
